if(void 0===CodeMirror)var CodeMirror=void 0;if(void 0===jQuery)var jQuery=void 0;!function(){var Ajax={settings:{},post:function(t){return new AjaxRequest("post",t)},get:function(t){return new AjaxRequest("get",t)}},AjaxRequest=function(t,e){var i={method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}};this.p=this.extend(i,e),this.p=this.extend(this.p,Ajax.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),!1!==("function"!=typeof this.p.before||this.p.before(this.xhr))&&this.send()};AjaxRequest.prototype={extend:function(t,e){if(e)for(var i in e)t[i]=e[i];return t},prepareData:function(){"POST"!==this.p.method||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),"object"!=typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data)),"GET"===this.p.method&&(this.p.url=this.p.data?this.p.url+"?"+this.p.data:this.p.url)},setHeaders:function(){for(var t in this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),this.p.headers)this.xhr.setRequestHeader(t,this.p.headers[t])},isFormData:function(){return void 0!==window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||300<=this.xhr.status&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){if(this.isComplete()){var t=this.xhr.response,e=this.parseJson(t);t=e||t,"function"==typeof this.p.success&&this.p.success(t,this.xhr)}else"function"==typeof this.p.error&&this.p.error(this.xhr.statusText)},parseJson:function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},toParams:function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}};var DomCache=[0],DomExpando="data"+(new Date).getTime(),Dom=function(t,e){return this.parse(t,e)};Dom.ready=function(t){document.addEventListener("DOMContentLoaded",t)},Dom.prototype={get length(){return this.nodes.length},parse:function(t,e){var i;if(t){if(t instanceof Dom)return this.nodes=t.nodes,t;i=/^\s*<(\w+|!)[^>]*>/.test(t)?this.create(t):"string"!=typeof t?t.nodeType&&11===t.nodeType?t.childNodes:t.nodeType||this._isWindowNode(t)?[t]:t:this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div");i.innerHTML=t;for(var s=0,n=i.childNodes.length;s<n;s++)e.push(i.childNodes[s]);return e},dataset:function(e,i){return this.each(function(t){DomCache[this.dataindex(t.get())][e]=i})},dataget:function(t){return DomCache[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[DomExpando],i=DomCache.length;return e||(e=i,t&&(t[DomExpando]=i),DomCache[e]={}),e},add:function(t){return this.nodes=this.nodes.concat(this._array(t)),this},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new Dom(this.nodes[t])},first:function(){return new Dom(this.nodes[0])},last:function(){return new Dom(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,new Dom(this.nodes[i]),i);return this},is:function(t){return 0<this.filter(t).length},filter:function(e){var t;return void 0===e?this:(t="function"==typeof e?function(t){return e(new Dom(t))}:function(t){return e&&e.nodeType||e instanceof Node?e===t:(t.matches=t.matches||t.msMatchesSelector||t.webkitMatchesSelector,1===t.nodeType&&t.matches(e||"*"))},new Dom(this.nodes.filter.call(this.nodes,t)))},not:function(e){return this.filter(function(t){return!new Dom(t).is(e||!0)})},find:function(n){var a=[];return this.each(function(t){for(var e=t.get(),i=this._query(n,e),s=0;s<i.length;s++)a.push(i[s])}),new Dom(a)},children:function(t){var n=[];return this.each(function(t){var e=t.get();if(e.children)for(var i=e.children,s=0;s<i.length;s++)n.push(i[s])}),new Dom(n).filter(t)},parent:function(t){var e=this.get(),i=!!e.parentNode&&e.parentNode;return i?new Dom(i).filter(t):new Dom},parents:function(i,s){s=this._context(s);var n=[];return this.each(function(t){for(var e=t.get().parentNode;e&&e!==s;)i?new Dom(e).is(i)&&n.push(e):n.push(e),e=e.parentNode}),new Dom(n)},closest:function(i,s){s=this._context(s);var n=[],a=i&&i.nodeType;return this.each(function(t){var e=t.get();do{if(a&&e===i||new Dom(e).is(i))return n.push(e)}while((e=e.parentNode)&&e!==s)}),new Dom(n)},next:function(t){return this._sibling(t,"nextSibling")},nextElement:function(t){return this._sibling(t,"nextElementSibling")},prev:function(t){return this._sibling(t,"previousSibling")},prevElement:function(t){return this._sibling(t,"previousElementSibling")},css:function(n,a){if(void 0!==a||"object"==typeof n)return this.each(function(t){var e=t.get(),i={};for(var s in"object"==typeof n?i=n:i[n]=a,i)e.style&&(e.style[s]=i[s])});var t=this.get();return"width"===n||"height"===n?t.style?this._getHeightOrWidth(n)+"px":void 0:t.style?getComputedStyle(t,null)[n]:void 0},attr:function(n,a,o){if(o=o?"data-":"",void 0!==a||"object"==typeof n)return this.each(function(t){var e=t.get(),i={};for(var s in"object"==typeof n?i=n:i[n]=a,i)3!==e.nodeType&&("checked"===s?e.checked=i[s]:e.setAttribute(o+s,i[s]))});var t=this.get();return t&&3!==t.nodeType?"checked"===n?t.checked:this._boolean(t.getAttribute(o+n)):void 0},data:function(t,e){if(void 0!==t)return this.attr(t,e,!0);function i(t){return t[1].toUpperCase()}var s=/^data-(.+)$/,n=this.get().attributes,a={};for(var o in n)if(n[o]&&s.test(n[o].nodeName)){var r=n[o].nodeName.match(s)[1],p=n[o].value;r=r.replace(/-([a-z])/g,i),p=-1!==p.search(/^{/)?this._object(p):this._number(p)?parseFloat(p):this._boolean(p),a[r]=p}return a},val:function(i){if(void 0!==i)return this.each(function(t){var e=t.get();e.type&&"checkbox"===e.type?e.checked=i:e.value=i});var t=this.get();return t.type&&"checkbox"===t.type?t.checked:t.value},removeAttr:function(i){return this.each(function(t){var e=t.get();i.split(" ").forEach(function(t){3!==e.nodeType&&e.removeAttribute(t)})})},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(t){var e=this.get();return!!e.classList&&e.classList.contains(t)},empty:function(){return this.each(function(t){t.get().innerHTML=""})},html:function(t){return void 0===t?this.get().innerHTML||"":this.empty().append(t)},text:function(e){return void 0===e?this.get().textContent||"":this.each(function(t){t.get().textContent=e})},after:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("afterend",t);else if(null!==e.parentNode)for(var i=t instanceof Node?[t]:this._array(t).reverse(),s=0;s<i.length;s++)e.parentNode.insertBefore(i[s],e.nextSibling);return e})},before:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("beforebegin",t);else for(var i=t instanceof Node?[t]:this._array(t),s=0;s<i.length;s++)e.parentNode.insertBefore(i[s],e);return e})},append:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("beforeend",t);else for(var i=t instanceof Node?[t]:this._array(t),s=0;s<i.length;s++)e.appendChild(i[s]);return e})},prepend:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("afterbegin",t);else for(var i=t instanceof Node?[t]:this._array(t).reverse(),s=0;s<i.length;s++)e.insertBefore(i[s],e.firstChild);return e})},wrap:function(t){return this._inject(t,function(t,e){var i="string"==typeof t||"number"==typeof t?this.create(t)[0]:t instanceof Node?t:this._array(t)[0];return e.parentNode&&e.parentNode.insertBefore(i,e),i.appendChild(e),i})},unwrap:function(){return this.each(function(t){for(var e=t.get(),i=document.createDocumentFragment();e.firstChild;){var s=e.removeChild(e.firstChild);i.appendChild(s)}e.parentNode.replaceChild(i,e)})},replaceWith:function(t){return this._inject(t,function(t,e){for(var i=document.createDocumentFragment(),s="string"==typeof t||"number"==typeof t?this.create(t):t instanceof Node?[t]:this._array(t),n=0;n<s.length;n++)i.appendChild(s[n]);var a=i.childNodes[0];return e.parentNode&&e.parentNode.replaceChild(i,e),a})},remove:function(){return this.each(function(t){var e=t.get();e.parentNode&&e.parentNode.removeChild(e)})},clone:function(s){var n=[];return this.each(function(t){var e=t.get(),i=this._clone(e);s&&(i=this._cloneEvents(e,i)),n.push(i)}),new Dom(n)},show:function(){return this.each(function(t){var e=t.get();if(e.style&&this._hasDisplayNone(e)){var i=e.getAttribute("domTargetShow");e.style.display=i||"block",e.removeAttribute("domTargetShow")}}.bind(this))},hide:function(){return this.each(function(t){var e=t.get();if(e.style&&!this._hasDisplayNone(e)){var i=e.style.display;"block"!==i&&e.setAttribute("domTargetShow",i),e.style.display="none"}})},scrollTop:function(t){var e=this.get(),i=this._isWindowNode(e),s=9===e.nodeType?e.scrollingElement||e.body.parentNode||e.body||e.documentElement:e;return void 0!==t?(t=parseInt(t),void(i?e.scrollTo(0,t):s.scrollTop=t)):i?e.pageYOffset:s.scrollTop},offset:function(){return this._getPos("offset")},position:function(){return this._getPos("position")},width:function(t){return void 0!==t?this.css("width",parseInt(t)+"px"):this._getSize("width","Width")},height:function(t){return void 0!==t?this.css("height",parseInt(t)+"px"):this._getSize("height","Height")},outerWidth:function(){return this._getSize("width","Width","outer")},outerHeight:function(){return this._getSize("height","Height","outer")},innerWidth:function(){return this._getSize("width","Width","inner")},innerHeight:function(){return this._getSize("height","Height","inner")},click:function(){return this._trigger("click")},focus:function(){return this._trigger("focus")},blur:function(){return this._trigger("blur")},on:function(o,r,p){return this.each(function(t){for(var e=t.get(),i=o.split(" "),s=0;s<i.length;s++){var n=this._getEventName(i[s]),a=this._getEventNamespace(i[s]);r=p?this._getOneHandler(r,o):r,e.addEventListener(n,r),e._e=e._e||{},e._e[a]=e._e[a]||{},e._e[a][n]=e._e[a][n]||[],e._e[a][n].push(r)}})},one:function(t,e){return this.on(t,e,!0)},off:function(o,r){function p(t,e,i){return t===i}function l(t,e,i,s){return e===s}function h(t,e,i,s){return t===i&&e===s}function e(){return!0}return void 0===o?this.each(function(t){this._offEvent(t.get(),!1,!1,r,e)}):this.each(function(t){for(var e=t.get(),i=o.split(" "),s=0;s<i.length;s++){var n=this._getEventName(i[s]),a=this._getEventNamespace(i[s]);"_events"===a?this._offEvent(e,n,a,r,p):n||"_events"===a?this._offEvent(e,n,a,r,h):this._offEvent(e,n,a,r,l)}})},serialize:function(t){for(var e={},i=this.get().elements,s=0;s<i.length;s++){var n=i[s];if((!/(checkbox|radio)/.test(n.type)||n.checked)&&(n.name&&!n.disabled&&"file"!==n.type)){if("select-multiple"===n.type)for(var a=0;a<n.options.length;a++){var o=n.options[a];o.selected&&(e[n.name]=o.value)}e[n.name]=this._number(n.value)?parseFloat(n.value):this._boolean(n.value)}}return t?e:this._params(e)},scroll:function(){this.get().scrollIntoView({behavior:"smooth"})},fadeIn:function(t,e){var i=this._anim(t,e,500);return this.each(function(e){e.css({display:"block",opacity:0,animation:"fadeIn "+i.speed+"s ease-in-out"}),e.one("animationend",function(t){e.css({opacity:"",animation:""}),i.fn&&i.fn(e)})})},fadeOut:function(t,e){var i=this._anim(t,e,300);return this.each(function(e){e.css({opacity:1,animation:"fadeOut "+i.speed+"s ease-in-out"}),e.one("animationend",function(t){e.css({display:"none",opacity:"",animation:""}),i.fn&&i.fn(e)})})},slideUp:function(t,e){var i=this._anim(t,e,300);return this.each(function(e){e.height(e.height()),e.css({overflow:"hidden",animation:"slideUp "+i.speed+"s ease-out"}),e.one("animationend",function(t){e.css({display:"none",height:"",animation:""}),i.fn&&i.fn(e)})})},slideDown:function(t,e){var i=this._anim(t,e,400);return this.each(function(e){e.height(e.height()),e.css({display:"block",overflow:"hidden",animation:"slideDown "+i.speed+"s ease-in-out"}),e.one("animationend",function(t){e.css({overflow:"",height:"",animation:""}),i.fn&&i.fn(e)})})},_queryContext:function(t,e){return 3!==(e=this._context(e)).nodeType&&"function"==typeof e.querySelectorAll?e.querySelectorAll(t):[]},_query:function(t,e){var i=document;if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if("#"!==t[0])return"."===t[0]?i.getElementsByClassName(t.slice(1)):i.getElementsByTagName(t);var s=i.getElementById(t.slice(1));return s?[s]:[]}return i.querySelectorAll(t)},_context:function(t){return t?"string"==typeof t?document.querySelector(t):t:document},_sibling:function(i,s){var n,a=i&&i.nodeType;return this.each(function(t){for(var e=t.get();e=e[s];)if(a&&e===i||new Dom(e).is(i))return void(n=e)}),new Dom(n)},_slice:function(t){return t&&0!==t.length?t.length?[].slice.call(t.nodes||t):[t]:[]},_array:function(t){if(void 0===t)return[];if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return t instanceof Dom?t.nodes:t},_object:function(t){return new Function("return "+t)()},_params:function(t){var e="";for(var i in t)e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i]);return e.replace(/^&/,"")},_boolean:function(t){return"true"===t||"false"!==t&&t},_number:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_inject:function(t,e){for(var i=this.nodes.length,s=[];i--;){var n="function"==typeof t?t.call(this,this.nodes[i]):t,a=0===i?n:this._clone(n),o=e.call(this,a,this.nodes[i]);o&&(o.dom?s.push(o.get()):s.push(o))}return new Dom(s)},_clone:function(t){if(void 0!==t)return"string"==typeof t?t:t instanceof Node||t.nodeType?t.cloneNode(!0):"length"in t?[].map.call(this._array(t),function(t){return t.cloneNode(!0)}):void 0},_cloneEvents:function(t,e){var i=t._e;if(i)for(var s in(e._e=i)._events)for(var n=0;n<i._events[s].length;n++)e.addEventListener(s,i._events[s][n]);return e},_trigger:function(t){var e=this.get();return e&&3!==e.nodeType&&e[t](),this},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_getSize:function(t,e,i){var s=this.get(),n=0;return n=3===s.nodeType?0:9===s.nodeType?this._getDocSize(s,e):this._isWindowNode(s)?window["inner"+e]:this._getHeightOrWidth(t),Math.round(n)},_getDocSize:function(t,e){var i=t.body,s=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],s["client"+e],s["scroll"+e],s["offset"+e])},_getPos:function(t){var e=this.get(),i={top:0,left:0};if(3===e.nodeType||this._isWindowNode(e)||9===e.nodeType)return i;if("position"===t)return{top:e.offsetTop,left:e.offsetLeft};if("offset"!==t)return i;var s=e.getBoundingClientRect(),n=e.ownerDocument,a=n.documentElement,o=n.defaultView;return{top:s.top+o.pageYOffset-a.clientTop,left:s.left+o.pageXOffset-a.clientLeft}},_getHeightOrWidth:function(t,e){var i=t.charAt(0).toUpperCase()+t.slice(1),s=e||"offset",n=0,a=this.get(),o=getComputedStyle(a,null),r=this.parents().filter(function(t){var e=t.get();return 1===e.nodeType&&"none"===getComputedStyle(e,null).display&&e});if("none"===o.display&&r.add(a),0!==r.length){var p="visibility: hidden !important; display: block !important;",l=[];r.each(function(t){var e=t.attr("style");null!==e&&l.push(e),t.attr("style",null!==e?e+";"+p:p)}),n=a[s+i],r.each(function(t,e){void 0===l[e]?t.removeAttr("style"):t.attr("style",l[e])})}else n=a[s+i];return n},_eachClass:function(i,s){return this.each(function(t){if(i){var e=t.get();i.split(" ").forEach(function(t){e.classList&&e.classList[s](t)})}})},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,s,n){for(var a in t._e)for(var o in t._e[a])if(n(o,a,e,i))for(var r=t._e[a][o],p=0;p<r.length;p++)void 0!==s&&r[p].toString()!==s.toString()||(t.removeEventListener(o,r[p]),t._e[a][o].splice(p,1),0===t._e[a][o].length&&delete t._e[a][o],0===Object.keys(t._e[a]).length&&delete t._e[a])},_hasDisplayNone:function(t){return"none"===t.style.display||"none"===(t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display)},_anim:function(t,e,i){return t="function"==typeof t?(e=t,i):t||i,{fn:e,speed:t/1e3}},_isWindowNode:function(t){return t===window||t.parent&&t.parent===window}};var re_uuid=0,RedactorX=function(t,e){return RedactorXInit(t,e)},RedactorXInit=function(t,e){var i;return $R.dom(t).each(function(t){(i=t.dataget($R.namespace))||(i=new App(t,e,re_uuid),t.dataset($R.namespace,i),$R.instances[re_uuid]=i,re_uuid++)}),i},$R=RedactorX;$R.dom=function(t,e){return new Dom(t,e)},$R.ajax=Ajax,$R.instances=[],$R.namespace="redactorx",$R.prefix="rx",$R.version="1.0.1",$R.settings={},$R.lang={},$R._mixins={},$R._repository={},$R._subscribe={},$R.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},$R.add=function(t,e,i){if(i.translations&&($R.lang=$R.extend(!0,$R.lang,i.translations)),i.defaults){var s={};s[e]=i.defaults,$R.opts=$R.extend(!0,$R.opts,s)}if("mixin"===t)$R._mixins[e]=i;else{if(i.subscribe)for(var n in i.subscribe)for(var a=n.split(","),o=0;o<a.length;o++){var r=a[o].trim();void 0===$R._subscribe[r]&&($R._subscribe[r]=[]),$R._subscribe[r].push({module:e,func:i.subscribe[n]})}function p(){}if((p.prototype=i).mixins)for(var l=0;l<i.mixins.length;l++)$R.inherit(p,$R._mixins[i.mixins[l]]);$R._repository[e]={type:t,proto:p,obj:i}}},$R.extend=function(){var i={},s=!1,t=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(s=arguments[0],t++);function n(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s&&"[object Object]"===Object.prototype.toString.call(t[e])?i[e]=$R.extend(!0,i[e],t[e]):i[e]=t[e])}for(;t<e;t++){n(arguments[t])}return i},$R.error=function(t){throw t},$R.inherit=function(t,e){function i(){}i.prototype=e;var s=new i;for(var n in t.prototype)t.prototype.__lookupGetter__(n)?s.__defineGetter__(n,t.prototype.__lookupGetter__(n)):s[n]=t.prototype[n];return t.prototype=s,t.prototype.super=e,t},$R.addLang=function(t,e){void 0===$R.lang[t]&&($R.lang[t]={}),$R.lang[t]=$R.extend(!0,$R.lang[t],e)},RedactorX.opts={plugins:[],content:!1,placeholder:!1,classes:!1,draggable:!1,editor:{classname:"content",focus:!1,sync:!0,drop:!0,lang:"en",add:"top",scrollTarget:window,direction:"ltr",spellcheck:!0,grammarly:!1,notranslate:!1,minHeight:"40px",maxHeight:!1},codemirrorSrc:!1,codemirror:!1,source:!0,autosave:{url:!1,name:!1,data:!1},state:{limit:100},clean:{comments:!1,enter:!0,enterinline:!1},tab:{key:!0,spaces:!1},link:{size:30,nofollow:!1,target:!1},topbar:!0,context:!1,control:!1,reorder:!1,buttons:{addbar:["text","image","embed","table","quote","pre","line"],context:["bold","italic","deleted","code","link"],topbar:["shortcut"],editor:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"}},tags:{b:["bold"],strong:["bold"],i:["italic"],em:["italic"],del:["deleted"],a:["link"]},types:!1},addbar:{add:{},hide:[]},toolbar:{sticky:!0,stickyMinHeight:200,stickyTopOffset:0},paste:{clean:!0,autoparse:!0,paragraphize:!0,plaintext:!1,linkTarget:!1,images:!0,links:!0,keepClass:[],keepAttrs:["td","th"],formTags:["form","input","button","select","textarea","legend","fieldset"],blockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","hr","figure","iframe","figcaption","address"],inlineTags:["a","svg","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"]},image:{states:!0,upload:!1,url:!0,select:!1,name:"file",data:!1,drop:!0,multiple:!0,clipboard:!0,types:["image/*"],tag:"figure",newtab:!1,link:!0},embed:{responsive:"embed-responsive"},pre:{template:"<pre></pre>",spaces:4},line:!0,table:{template:"<table><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>",nowrap:"nowrap"},quote:{template:"<blockquote><p>Quote...</p><p><cite>Author Attribution</cite></p></blockquote>"},format:["p","h1","h2","h3","ul","ol"],shortcutsBase:{"meta+z":"## shortcuts.meta-z ##","meta+shift+z":"## shortcuts.meta-shift-z ##","meta+a":"## shortcuts.meta-a ##"},shortcuts:{"ctrl+shift+o, meta+shift+o":{title:"## shortcuts.meta-shift-o ##",name:"meta+shift+o",command:"addbar.popup"},"ctrl+shift+d, meta+shift+d":{title:"## shortcuts.meta-shift-d ##",name:"meta+shift+d",command:"block.duplicate"},"ctrl+shift+up, meta+shift+up":{title:"## shortcuts.meta-shift-up ##",name:"meta+shift+&uarr;",command:"block.moveUp"},"ctrl+shift+down, meta+shift+down":{title:"## shortcuts.meta-shift-down ##",name:"meta+shift+&darr;",command:"block.moveDown"},"ctrl+shift+m, meta+shift+m":{title:"## shortcuts.meta-shift-m ##",name:"meta+shift+m",command:"inline.removeFormat"},"ctrl+b, meta+b":{title:"## shortcuts.meta-b ##",name:"meta+b",command:"inline.set",params:{tag:"b"}},"ctrl+i, meta+i":{title:"## shortcuts.meta-i ##",name:"meta+i",command:"inline.set",params:{tag:"i"}},"ctrl+u, meta+u":{title:"## shortcuts.meta-u ##",name:"meta+u",command:"inline.set",params:{tag:"u"}},"ctrl+h, meta+h":{title:"## shortcuts.meta-h ##",name:"meta+h",command:"inline.set",params:{tag:"sup"}},"ctrl+l, meta+l":{title:"## shortcuts.meta-l ##",name:"meta+l",command:"inline.set",params:{tag:"sub"}},"ctrl+alt+0, meta+alt+0":{title:"## shortcuts.meta-alt-0 ##",name:"meta+alt+0",command:"block.format",params:{tag:"p"}},"ctrl+alt+1, meta+alt+1":{title:"## shortcuts.meta-alt-1 ##",name:"meta+alt+1",command:"block.format",params:{tag:"h1"}},"ctrl+alt+2, meta+alt+2":{title:"## shortcuts.meta-alt-2 ##",name:"meta+alt+2",command:"block.format",params:{tag:"h2"}},"ctrl+alt+3, meta+alt+3":{title:"## shortcuts.meta-alt-3 ##",name:"meta+alt+3",command:"block.format",params:{tag:"h3"}},"ctrl+alt+4, meta+alt+4":{title:"## shortcuts.meta-alt-4 ##",name:"meta+alt+4",command:"block.format",params:{tag:"h4"}},"ctrl+alt+5, meta+alt+5":{title:"## shortcuts.meta-alt-5 ##",name:"meta+alt+5",command:"block.format",params:{tag:"h5"}},"ctrl+alt+6, meta+alt+6":{title:"## shortcuts.meta-alt-6 ##",name:"meta+alt+6",command:"block.format",params:{tag:"h6"}},"ctrl+shift+7, meta+shift+7":{title:"## shortcuts.meta-shift-7 ##",name:"meta+shift+7",command:"block.format",params:{tag:"ol"}},"ctrl+shift+8, meta+shift+8":{title:"## shortcuts.meta-shift-8 ##",name:"meta+shift+8",command:"block.format",params:{tag:"ul"}},"ctrl+], meta+]":{title:"## shortcuts.meta-indent ##",name:"meta+]",command:"list.indent"},"ctrl+[, meta+[":{title:"## shortcuts.meta-outdent ##",name:"meta+[",command:"list.outdent"},"ctrl+k, meta+k":{title:"## shortcuts.meta-k ##",name:"meta+k",command:"link.format"}},buttonsObj:{duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"},trash:{title:"## buttons.delete ##",command:"block.remove"},undo:{title:"## buttons.undo ##",command:"state.undo"},redo:{title:"## buttons.redo ##",command:"state.redo"},shortcut:{title:"## buttons.shortcuts ##",command:"shortcut.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},code:{title:"## buttons.code ##",command:"inline.set",params:{tag:"code"}},link:{title:"## buttons.link ##",command:"link.format"},mark:{title:"## buttons.mark ##",command:"inline.set",params:{tag:"mark"}},sub:{title:"## buttons.subscript ##",command:"inline.set",params:{tag:"sub"}},sup:{title:"## buttons.superscript ##",command:"inline.set",params:{tag:"sup"}},kbd:{title:"## buttons.shortcut ##",command:"inline.set",params:{tag:"kbd"}},text:{title:"## blocks.text ##",command:"block.add"},image:{title:"## blocks.image ##",command:"image.popup",observer:"image.observe"},embed:{title:"## blocks.embed ##",command:"embed.popup",observer:"embed.observe"},line:{title:"## blocks.line ##",command:"block.add",observer:"block.observe"},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe"},quote:{title:"## blocks.quote ##",command:"block.add",observer:"block.observe"},pre:{title:"## blocks.pre ##",command:"block.add",observer:"block.observe"}},formatObj:{p:{title:"## format.p ##",type:"paragraph",shortcut:"Ctrl+Alt+0"},h1:{title:'<span style="font-size: 20px; font-weight: bold;">## format.h1 ##</span>',type:"heading",shortcut:"Ctrl+Alt+1"},h2:{title:'<span style="font-size: 16px; font-weight: bold;">## format.h2 ##</span>',type:"heading",shortcut:"Ctrl+Alt+2"},h3:{title:'<span style="font-weight: bold;">## format.h3 ##</span>',type:"heading",shortcut:"Ctrl+Alt+3"},h4:{title:'<span style="font-weight: bold;">## format.h4 ##</span>',type:"heading",shortcut:"Ctrl+Alt+4"},h5:{title:'<span style="font-weight: bold;">## format.h5 ##</span>',type:"heading",shortcut:"Ctrl+Alt+5"},h6:{title:'<span style="font-weight: bold;">## format.h6 ##</span>',type:"heading",shortcut:"Ctrl+Alt+6"},ul:{title:"&bull; ## format.ul ##",type:"list",shortcut:"Ctrl+Shift+7"},ol:{title:"1. ## format.ol ##",type:"list",shortcut:"Ctrl+Shift+8"},address:{title:"<em>## format.address ##</em>",type:"address"}},markerChar:"\ufeff",tags:{denied:["font","html","head","link","title","body","meta","applet","marquee"],incode:["!DOCTYPE","!doctype","html","head","link","title","body","meta","textarea","style"],form:["form","input","button","select","textarea","legend","fieldset"],inline:["a","svg","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],block:["pre","hr","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","main","section","header","footer","aside","article","iframe"],parser:["pre","hr","ul","ol","p","h1","h2","h3","h4","h5","h6","table","address","blockquote","figure","iframe","form","dl","div","section","header","footer","article","main","aside"]},bsmodal:!1,regex:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w-\s])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/(http|https)?:\/\/(?:www.|player.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:\/[a-zA-Z0-9_-]+)?/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/gi}},RedactorX.lang.en={accessibility:{"help-label":"Rich text editor"},placeholders:{figcaption:"Type caption (optional)"},popup:{link:"Link",add:"Add",image:"Image","add-image":"Add Image"},shortcuts:{"meta-a":"Select all","meta-z":"Undo","meta-shift-z":"Redo","meta-shift-m":"Remove inline format","meta-b":"Bold","meta-i":"Italic","meta-u":"Underline","meta-h":"Superscript","meta-l":"Subscript","meta-k":"Link","meta-alt-0":"Normal text","meta-alt-1":"Heading 1","meta-alt-2":"Heading 2","meta-alt-3":"Heading 3","meta-alt-4":"Heading 4","meta-alt-5":"Heading 5","meta-alt-6":"Heading 6","meta-shift-7":"Ordered List","meta-shift-8":"Unordered List","meta-indent":"Indent","meta-outdent":"Outdent","meta-shift-backspace":"Delete","meta-shift-o":"Add","meta-shift-d":"Duplicate","meta-shift-up":"Move up","meta-shift-down":"Move down"},buttons:{add:"Add",html:"HTML",format:"Format",bold:"Bold",italic:"Italic",deleted:"Deleted",link:"Link",list:"List",image:"Image",indent:"Indent",outdent:"Outdent",embed:"Embed",table:"Table",insert:"Insert",save:"Save",cancel:"Cancel",delete:"Delete",duplicate:"Duplicate",shortcut:"Shortcuts",underline:"Underline",undo:"Undo",redo:"Redo",code:"Code",mark:"Mark",subscript:"Subscript",superscript:"Superscript",kbd:"Shortcut","image-settings":"Image settings","column-settings":"Column settings"},blocks:{text:"Text",paragraph:"Paragraph",image:"Image",embed:"Embed",line:"Line",table:"Table",quote:"Quote",pre:"Code",address:"Address"},format:{p:"Normal Text",h1:"Large Heading",h2:"Medium Heading",h3:"Small Heading",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",address:"Address",ul:"Unordered List",ol:"Ordered List"},embed:{embed:"Embed",caption:"Caption",description:"Paste any embed/html code or enter the url (vimeo or youtube video only)","responsive-video":"Responsive video"},image:{or:"or","alt-text":"Alt Text",link:"Link",caption:"Caption","link-in-new-tab":"Open link in new tab","url-placeholder":"Paste url of image...","upload-new-placeholder":"Drag to upload a new image<br>or click to select"},link:{link:"Link","edit-link":"Edit Link",unlink:"Unlink","link-in-new-tab":"Open link in new tab",text:"Text",url:"URL"},table:{width:"Width",nowrap:"Nowrap",column:"Column","add-head":"Add head","remove-head":"Remove head","add-row-below":"Add row below","add-row-above":"Add row above","remove-row":"Remove row","add-column-after":"Add column after","add-column-before":"Add column before","remove-column":"Remove column","delete-table":"Delete table"}};var App=function(t,e,i){for(var s=["keycodes","prefix","dom","ajax","_repository","_subscribe"],n=0;n<s.length;n++)this[s[n]]=$R[s[n]];this.uuid=i,this.$win=this.dom(window),this.$doc=this.dom(document),this.$body=this.dom("body"),this.$element=t,(this.app=this).initialSettings=e,this._initer=["setting","lang"],this._priority=["container","editor","state","accessibility"],this._plugins=[],this.started=!1,this.start()};App.prototype={start:function(t){this.isTextarea()&&(this.isStarted()||(t&&(this.initialSettings=t),this._initCore(),this._plugins=this.setting.get("plugins"),this.broadcast("app.before.start"),this._initModules(),this._initPlugins(),this._startPriority(),this._startModules(),this._startPlugins(),this.started=!0,this.broadcast("app.start"),this._loadModulesAndPlugins()))},isStarted:function(){return this.started},isTextarea:function(){return"TEXTAREA"===this.$element.get().tagName},stop:function(){this.isStopped()||(this.broadcast("app.before.stop"),this._stopPriority(),this._stopModules(),this._stopPlugins(),this.started=!1,this.broadcast("app.stop"))},isStopped:function(){return!this.started},broadcast:function(t,e){var i=e instanceof App.Event?e:new App.Event(t,e);if(void 0!==this._subscribe[t])for(var s=this._subscribe[t],n=0;n<s.length;n++){var a=this[s[n].module];a&&s[n].func.call(a,i)}var o=this.setting.has("subscribe")?this.setting.get("subscribe"):{};return"function"==typeof o[t]&&o[t].call(this,i),i},broadcastParams:function(t,e){return this.broadcast(t,e).getAll()},broadcastHtml:function(t,e){return this.broadcast(t,{html:e}).get("html")},create:function(t){void 0===this._repository[t]&&$R.error('The class "'+t+'" does not exist.');var e=[].slice.call(arguments,1),i=new this._repository[t].proto;i._name=t,i.app=this;for(var s,n=["uuid","prefix","dom","ajax"],a=0;a<n.length;a++)i[n[a]]=this[n[a]];return this.lang&&(i.lang=this.lang),this.opts&&(i.opts=this.opts),i.init&&(s=i.init.apply(i,e)),s||i},api:function(t){for(var e=[].slice.call(arguments,1),i=t.split("."),s=i.pop(),n=this,a=0;a<i.length;a++)n=n[i[a]];if(n&&"function"==typeof n[s])return n[s].apply(n,e)},_initCore:function(){for(var t=0;t<this._initer.length;t++)this[this._initer[t]]=this.create(this._initer[t]);this.setting&&(this.opts=this.setting.dump())},_initModules:function(){for(var t in this._repository)"module"===this._repository[t].type&&-1===this._initer.indexOf(t)&&(this[t]=this.create(t))},_initPlugins:function(){var t=this.setting.get("plugins");for(var e in this._repository)"plugin"===this._repository[e].type&&-1!==t.indexOf(e)&&(this[e]=this.create(e))},_startPriority:function(){for(var t=0;t<this._priority.length;t++)this._call(this[this._priority[t]],"start")},_startModules:function(){this._iterate("module","start")},_startPlugins:function(){this._iterate("plugin","start")},_stopPriority:function(){for(var t=this._priority.slice().reverse(),e=0;e<t.length;e++)this._call(this[t[e]],"stop")},_stopModules:function(){this._iterate("module","stop")},_stopPlugins:function(){this._iterate("plugin","stop")},_loadModulesAndPlugins:function(){this._iterate("module","load"),this._iterate("plugin","load")},_iterate:function(t,e){for(var i in this._repository){var s="module"===t?"load"===e||-1===this._priority.indexOf(i):-1!==this._plugins.indexOf(i);this._repository[i].type===t&&s&&this._call(this[i],e)}},_call:function(t,e){"function"==typeof t[e]&&t[e].apply(t)}},App.Event=function(t,e){this.name=t,this.params=void 0===e?{}:e,this.stopped=!1},App.Event.prototype={is:function(t){if(!Array.isArray(t))return this.get(t);for(var e=0;e<t.length;e++)if(this.params[t[e]])return!0},has:function(t){return void 0!==this.params[t]},getAll:function(){return this.params},get:function(t){return this.params[t]},set:function(t,e){this.params[t]=e},stop:function(){this.stopped=!0},isStopped:function(){return this.stopped}},RedactorX.add("mixin","block",{defaults:{id:{getter:"getId",setter:"setId"},html:{getter:"getHtml",setter:"setHtml"}},init:function(t){this.$block=t?this.dom(t):this.create(),this._build(),this._buildData(),this._render()},isBlock:function(){return!0},isEditable:function(){return void 0!==this.editable&&!0===this.editable},isFigcaption:function(){return"figcaption"===this.type},isSecondLevel:function(){return-1!==["quoteitem","row","cell"].indexOf(this.type)},isNested:function(){return-1!==["quote","table"].indexOf(this.type)},isFirstLevel:function(){return this.$block.attr("data-"+this.prefix+"-first-level")},isAllSelected:function(){return!this.isEditable()||this.app.selection.isAll(this.$block)},isEmpty:function(){var t=this.$block.text();return""===(t=this._cleanEmpty(t))},isCaretStart:function(){return"pre"===this.getType()?this.app.caret.is(this.$block,"start",!1,!1):!this.isEditable()||this.app.caret.is(this.$block,"start")},isCaretEnd:function(){return"pre"===this.getType()?this.app.caret.is(this.$block,"end",!1,!1):!this.isEditable()||this.app.caret.is(this.$block,"end")},isAllowedButton:function(t,e){var i=this.getType();if(void 0===e.blocks)return!0;var s=e.blocks;if(s.except&&-1!==s.except.indexOf(i))return!1;if(s.all){if(!0===s.all||"all"===s.all)return!0;if("editable"===s.all&&-1!==["heading","paragraph","list","address","quote","table"].indexOf(i))return!0;if("first-level"===s.all&&this.isFirstLevel())return!0;if("noneditable"===s.all&&-1!==["image","embed","layer","line"].indexOf(i))return!0}return!(!Array.isArray(s.types)||-1===s.types.indexOf(i))},getData:function(t){var e={};for(var i in this.data)e[i]=this[this.data[i].getter].apply(this);return t?e[t]:e},getOffset:function(){return this.$block.offset()},getType:function(){return this.type},getTag:function(){return!!this.$block&&this.$block.get().tagName.toLowerCase()},getBlock:function(){return this.$block},getHtml:function(){return this.$block.html()},getPlainText:function(){var t=this.$block.html();return this.app.content.getTextFromHtml(t,{nl:!0})},getOuterHtml:function(){return this.$block.get().outerHTML},getFirstLevel:function(){var t=this.$block.closest("[data-"+this.prefix+"-first-level]");return 0!==t.length&&t.dataget("instance")},getParent:function(t){t=t?"="+t:"";var e=this.$block.parent().closest("[data-"+this.prefix+"-type"+t+"]");return 0!==e.length&&e.dataget("instance")},getNext:function(t){t=t?"="+t:"";var e=this.$block.nextElement();return!(0===e.length||!e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getPrev:function(t){t=t?"="+t:"";var e=this.$block.prevElement();return!(0===e.length||!e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getChildFirst:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").first();return 0!==e.length&&e.dataget("instance")},getChildLast:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").last();return 0!==e.length&&e.dataget("instance")},getId:function(){return this.$block.attr("id")},getCaption:function(){var t=this.$block.find("figcaption");return 0!==t.length?t.html():""},setData:function(t){for(var e in t)this.data[e]&&this[this.data[e].setter].call(this,t[e])},setEmpty:function(){this.$block.html("")},setSelectAll:function(){this.isEditable()&&this.app.selection.select(this.$block)},setHtml:function(t){this.$block.html(t)},setId:function(t){""===t?this.$block.removeAttr("id"):this.$block.attr("id",t)},setCaption:function(t){if(""===t)this.$block.find("figcaption").remove();else{var e=this.$block.find("figcaption");0===e.length&&((e=this.dom("<figcaption>")).attr("data-placeholder",this.lang.get("placeholders.figcaption")),this.$block.append(e),this.app.create("block.figcaption",e)),e.html(t)}},setClassFromObj:function(t,e){this._removeObjClasses(t);var i=t[e];"none"===i&&!1===i||this.$block.addClass(i)},setCaret:function(t){this.app.caret.set(this.$block,t)},moveUp:function(){var t=this.getPrev();t&&this._move(t,"before")},moveDown:function(){var t=this.getNext();t&&this._move(t,"after")},remove:function(){this.$block.remove()},appendNext:function(){var t=this.getNext();if(t.isEmpty())t.remove();else{if(this.isEmpty())return this.remove(),void this.app.block.set(t,"start");var e=t.getHtml(),i=this.getType(),s=t.getType(),n=!0,a=!0;if("pre"===i&&"pre"!==s&&(e=t.getPlainText()),"list"===s)if("list"===i){var o=t.getBlock().children();this.$block.append(o),a=!(n=!1)}else e=this._appendListHtml(t.getBlock(),e),a=t.isEmpty();if(n){var r=this.app.selection.getTopInline();r&&this.app.caret.set(r,"after"),this.app.insertion.insertHtml(e,"start")}a&&t.remove()}},appendToPrev:function(){var t=this.getPrev();if(this.isEmpty())return this.remove(),void this.app.block.set(t,"end");if(t.isEmpty())t.remove();else{var e=t.getType(),i=this.getHtml(),s=this.getType(),n=!0,a=!0;if("pre"!==s&&"pre"===e&&(i=this.getPlainText()),"list"===s)if("list"===e){var o=this.getBlock().children();this.app.block.set(t,"end"),t.getBlock().append(o),a=!(n=!1)}else i=this._appendListHtml(this.getBlock(),i),a=this.isEmpty();if(n){this.app.block.set(t,"end");var r=this.app.selection.getTopInline();r&&this.app.caret.set(r,"after"),this.app.insertion.insertHtml(i,"start")}a&&this.remove()}},addEmpty:function(t){return(t=t||{}).instance=this.app.block.create(),this.add(t)},add:function(t){var e=$R.extend({},{instance:!1,position:"after",caret:!1},t),i=e.instance.getBlock();return"list"===e.instance.getType()&&"list"===this.getType()?this.app.insertion.insertListToList(i,this.$block,e.caret):(this.$block[e.position](i),this.isEditable()&&this.isEmpty()&&this.remove()),this.app.editor.build(),e.caret&&this.app.block.set(e.instance,e.caret),this.app.toolbar.observe(),this.app.context.observe(),this.app.broadcast("block.add",{instance:e.instance}),e.instance},change:function(t,e){var i=t.getBlock();this.$block.after(i),this.$block.remove(),this.app.editor.build(),this.app.block.set(t),!1!==e&&this.app.broadcast("block.change",{instance:t})},duplicate:function(){var t=this.getType(),e=this.$block.clone();return e.removeClass(this.prefix+"-block-focus"),this.app.create("block."+t,e)},_build:function(){this.build&&this.build()},_buildData:function(){this.data||(this.data={}),this.data=$R.extend({},!0,this.defaults,this.data)},_buildItems:function(t,e){var i=this.$block.find(t);0!==i.length&&i.each(function(t){this.app.create("block."+e,t)}.bind(this))},_buildCaption:function(){"figure"===this.getTag()&&this.$block.find("figcaption").attr("data-placeholder",this.lang.get("placeholders.figcaption"))},_render:function(){this._renderEdit()},_renderEdit:function(){this.$block.dataset("instance",this),this.$block.attr("data-"+this.prefix+"-type",this.getType()),void 0!==this.editable&&!1===this.editable?this.$block.attr("contenteditable",!1):"figcaption"===this.type&&this.$block.attr("contenteditable",!0)},_cleanEmpty:function(t){return t=(t=-1!==(t=this.app.utils.removeInvisibleChars(t)).search(/^<br\s?\/?>$/)?"":t).replace(/\n/g,"")},_appendListHtml:function(t,e){var i=t.find("li").first();return e=(e=(e=i.html().trim()).replace(/<\/li>/gi,"</li><br>")).replace(/<(ul|ol)/gi,"<br><$1"),e=(e=(e=this.app.content.removeTags(e,["ul","ol","li"])).trim()).replace(/<br\s?\/?>$/gi,""),i.remove(),e},_move:function(t,e){var i=this;i.isNested()&&(i=i.getFirst()),(this.isEditable()||this.isNested())&&this.app.selection.save(i.getBlock()),t.getBlock()[e](this.$block),this.app.block.set(i,!1,!0),(this.isEditable()||this.isNested())&&this.app.selection.restore(!1)},_removeObjClasses:function(t){var e=this._buildObjClasses(t);this.$block.removeClass(e.join(" ")),this.app.element.removeEmptyAttrs(this.$block,["class"])},_buildObjClasses:function(t){var e=[];for(var i in t)t[i]&&e.push(t[i]);return e}}),RedactorX.add("mixin","tool",{init:function(t,e,i,s){this.name=t,this.setter=i.get("setter"),this.popup=i,this.data=s,this.obj=this._observe(e),this.obj&&this._build()},getElement:function(){return this.$tool},getInput:function(){return this.$input},getValue:function(){return this.$input.val().trim()},setValue:function(t){this.$input.val(t)},setFocus:function(){this.$input.focus()},trigger:function(t){this.setValue(t),this.setter&&this.app.api(this.setter,this.popup)},_build:function(){this._buildTool(),this._buildLabel(),this._buildInputElement(),this._buildInput(),this._buildEvent(),this._has("placeholder")&&this.$input.attr("placeholder",this.lang.parse(this.obj.placeholder)),this._has("width")&&this.$input.css("width",this.obj.width),this._has("classname")&&this.$input.addClass(this.obj.classname)},_buildInputElement:function(){this.$input=this.dom("<"+this._getInputParam("tag")+">").addClass(this.prefix+this._getInputParam("classname")),this.$input.attr({name:this.name,type:this._getInputParam("type"),"data-type":this.type}),this.$input.dataset("instance",this)},_buildInput:function(){},_buildEvent:function(){if(-1===["segment"].indexOf(this.type)&&this.setter){var t="checkbox"===this.type||"select"===this.type?"change":"keydown blur";this.$input.on(t,this._catchSetter.bind(this))}},_buildTool:function(){this.$tool=this.dom("<div>").addClass(this.prefix+"-form-item").dataset("instance",this)},_buildLabel:function(){"checkbox"!==this.type&&this._has("label")&&(this.$label=this.dom("<label>").addClass(this.prefix+"-form-label").html(this.lang.parse(this.obj.label)),this.$tool.append(this.$label))},_getInputParam:function(t){return this.input&&void 0!==this.input[t]?this.input[t]:""},_get:function(t){return this.obj[t]},_has:function(t){return this.obj.hasOwnProperty(t)},_observe:function(t){return t.hasOwnProperty("observer")&&(t=this.app.api(t.observer,t,this.name)),t},_catchSetter:function(t){"keydown"===t.type&&13!==t.which||("keydown"===t.type&&t.preventDefault(),this.app.api(this.setter,this.popup))}}),RedactorX.add("module","lang",{init:function(){this.langKey=this.app.setting.get("editor.lang"),this.vars=this._build()},get:function(t){var e=this._get(t,this.vars);return void 0===e&&"en"!==this.langKey&&(e=this._get(t,$R.lang.en)),void 0===e?"":e},parse:function(t){if("string"!=typeof t)return t;var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var s=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(s))}return t},_get:function(t,e){var i=t.split(".");return 1===i.length?e[t]:void 0!==e[i[0]]?e[i[0]][i[1]]:void 0},_build:function(){var t=$R.lang.en;return"en"!==this.langKey&&(t="undefined"!==$R.lang[this.langKey]?$R.lang[this.langKey]:t),t}}),RedactorX.add("module","setting",{init:function(){this.opts=this._build()},dump:function(){return this.opts},has:function(t){var e=t.split(".");return 1===e.length?void 0!==this.opts[t]:void 0!==this.opts[e[0]]&&void 0!==this.opts[e[1]]},set:function(t,e,i){void 0===this.opts[t]&&(this.opts[t]={}),void 0===i?this.opts[t]=e:this.opts[t][e]=i},get:function(t){var e=t.split(".");return 1===e.length?this.opts[t]:void 0!==this.opts[e[0]]?this.opts[e[0]][e[1]]:void 0},_build:function(){var t=$R.extend(!0,{},$R.opts,this.app.initialSettings);return t=$R.extend(!0,t,$R.settings)}}),RedactorX.add("module","container",{init:function(){this.containers=["toolbar","editor","source","statusbar"],this.blurclass=this.prefix+"-in-blur",this.focusclass=this.prefix+"-in-focus"},start:function(){this._buildMain(),this._buildContainers(),this._buildBSModal()},stop:function(){this.$main.remove()},get:function(t){return this["$"+t]},setFocus:function(){this.$main.removeClass(this.blurclass).addClass(this.focusclass)},setBlur:function(){this.$main.removeClass(this.focusclass).addClass(this.blurclass)},isFocus:function(){return this.$main.hasClass(this.focusclass)},_buildMain:function(){this.$main=this.dom("<div>").attr(this.prefix+"-uuid",this.uuid),this.$main.addClass(this.prefix+"-container "+this.prefix+"-container-"+this.uuid),this.app.$element.after(this.$main)},_buildContainers:function(){for(var t=0;t<this.containers.length;t++){var e=this.containers[t],i="$"+e;this[i]=this._createContainer(e),this.$main.append(this[i])}},_buildBSModal:function(){this.opts.bsmodal=0!==this.$main.closest(".modal-dialog").length},_createContainer:function(t){return this.dom("<div>").addClass(this.prefix+"-"+t+"-container")}}),RedactorX.add("module","editor",{start:function(){this._buildEditor(),this._buildBlurClass(),this._buildOptions(),this._buildContent()},stop:function(){this.app.$element.show()},load:function(){this._setFocusOnStart()},build:function(){this.app.blocks.build(),this.app.embed.build(),this.app.image.observeStates()},isEditor:function(t){return this.dom(t).get()===this.$editor.get()},isTextarea:function(){return!1===this.opts.content},isFocus:function(){return this.app.container.isFocus()},isAllSelected:function(){return this._classSelect("has")},isEmpty:function(t){return this.app.content.isEmptyHtml(this.$editor.html(),t)},addButton:function(t,e){this.opts.buttons.editor[t]=e},selectAll:function(t){this.isAllSelected()||(this._classSelect("add"),this.app.block.unset(),this.app.blocks.unset(),this.app.selection.select(),this.app.toolbar.build(),this.app.control.close(),this.app.context.close())},unselectAll:function(){this.isAllSelected()&&(this.unsetSelectAll(),this.app.block.unset(),this.app.blocks.unset())},unsetSelectAll:function(){this._classSelect("remove")},observeBlocks:function(t){this.blocks=[];var e=this.app.blocks.getSelectedBlock(t);this.app.editor.setFocus();var i=this.app.blocks.getSelectedBlocks();1===i.length?this.app.block.set(e):this.app.selection.isAll()?this.app.editor.selectAll():1<i.length?(this.app.block.unset(),this.app.blocks.set(i),this.app.toolbar.build()):this.app.block.set(e)},insertContent:function(t){this.app.insertion.insertContent(t)},setContent:function(t){this.app.insertion.setContent(t)},setEmpty:function(){this.app.insertion.setContent({html:""})},setFocus:function(t){if(t){var e=!0===t?"start":t,i="start"===e?this.app.blocks.getFirst():this.app.blocks.getLast();this.app.block.set(i,e)}else{if(this.isFocus())return;for(var s=0;s<$R.instances.length;s++)$R.instances[s]!==this.app&&$R.instances[s].editor.setBlur();this.app.container.setFocus(),this.app.broadcast("editor.focus")}},setBlur:function(t){this.isFocus()&&(this.app.broadcast("editor.before.blur",{e:t}).isStopped()?t&&t.preventDefault():(this.app.container.setBlur(),this.app.selection.removeAllRanges(),this.app.block.unset(),this.app.blocks.unset(),this.app.popup.close(!1),this.app.context.close(),this.app.control.close(),this.app.toolbar.build(),this.app.broadcast("editor.blur",{e:t})))},getContent:function(t){var e="";return e=this.app.source.is()?this.app.source.getContent():(e=this._getContent(),t?this.app.tidy.parse(e):e)},getEditor:function(){return this.$editor},getRect:function(){var t=this.$editor.offset(),e=this.$editor.width(),i=this.$editor.height(),s=Math.round(t.top),n=Math.round(t.left);return{top:s,left:n,bottom:s+i,right:n+e,width:e,height:i}},_buildEditor:function(){this.app.$element.hide(),this.$editor=this.dom("<div>"),this.$editor.addClass(this.prefix+"-editor "+this.prefix+"-reset "+this.prefix+"-"+this.opts.editor.classname),this.$editor.attr("contenteditable",!0),this.app.container.get("editor").append(this.$editor)},_buildBlurClass:function(){this.app.container.setBlur()},_buildOptions:function(){var t=this.$editor,e=this.opts.editor;t.attr("dir",e.direction),e.minHeight&&t.css("min-height",e.minHeight),e.maxHeight&&t.css("max-height",e.maxHeight),e.notranslate&&t.addClass("notranslate"),e.spellcheck||t.attr("spellcheck",!1),e.grammarly||t.attr("data-gramm_editor",!1)},_buildContent:function(){var t=this._getContentValue();t=this.app.broadcastHtml("editor.before.load",t);var e=this.app.parser.parse(t);this.$editor.html(e.children());var i=this.app.parser.unparse(this.$editor.html());this.app.$element.val(i),this._load()},_buildDraggable:function(){this.app.$body.find("[data-"+this.prefix+"-drop-id]").each(function(t){t.attr("draggable",!0),t.on("dragstart",function(t){var e=this.dom(t.target).attr("data-"+this.prefix+"-drop-id");t.dataTransfer.setData("item",e)}.bind(this))}.bind(this))},_load:function(){this.app.blocks.build(),this.app.event.build(),this.app.observer.build(),this.app.embed.build(),this.app.sync.build(),this.app.image.observeStates(),this._buildDraggable(),this.app.broadcast("editor.load")},_getContent:function(){var t=this.$editor.html();return t=this.app.parser.unparse(t)},_getContentValue:function(){return this.opts.content?this.opts.content:this.app.$element.val()},_setFocusOnStart:function(){this.opts.editor.focus&&(this.setFocus(),this.setFocus(this.opts.editor.focus))},_classSelect:function(t){return this.$editor[t+"Class"](this.prefix+"-select-all")}}),RedactorX.add("module","accessibility",{start:function(){this._buildRole(),this._buildLabel()},_buildRole:function(){this.app.editor.getEditor().attr({"aria-labelledby":this.prefix+"-voice",role:"presentation"})},_buildLabel:function(){var t=this.lang.get("accessibility.help-label"),e=this._createLabel(t);this.app.container.get("main").prepend(e)},_createLabel:function(t){var e=this.dom("<span />").addClass(this.prefix+"-voice-label");return e.attr({id:this.prefix+"-voice-"+this.uuid,"aria-hidden":!1}),e.html(t),e}}),RedactorX.add("module","element",{is:function(t,e,i){var s=!1,n="text"===e?t:this._getNode(t);return"inline"===e?s=this._isElement(n)&&this._isInlineTag(n.tagName,i):"blocks"===e?s=this._isElement(n)&&n.hasAttribute("data-"+this.prefix+"-type"):"blocks-first"===e?s=this._isElement(n)&&n.hasAttribute("data-"+this.prefix+"-first-level"):"block"===e?s=this._isElement(n)&&this._isBlockTag(n.tagName,i):"element"===e?s=this._isElement(n):"text"===e?s="string"==typeof n&&!/^\s*<(\w+|!)[^>]*>/.test(n)||this.isTextNode(n):"list"===e?s=this._isElement(n)&&-1!==["ul","ol"].indexOf(n.tagName.toLowerCase()):"heading"===e&&(s=this._isElement(n)&&-1!==["h1","h2","h3","h4","h5","h6"].indexOf(n.tagName.toLowerCase())),s},isEmptyOrImageInline:function(t){var e=this.dom(t).get();if(!e||3===e.nodeType)return!1;var i=e.tagName.toLowerCase(),s="false"===e.getAttribute("contenteditable"),n=this.is(e,"inline");return!!(n&&this.isEmpty(e)||n&&s||-1!==["svg","img"].indexOf(i))},isEmpty:function(t){var e=this._getNode(t);return!!e&&(3===e.nodeType?""===e.textContent.trim().replace(/\n/,""):""===e.innerHTML)},isTag:function(t,e){return this._getNode(t).tagName.toLowerCase()===e},isTextNode:function(t){var e=this._getNode(t);return e&&e.nodeType&&3===e.nodeType},getFirstLevel:function(t){return this.dom(t).closest("[data-"+this.prefix+"-first-level]")},getDataBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},getType:function(t){return this.dom(t).attr("data-"+this.prefix+"-type")},getAllInlines:function(t){for(var e=[],i=t;i;)this.is(i,"inline")&&e.push(i),i=i.parentNode;return e},replaceToTag:function(t,n){return this.dom(t).replaceWith(function(t){var e=this.dom("<"+n+">").append(t.innerHTML);if(t.attributes)for(var i=t.attributes,s=0;s<i.length;s++)e.attr(i[s].nodeName,i[s].value);return e}.bind(this))},split:function(t){var e=this.dom(t),i=(t=e.get()).tagName.toLowerCase(),s=this.app.content.extractHtmlFromCaret(t);s.nodeType&&11===s.nodeType&&(s=this.dom(s.childNodes));var n=this.dom("<"+i+" />");(n=this.cloneAttrs(t,n)).append(s),e.after(n);var a=e.children().last();if(this.is(a,"inline")){var o=a.html();""===(o=this.app.utils.removeInvisibleChars(o))&&a.remove()}var r=this.getType(n);return r&&this.app.create("block."+r,n,!0),""===e.html()&&e.remove(),n},cloneEmpty:function(t){var e=this.dom(t).get().tagName.toLowerCase();return this.dom("<"+e+">")},cloneAttrs:function(t,e){for(var i=this.dom(e),s=this._getNode(t).attributes,n=s.length;n--;){var a=s[n];i.attr(a.name,a.value)}return i},getAttrs:function(t){var e=this._getNode(t),i={};if(null!=e.attributes&&e.attributes.length)for(var s=0;s<e.attributes.length;s++){var n=e.attributes[s].nodeValue;n=this._isNumber(n)?parseFloat(n):this._getBooleanFromStr(n),i[e.attributes[s].nodeName]=n}return i},removeEmptyAttrs:function(t,e){var i=this.dom(t),s=e.join(" "),n=!1;return void 0===i.attr(s)||null===i.attr(s)?n=!0:""===i.attr(s)&&(i.removeAttr(s),n=!0),n},getBlocks:function(t,e,i){var s=this._getNode(t).childNodes,n=[],a=e||this.opts.tags.parser;i&&(a=this.app.utils.extendArray(a,i));for(var o=0;o<s.length;o++)1===s[o].nodeType&&-1!==a.indexOf(s[o].tagName.toLowerCase())&&n.push(s[o]);return n},hasBlocks:function(t){return 0!==this.getBlocks(t).length},hasTextSiblings:function(t){var e=this._getNode(t),i=e.previousSibling&&3===e.previousSibling.nodeType&&!this.isEmpty(e.previousSibling),s=e.nextSibling&&3===e.nextSibling.nodeType&&!this.isEmpty(e.nextSibling);return i||s},_getNode:function(t){return this.dom(t).get()},_getBooleanFromStr:function(t){return"true"===t||"false"!==t&&t},_isBlockTag:function(t,e){return-1!==this.app.utils.extendArray(this.opts.tags.block,e).indexOf(t.toLowerCase())},_isInlineTag:function(t,e){return-1!==this.app.utils.extendArray(this.opts.tags.inline,e).indexOf(t.toLowerCase())},_isElement:function(t){return t&&t.nodeType&&1===t.nodeType},_isTag:function(t){return void 0!==t&&t},_isNumber:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))}}),RedactorX.add("module","parser",{build:function(t){return this.$layout=this.dom("<div>"),this.$layout.html(t),this.$layout.find("[data-"+this.prefix+"-type]").each(this._build.bind(this)),this.$layout},parse:function(t,e){return t=t.trim(),t=this.app.broadcastHtml("editor.before.parse",t),t=this.app.content.isEmptyHtml(t)?this.app.block.createHtml():(t=this._clean(t),this._parse(t)),t=this.app.broadcastHtml("editor.parse",t),!1!==e?this.build(t):t},parseLine:function(t,e){return t=" "===t?"&nbsp;":(t=(t=this.app.broadcastHtml("editor.before.parse",t)).replace(/\r?\n/g,"<br>"),t=this.app.content.encodeCode(t),t=this.app.content.sanitize(t),t=this.app.content.removeEmptySpans(t),t=this.app.content.addHttps(t),this.app.broadcastHtml("editor.parse",t)),!1!==e?this.build(t):t},unparse:function(t){var e={};return t=t.trim(),t=this.app.broadcastHtml("editor.before.unparse",t),this.app.content.isEmptyHtml(t)?"":(t=this._revertForms(t),t=this._revertFrames(t),t=this.app.content.store(t,"embed",e,0),t=this.app.content.addNofollow(t),t=this.app.content.removeMarkers(t),t=this.app.content.recacheStyle(t),t=this.app.content.restore(t,"embed",e),t=this.app.content.removeEmptyAttrs(t,["style","class","rel","alt","title"]),t=this._unparseAllTags(t),t=this._unparseDataType(t),"<p></p>"===(t=this.app.content.removeEmptyAttrs(t,["style","class","rel","alt","title"]))&&(t=""),this.app.broadcastHtml("editor.unparse",t))},_build:function(t){var e=t.attr("data-"+this.prefix+"-type");this.app.create("block."+e,t)},_clean:function(t){var e={},i=[];return t=this.app.content.storeComments(t,i),this.app.editor.isTextarea()&&(t=this.app.content.encodeCode(t)),t=this.app.content.sanitize(t),t=this._convertForms(t),t=this._convertFrames(t),t=this.app.content.store(t,"embed",e,0),t=this.app.content.removeTags(t,this.opts.tags.denied),t=this.app.content.removeDoctype(t),t=this.app.content.removeTagsWithContent(t,["script","style"]),this.opts.clean.comments&&(t=this.app.content.removeComments(t)),t=this.app.content.removeEmptySpans(t),t=this.app.content.addHttps(t),t=this.app.content.removeBlockTagsInside(t,["th","td","li","dt","dd","address"]),t=this.app.content.cacheStyle(t),t=this.app.content.restore(t,"embed",e),t=this.app.content.restoreComments(t,i),t=this.app.content.isEmptyHtml(t)?this.app.block.createHtml():this.app.content.paragraphize(t)},_parse:function(t){return this.app.utils.wrap(t,function(t){for(var e=this.app.element.getBlocks(t),i=0;i<e.length;i++)this._parseHtml(e[i]);this.opts.classes&&t.find(this._getPredefinedTags().join(",")).each(this._addPredefinedClass.bind(this))}.bind(this))},_parseHtml:function(t){var e=t.tagName.toLowerCase(),i=this.dom(t),s=this._parseType(i,e);s&&i.attr("data-"+this.prefix+"-type",s)},_parseType:function(t,e){return t.attr("data-"+this.prefix+"-type")?t.attr("data-"+this.prefix+"-type"):this._parseTypeByTag(t,e)},_parseTypeByTag:function(t,e){var i;switch(e){case"p":i="paragraph",this._isImageBlock(t,"p")&&(i="image");break;case"figure":i="embed",this._isImageBlock(t,"figure")?i="image":this._hasChild(t,"pre")?i="pre":this._hasChild(t,"blockquote")&&(i="quote");break;case"div":i="layer",this._isImageBlock(t,"div")&&(i="image");break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":i="heading";break;case"blockquote":i="quote";break;case"table":i="table";break;case"pre":i="pre";break;case"hr":i="line";break;case"address":i="address";break;case"ul":case"ol":i="list";break;default:i="layer"}return i},_isImageBlock:function(t,e){var i=t.find("img");if(0!==i.length&&("div"!==e||0===i.closest("figure").length)){var s=i,n=i.parent(),a=0!==n.length&&n.get().tagName;if(!a||"A"!==a&&"SPAN"!==a){if(a&&n.get()!==t.get())return}else s=n;if(0===s.prevElement().length&&("figure"===e||0===s.nextElement().length))return!0}},_hasChild:function(t,e){if("pre"===e){if(0!==t.find("pre").length)return!0}else if("blockquote"===e){var i=t.find("blockquote");if(0===t.find("script").length&&0!==i.length)return!0}},_getPredefinedTags:function(){var t=[];for(var e in this.opts.classes)t.push(e);return t},_addPredefinedClass:function(t){var e=t.get().tagName.toLowerCase();void 0!==this.opts.classes[e]&&t.addClass(this.opts.classes[e])},_unparseAllTags:function(t){return this.app.utils.wrap(t,function(t){t.find("*").removeAttr("contenteditable data-gramm_editor"),this.opts.image.states||t.find("img").removeAttr("data-image")}.bind(this))},_unparseDataType:function(t){return this.app.utils.wrap(t,function(t){var e=t.find("[data-"+this.prefix+"-type]");e.removeAttr("tabindex data-"+this.prefix+"-parsed data-"+this.prefix+"-first-level"),e.removeClass(this.prefix+"-block-focus "+this.prefix+"-block-multiple-focus "+this.prefix+"-block-multiple-hover "+this.prefix+"-editable-pause"),e.removeClass(this.prefix+"-nowrap"),e.each(this._unparseByType.bind(this)),e.removeAttr("data-"+this.prefix+"-type"),t.find("figcaption").removeAttr("data-"+this.prefix+"-type data-placeholder").each(this.app.content._removeEmptyTag.bind(this))}.bind(this))},_unparseByType:function(t){var e=t.attr("data-"+this.prefix+"-type");"embed"===e?this._unparseEmbed(t):"list"===e&&this._unparseList(t)},_unparseEmbed:function(t){var e,i=decodeURI(t.attr("data-embed-code")),s=t.find("."+this.opts.embed.responsive),n=t.find("figcaption");0!==n.length&&(e=n.clone(),n.remove()),0===s.length?t.html(i):s.html(i),e&&t.append(e),t.removeAttr("data-embed-code")},_unparseList:function(t){this.app.content.unfixListMargin(t)},_convertFrames:function(t){return this.app.utils.wrap(t,function(t){t.find("iframe").each(this._convertFrame.bind(this))}.bind(this))},_convertFrame:function(t){0===t.closest("figure").length&&(t.wrap("<figure>"),t.parent().addClass(this.prefix+"-figure-iframe"))},_convertForms:function(t){return this.app.utils.wrap(t,function(t){t.find("form").each(this._convertForm.bind(this))}.bind(this))},_convertForm:function(t){this.app.element.replaceToTag(t,"div").addClass(this.prefix+"-div-form")},_revertFrames:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-figure-iframe").each(this._revertFrame.bind(this))}.bind(this))},_revertFrame:function(t){0!==t.find("figcaption").length?t.removeClass(this.prefix+"-figure-iframe"):t.unwrap()},_revertForms:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-div-form").each(this._revertForm.bind(this))}.bind(this))},_revertForm:function(t){this.app.element.replaceToTag(t,"form").removeClass(this.prefix+"-div-form")}}),RedactorX.add("module","content",{init:function(){this._selectors={code:["pre","code"],embed:["figure"],images:["img"],links:["a"]}},paragraphize:function(t){return this.app.paragraphizer.paragraphize(t)},encodeEntities:function(t){return this.decodeEntities(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodeCode:function(t){return t=(t=(t=(t=(t=t.replace(/<(.*?)>/gi,"xtagstartz$1xtagendz")).replace(/xtagstartzpre(.*?)xtagendz/g,"<pre$1>")).replace(/xtagstartzcode(.*?)xtagendz/g,"<code$1>")).replace(/xtagstartz\/codextagendz/g,"</code>")).replace(/xtagstartz\/prextagendz/g,"</pre>"),t=(t=(t=this._encodeCode(t)).replace(/xtagstartz(.*?)xtagendz/g,"<$1>")).replace(/xtagstartz\/(.*?)xtagendz/g,"</$1>")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},sanitize:function(t){return t=this.app.utils.wrap(t,function(t){t.find("[src]").each(this._sanitizeSrc),t.find("a").each(this._sanitizeHref),t.find("a,b,i,svg,img,details").each(this._sanitizeEvents)}.bind(this))},escapeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},store:function(t,e,i,s){for(var n=this._selectors[e],a=0;a<n.length;a++){var o=this._getElementsFromHtml(t,n[a]);t=this._store(t,e,o,i,s)}return t},restore:function(t,e,i){if(void 0===i[e])return t;for(var s=0;s<i[e].length;s++)t=t.replace("####_"+e+s+"_####",i[e][s]);return t},storeComments:function(t,e){var i=t.match(new RegExp("\x3c!--([\\w\\W]*?)--\x3e","gi"));if(null===i)return t;for(var s=0;s<i.length;s++)t=t.replace(i[s],"#####xstarthtmlcommentzz"+s+"xendhtmlcommentzz#####"),e.push(i[s]);return t},restoreComments:function(t,e){for(var i=0;i<e.length;i++){var s=e[i].replace(/\$/gi,"&#36;");t=t.replace("#####xstarthtmlcommentzz"+i+"xendhtmlcommentzz#####",s)}return t},cacheStyle:function(t){var e=this.opts.tags.block.join(",")+",img,"+this.opts.tags.inline.join(",");return this.app.utils.wrap(t,function(t){t.find(e).each(this._cacheStyle.bind(this))}.bind(this))},recacheStyle:function(t){return this.app.utils.wrap(t,function(t){t.find("[data-"+this.prefix+"-style-cache]").each(this._recacheStyle.bind(this))}.bind(this))},fixListMargin:function(t){var e=parseInt(t.css("margin-left"));if(0!==e){var i=parseInt(t.css("padding-left"));t.css({"margin-left":0,"padding-left":i+e+"px"}),t.attr(this.prefix+"-list-left",e)}},unfixListMargin:function(t){t.attr(this.prefix+"-list-left")&&(t.css({"padding-left":"","margin-left":""}),t.removeAttr(this.prefix+"-list-left"))},addNofollow:function(t){return this.opts.link.nofollow?this.app.utils.wrap(t,function(t){t.find("a").attr("rel","nofollow")}):t},addHttps:function(t){return this.opts.editor.https?t=(t=(t=t.replace('href="http://','href="https://')).replace('src="http://','src="https://')).replace('srcset="http://','srcset="https://'):t},addSpaceToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1> ")},addBrToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1><br>")},getText:function(t){var e="";if(3===t.nodeType)e=t.nodeValue;else{for(var i=0;i<t.childNodes.length;i++)e+=this.getText(t.childNodes[i]);var s=1===t.nodeType?getComputedStyle(t).getPropertyValue("display"):"";(s.match(/^block/)||s.match(/list/)||"BR"===t.tagName||"HR"===t.tagName)&&(e+="\n")}return e},getTextFromHtml:function(t,e){var i={};e=$R.extend({},{br:!1,nl:!1,trimlines:!0,images:!1,links:!1},e),t=this.store(t,"code",i,0),t=e.links?this.store(t,"links",i,0):t,t=(t=(t=(t=(t=(t=(t=(t=(t=e.images?this.store(t,"images",i,0):t).replace(/<(ul|ol)>\s+<li>/gi,"<$1><li>")).replace(/<li[^>]*>\n/gi,"<li$1>")).replace(/<p[^>]*>(\s+|)<\/p>/gi,"xemptyz")).replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<script[\s\S]*?script>/gi,"")).replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1>\n")).replace(/&(lt|gt);/gi,"x$1z");var s=this.dom("<div>").html(t);if(t=this.getText(s.get()),e.trimlines){for(var n="",a=t.split("\n"),o=0;o<a.length;o++)n+=a[o].trim()+"\n";t=n}return t=(t=(t=t.replace(/[\n]+/g,"\n")).replace("xemptyz","\n")).replace(/x(lt|gt)z/gi,"&$1;"),t=e.br?(t=t.replace(/\n/g,"<br>\n")).replace(/<br\s?\/?>\n?$/gi,""):e.nl?t:t.replace(/\n/gi," "),t=this.restore(t,"code",i),t=e.links?this.restore(t,"links",i):t,t=(t=(t=(t=(t=e.images?this.restore(t,"images",i):t).replace(/<pre[^>]*>/g,"")).replace(/<code[^>]*>/g,"")).replace(/<\/pre>\n?/g,"")).replace(/<\/code>/g,""),e.images||(t=(t=t.replace(/<img[\s\S]*?>/gi,"")).replace(/<a[^>]*>(\s+|)<\/a>/gi,"")),t.trim()},extractHtmlFromCaret:function(t){var e=this.dom(t).get(),i=this.app.selection.getRange();if(i){var s=i.cloneRange();return s.selectNodeContents(e),s.setStart(i.endContainer,i.endOffset),s.extractContents()}},isEmptyHtml:function(t,e){return t=t.trim(),t=(t=(t=(t=(t=(t=(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/^&nbsp;$/gi,"1")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>\s\S<\/p>$/i,"")).replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source"),t=this.removeComments(t),""===(t=(t=(t=(t=e?t.replace(/<p[^>]*><\/p>/gi,""):t).replace(/<[^/>]><\/[^>]+>/gi,"")).replace(/<[^/>]><\/[^>]+>/gi,"")).trim())},isLine:function(t){var e=document.createElement("div");return e.innerHTML=t,0===this.dom(e).find(this.opts.tags.block.join(",")+",img").length},drop:function(t,e,i,s){var n="after"===i?"getFirstLevel":"getDataBlock",a=this.app.element[n](t.target);a=0===a.length?this.app.blocks.getFirst():a,this.app.block.set(a),i||this.app.insertion.insertPoint(t);var o=!0,r=!0,p=this.app.block.get(),l=this.app.editor.isAllSelected();if(p&&"pre"===p.getType()&&!l&&(r=o=!1,e=this.getTextFromHtml(e,{nl:!0,trimlines:!1})),!1===s&&(o=!1,e=this.app.autoparse.parse(e)),""!==e)return e=o?this.app.autoparse.parse(e):e,this.app.insertion.insertContent({html:e,clean:o,parse:r,position:i})},paste:function(t){if(this.app.broadcast("editor.before.paste",{e:t}).isStopped())return t.preventDefault();t.preventDefault();var e=t.clipboardData;if(!this.app.image.insertFromClipboard(e)){var i=e.getData("URL"),s=this.app.clipboard.getContent(e);s=i&&""!==i?i:s;var n=this.app.block.get(),a=!0,o=!0,r=this.app.editor.isAllSelected();if(this.opts.paste.plaintext?(o=a=!1,s=this.getTextFromHtml(s,{br:!0})):n&&"pre"===n.getType()&&!r&&(o=a=!1,s=this.getTextFromHtml(s,{nl:!0,trimlines:!1})),""!==s){s=a?this.app.autoparse.parse(s):s;var p=this.app.insertion.insertContent({html:s,clean:a,parse:o});this.app.broadcast("editor.paste",p)}}},copy:function(t){this._copy(t,"copy")},cut:function(t){this._copy(t,"cut")},removeDoctype:function(t){return t.replace(new RegExp("<!doctype[^>]*>","gi"),"")},removeComments:function(t){return t.replace(/<!--[\s\S]*?-->\n?/g,"")},removeTags:function(t,i){var e=i?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,s=i?function(t,e){return-1===i.indexOf(e.toLowerCase())?t:""}:"";return t.replace(e,s)},removeTagsExcept:function(t,i){if(void 0===i)return t.replace(/(<([^>]+)>)/gi,"");return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,e){return-1===i.indexOf(e.toLowerCase())?"":t})},removeTagsWithContent:function(t,e){return this.app.utils.wrap(t,function(t){t.find(e.join(",")).remove()})},removeMarkers:function(t){return this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-plus-button").remove(),t.find("."+this.prefix+"pastemarker").removeClass(this.prefix+"pastemarker"),t.find("."+this.prefix+"pasteitems").removeClass(this.prefix+"pasteitems"),t.find("."+this.prefix+"-selection-marker").remove()}.bind(this))},removeEmptySpans:function(t){return this.app.utils.wrap(t,function(t){t.find("span").each(this._removeEmptySpan.bind(this))}.bind(this))},removeEmptyInlines:function(t){return this.app.utils.wrap(t,function(t){t.find(this.opts.tags.inline.join(",")).each(this._removeEmptyTag.bind(this))}.bind(this))},removeEmptyAttrs:function(t,i){return this.app.utils.wrap(t,function(t){for(var e=0;e<i.length;e++)t.find("["+i[e]+'=""]').removeAttr(i[e])})},removeBlockTags:function(t,e,i){var s=this.opts.tags.block.concat();return i&&(s=this.app.utils.removeFromArrayByValue(s,i)),e=e&&(e?this.app.utils.extendArray(s,e):s),this.removeTags(t,e)},removeBlockTagsInside:function(t,e){return this.blockListTags=this.app.utils.removeFromArrayByValue(this.opts.tags.block.concat(),["ul","ol","li"]),this.app.utils.wrap(t,function(t){t.find(e.join(",")).each(this._removeBlockTagsInside.bind(this))}.bind(this))},removeInlineStyles:function(t){var e=this.app.utils.removeFromArrayByValue(this.opts.tags.inline,"a");return this.app.utils.wrap(t,function(t){t.find(e.join(",")).removeAttr("style")})},removeStyleAttr:function(t,e){return"",this.app.utils.wrap(t,function(t){t.find("*").removeAttr("style")})},_cacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr("style");i?(i=i.replace(/"/g,""),t.attr(e,i)):i&&""!==i||t.removeAttr(e)},_recacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr(e);t.attr("style",i).removeAttr(e)},_cleanEmpty:function(t){return t=t.trim(),t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")},_copyFromAllSelected:function(t){var e=this.app.editor.getEditor().html();return"cut"===t&&this.app.editor.setEmpty(),e},_copyFromMultiple:function(t){var e=this.app.selection.getHtml();return"cut"===t&&this.app.selection.deleteContents(),e},_copyFromEditable:function(t,e){var i,s=e.getType();if("figcaption"===s||"cell"===s)i=this.app.selection.getHtml(),"cut"===t&&this.app.selection.deleteContents();else if(e.isAllSelected())i=e.getOuterHtml(),"cut"===t&&e.remove();else if("list"===s){var n=e.getTag();-1!==(i=this.app.selection.getHtml()).search(/<li/gi)&&(-1===i.search(/^<li/g)&&(i="<li>"+i+"</li>"),i="<"+n+">"+i+"</"+n+">"),"cut"===t&&this.app.selection.deleteContents()}else i=this.app.selection.getHtml(),"cut"===t&&this.app.selection.deleteContents();return i},_copyFromNonEditable:function(t,e){var i=e.getOuterHtml();return"cut"!==t||e.isSecondLevel()||e.remove(),i},_copy:function(t,e){var i=!1,s=this.app.block.get();if(!(s&&s.isEditable()&&this.app.selection.isCollapsed())){this.app.blocks.isMeta()&&(s=this.app.blocks.getLastSelected()),t.preventDefault(),this.app.editor.isAllSelected()?i=this._copyFromAllSelected(e):this.app.blocks.is()?i=this._copyFromMultiple(e):s&&s.isEditable()?i=this._copyFromEditable(e,s):s&&(i=this._copyFromNonEditable(e,s));var n=this.app.broadcast("editor.before."+e,{e:t,html:i});if(n.isStopped())return t.preventDefault();i=n.get("html"),i=this.app.clipboard.setContent(t,i),this.app.broadcastHtml("editor."+e,i)}},_removeEmptySpan:function(t){0===t.get().attributes.length&&t.unwrap()},_removeEmptyTag:function(t){var e=t.html().trim();0===t.get().attributes.length&&""===e&&t.unwrap()},_removeBlockTagsInside:function(t){var e="LI"===t.get().tagName?this.blockListTags:this.opts.tags.block;t.find(e.join(",")).append("<br>").unwrap()},_store:function(t,e,i,s,n){if(!i)return t;void 0===s[e]&&(s[e]=[]);for(var a=0;a<i.length;a++)s[e][n]=i[a],t=t.replace(i[a],"####_"+e+n+"_####"),n++;return t},_getElementsFromHtml:function(t,e){var i=[];return this.dom("<div>").html(t).find(e).each(function(t){i.push(t.get().outerHTML)}),i},_sanitizeSrc:function(t){var e=t.get();-1!==e.getAttribute("src").search(/^data|javascript:/i)&&e.setAttribute("src","")},_sanitizeHref:function(t){var e=t.get(),i=e.getAttribute("href");i&&-1!==i.search(/^javascript:/i)&&e.setAttribute("href","")},_sanitizeEvents:function(t){t.removeAttr("onload onerror ontoggle onwheel onmouseover oncopy")},_encodeCode:function(t){return this.app.utils.wrap(t,function(t){t.find("pre code, pre, code").each(this._encodeNode.bind(this))}.bind(this))},_encodeNode:function(t){var e=t.get(),i=e.firstChild,s=e.innerHTML;if("PRE"!==e.tagName||!i||"CODE"!==i.tagName){s=(s=s.replace(/xtagstartz/g,"<")).replace(/xtagendz/g,">");var n=this.decodeEntities(s);e.textContent=this._encodeNodeHtml(n)}},_encodeNodeHtml:function(t){return t=t.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),t=this.opts.pre.spaces?t.replace(/\t/g,new Array(this.opts.pre.spaces+1).join(" ")):t}}),RedactorX.add("module","paragraphizer",{init:function(){this.remStart="#####replace",this.remEnd="#####";this.tags=this.opts.tags.parser.concat(["figcaption","object","style","script","iframe","select","input","textarea","button","option","map","area","math","fieldset","legend","hgroup","nav","details","menu","summary"])},paragraphize:function(t){var e=[],i=[];t=this._storeTags(t,e),t=(t=this.app.content.storeComments(t,i)).trim();for(var s="",n=(t=(t=(t=(t=(t=(t=this._trimLinks(t)).replace(/xparagraphmarkerz(?:\r\n|\r|\n)$/g,"")).replace(/xparagraphmarkerz$/g,"")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)/g,"\n")).replace(/xparagraphmarkerz/g,"\n")).replace(/[\n]+/g,"\n")).split("\n"),a=0;a<n.length;a++)s+="<p>"+n[a].trim()+"</p>\n";return t=(t=(t=(t=s.replace(/\n$/,"")).replace(new RegExp("<p>\\s+#####","gi"),"#####")).replace(new RegExp("<p>#####","gi"),"#####")).replace(new RegExp("#####</p>","gi"),"#####"),t=this._restoreTags(t,e),t=(t=(t=(t=(t=this.app.content.restoreComments(t,i)).replace(/<p(.*?)><\/?br\s?\/?><\/p>/gi,"<p$1></p>")).replace(/<div(.*?)><\/?br\s?\/?><\/div>/gi,"<div$1></div>")).replace(/<\/?br\s?\/?><\/div>/gi,"</div>")).replace(/<\/?br\s?\/?><\/li>/gi,"</li>")},_storeTags:function(t,i){return this.app.utils.wrap(t,function(t){t.find(this.tags.join(", ")).each(function(t,e){this._replaceTag(t,e,i)}.bind(this))}.bind(this))},_restoreTags:function(t,e){for(var i=0;i<e.length;i++){var s=e[i].replace(/\$/gi,"&#36;");t=t.replace(this.remStart+i+this.remEnd,s)}return t},_replaceTag:function(t,e,i){var s=t.get(),n=document.createTextNode(this.remStart+e+this.remEnd+"xparagraphmarkerz");i.push(s.outerHTML),s.parentNode.replaceChild(n,s)},_trimLinks:function(t){return this.app.utils.wrap(t,function(t){t.find("a").each(this._trimLink.bind(this))}.bind(this))},_trimLink:function(t){t.html(t.html().trim())}}),RedactorX.add("module","utils",{isMobile:function(){return/(iPhone|iPad|iPod|Android)/.test(navigator.userAgent)},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(t){return t.search(/^\uFEFF$/g)},removeInvisibleChars:function(t){return t.replace(/\uFEFF/g,"")},wrap:function(t,e){var i=this.dom("<div>").html(t);return e(i),t=i.html(),i.remove(),t},extendArray:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},removeFromArrayByValue:function(t,e){var i;e=Array.isArray(e)?e:[e];for(var s=0;s<e.length;s++)-1<(i=t.indexOf(e[s]))&&t.splice(i,1);return t},sumOfArray:function(t){return t.reduce(function(t,e){return parseInt(t)+parseInt(e)},0)},getObjectIndex:function(t,e){return Object.keys(t).indexOf(e)},insertToObject:function(s,n,a,o){return Object.keys(a).reduce(function(t,e,i){return i===o&&(t[s]=n),t[e]=a[e],t},{})},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},escapeRegExp:function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")},capitalize:function(t){return(t=t.toLowerCase()).charAt(0).toUpperCase()+t.slice(1)},extendData:function(t,e){for(var i in e)t="elements"===i?this._extendDataElements(t,e[i]):this._setData(t,i,e[i]);return t},_extendDataElements:function(n,t){return this.dom(t).each(function(t){if("FORM"===t.get().tagName){var e=t.serialize(!0);for(var i in e)n=this._setData(n,i,e[i])}else{var s=t.attr("name")?t.attr("name"):t.attr("id");n=this._setData(n,s,t.val())}}.bind(this)),n},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t}}),RedactorX.add("module","blocks",{init:function(){this.selected=[],this.focusclass=this.prefix+"-block-meta-focus"},start:function(){this.$editor=this.app.editor.getEditor()},build:function(){this._buildFirstLevel()},is:function(){return 0<this.selected.length},isMeta:function(){return 0<this.getSelected().length},set:function(t){this.selected=t},setMeta:function(t){t=t.closest("[data-"+this.prefix+"-first-level]"),this.app.block.unset(),this._classFocus(t,"add"),this.app.toolbar.build(),setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),0)},unset:function(){this._classFocus(this.getFirstLevel(),"remove"),this.selected=[]},getBlocks:function(){return this.$editor.find("[data-"+this.prefix+"-type]")},getFirstLevel:function(){return this.$editor.find("[data-"+this.prefix+"-first-level]")},getFirst:function(){return this.getBlocks().first().dataget("instance")},getLast:function(){return this.getBlocks().last().dataget("instance")},getFirstSelected:function(){return this.getSelected().first().dataget("instance")},getLastSelected:function(){return this.getSelected().last().dataget("instance")},getSelected:function(){return this.$editor.find("."+this.focusclass)},getSelectedBlocks:function(t){var e=this.app.selection.getNodes({type:"blocks-first"});if("editable"===t){for(var i=[],s=0;s<e.length;s++){var n=this.dom(e[s]).dataget("instance").getType();-1!==["paragraph","heading","list","address"].indexOf(n)&&i.push(e[s])}e=i}return e},getSelectedBlock:function(t){var e=this.app.selection.getDataBlock();return t&&0===e.length&&(e=this.app.element.getDataBlock(t.target)),e},getFirstSelectedBlock:function(){return 0<this.selected.length&&this.selected[0]},getLastSelectedBlock:function(t){return 0<this.selected.length&&this.selected[this.selected.length-1]},removeSelected:function(t){var e,i=this.getLastSelected();!1!==t&&i&&(e=i.getNext()),this.getSelected().each(this._removeSelectedBlock.bind(this)),e&&this.app.block.set(e,"start")},_buildFirstLevel:function(){var t="data-"+this.prefix+"-first-level",e=this.app.editor.getEditor();e.find("["+t+"]").removeAttr(t),e.children("[data-"+this.prefix+"-type]").attr(t,!0)},_removeSelectedBlock:function(t){t.dataget("instance").remove({traverse:!1})},_classFocus:function(t,e){return t[e+"Class"](this.focusclass)}}),RedactorX.add("module","event",{init:function(){this.trigger=!0,this.imageDrag=!1,this.dragoverEvent=!1,this.isPopupMouseUp=!1,this.isEditorMouseUp=!1,this.events={editor:["click","contextmenu","touchstart","mouseover","mouseup","mousedown","keydown","keyup","drop","dragstart","dragover","dragleave"],doc:["keydown","mousedown","mouseup","click","paste","cut","copy"],win:["focus"]}},build:function(){this.$editor=this.app.editor.getEditor(),this._buildPreventLinks(),this._buildEvents()},onmouseover:function(t){this.app.broadcast("editor.mouseover",{e:t})},oncontextmenu:function(t){},ontouchstart:function(t){this.app.state.add(t)},onclick:function(t){this.app.broadcast("editor.click",{e:t})},onmouseup:function(e){!this.isEditorMouseUp&&this._isEditorClick(e)||setTimeout(function(){if(this.app.selection.isCollapsed()){var t=this._getBlock(e.target);this.app.editor.setFocus(),this.app.block.set(t)}else this.app.editor.observeBlocks(e);this.app.toolbar.observe(),this.app.state.add(e),this.isEditorMouseUp=!1,this.app.broadcast("editor.mouseup",{e:e})}.bind(this),0)},onmousedown:function(t){this.app.placeholder.handleClick(t),this._isEditorClick(t)||(this._setCaretInline(t),this.isEditorMouseUp=!0,this.app.state.add(t),this.app.broadcast("editor.mousedown",{e:t}))},onkeydown:function(t){if(this.app.broadcast("editor.keydown",this._buildEventKeysObj(t)).isStopped())return t.preventDefault();this.app.state.listen(t)||this._isEsc(t)&&(this.app.block.unset(),this.app.selection.removeAllRanges())},onkeyup:function(t){if(this.app.broadcast("editor.keyup",this._buildEventKeysObj(t)).isStopped())return t.preventDefault();t.which!==this.app.keycodes.TAB||this.app.block.is()||this._setBlock(t)},ondrop:function(t){if(!this.opts.editor.drop)return t.preventDefault();var e;if(this.app.broadcast("editor.drop",{e:t}).isStopped())return t.preventDefault();var i=t.dataTransfer,s=i.getData("item");if(""!==s)t.preventDefault(),(e=this.opts.draggable&&void 0!==this.opts.draggable[s]?this.opts.draggable[s]:(e=this.dom("[data-"+this.prefix+"-drop-item="+s+"]").html()).trim())&&this.app.content.drop(t,e,"after",!1);else if(this.opts.image&&this.opts.image.upload&&null!==i.files&&0<i.files.length)t.preventDefault(),this.app.image.drop(t,i);else{e=""===(e=i.getData("text/html")).trim()?i.getData("Text"):e;var n=this.app.content.drop(t,e);if(this.imageDrag&&0!==n.instances.length)n.instances[0].change(this.imageDrag,!1)}this._removeDragPlaceholder(),this.imageDrag=!1,this.app.observer.trigger=!0},ondragstart:function(t){var e=this._getBlock(t.target);0!==e.length&&"image"===this.app.element.getType(e)&&(this.imageDrag=e.dataget("instance")),this.app.broadcast("editor.dragstart",{e:t})},ondragover:function(t){if(t.preventDefault(),this.dragoverEvent=!0,this.app.observer.trigger=!1,this._removeDragPlaceholder(),-1!==t.dataTransfer.types.indexOf("item")){var e=this._getBlockFirst(t.target);if(0!==e.length){var i=this.dom("<div>").addClass(this.prefix+"-draggable-placeholder");e.after(i)}}this.app.broadcast("editor.dragover",{e:t})},ondragleave:function(t){t.preventDefault(),this.dragoverEvent=!0,this.app.observer.trigger=!0,this._removeDragPlaceholder(),this.app.broadcast("editor.dragleave",{e:t})},onwinfocus:function(t){var e=this.app.block.get();!e||e.isEditable()||setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),0)},ondocpaste:function(t){this._isFocusEditor()&&this.app.content.paste(t)},ondoccopy:function(t){this._isFocusEditor()&&this.app.content.copy(t)},ondoccut:function(t){this._isFocusEditor()&&this.app.content.cut(t)},ondockeydown:function(t){this._isEsc(t)&&this.app.popup.isOpen()&&this.app.popup.close(!1);var e=this.app.broadcast("editor.dockeydown",this._buildEventKeysObj(t));if(this.app.editor.isFocus()&&!this.app.popup.isOpen()&&!this.app.source.is()){if(this.app.shortcut.handle(t))return;this.app.input.handle(e)}},ondocmousedown:function(t){this.isPopupMouseUp=0!==this.dom(t.target).closest("."+this.prefix+"-popup-"+this.uuid).length,this.app.broadcast("editor.docmousedown",{e:t})},ondocmouseup:function(t){this.app.broadcast("editor.docmouseup",{e:t})},ondocclick:function(t){if(!this.app.popup.isOpen()||!this._isEditorContainer(t))return!this._isOutsideEditor(t)||!1===this.trigger||void(this.isEditorMouseUp?this.isEditorMouseUp=!1:(this.app.popup.isOpen()?!1===this.isPopupMouseUp&&this.app.popup.close(!1):this.app.editor.setBlur(t),this.app.broadcast("editor.docclick",{e:t})));this.app.popup.close(!1)},_buildPreventLinks:function(){var t=this.prefix+"-prevent-events";this.$editor.on("click."+t+" dblclick."+t,this._preventLinks.bind(this))},_buildEventKeysObj:function(t){var e=t.which,i=[this.app.keycodes.UP,this.app.keycodes.DOWN,this.app.keycodes.LEFT,this.app.keycodes.RIGHT],s=!t.ctrlKey&&!t.metaKey&&(48<=e&&e<=57||65<=e&&e<=90),n=this.app.keycodes;return{e:t,key:e,ctrl:t.ctrlKey||t.metaKey,shift:t.shiftKey,alt:t.altKey,select:(t.ctrlKey||t.metaKey)&&!t.altKey&&65===e,enter:e===n.ENTER,space:e===n.SPACE,esc:e===n.ESC,tab:!(e!==n.TAB||t.shiftKey||t.altKey||t.ctrlKey||t.metaKey),delete:e===n.DELETE,backspace:e===n.BACKSPACE,alpha:s,arrow:-1!==i.indexOf(e),left:e===n.LEFT,right:e===n.RIGHT,up:e===n.UP,down:e===n.DOWN,"left-right":e===n.LEFT||e===n.RIGHT,"up-left":e===n.UP||e===n.LEFT,"down-right":e===n.DOWN||e===n.RIGHT}},_buildEvents:function(){var t=this.prefix+"-events";this._buildTargetEvents(this.$editor,this.events.editor,t,""),this._buildTargetEvents(this.app.$doc,this.events.doc,t,"doc"),this._buildTargetEvents(this.app.$win,this.events.win,t,"win")},_buildTargetEvents:function(t,e,i,s){for(var n=0;n<e.length;n++)t.on(e[n]+"."+i,this["on"+s+e[n]].bind(this))},_preventLinks:function(t){0!==this.dom(t.target).closest("a").length&&t.preventDefault()},_isEditorClick:function(t){if(this.app.editor.isEditor(t.target))return t.preventDefault(),!0},_isEsc:function(t){return t.which===this.app.keycodes.ESC},_isEditorContainer:function(t){return 0!==this.dom(t.target).closest("."+this.prefix+"-container-"+this.uuid).length},_isOutsideEditor:function(t){return 0===this.dom(t.target).closest("."+this.prefix+["-container-","-popup-","-toolbar-","-control-"].join(this.uuid+",."+this.prefix)+this.uuid).length},_isFocusEditor:function(){return!this.app.popup.isOpen()&&!this.app.source.is()&&(this.app.block.is()||this.app.blocks.is()||this.app.blocks.isMeta()||this.app.editor.isAllSelected())},_removeDragPlaceholder:function(){this.app.editor.getEditor().find("."+this.prefix+"-draggable-placeholder").remove()},_getBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},_getBlockFirst:function(t){return this.dom(t).closest("[data-"+this.prefix+"-first-level]")},_setBlock:function(t){this.app.editor.setFocus();var e=t?this._getBlock(t.target):this.app.selection.getDataBlock(),i=!1;0===e.length&&(e=this.app.blocks.getFirst(),i="start"),this.app.block.set(e,i)},_setCaretInline:function(e){var t=this.app.block.get(),i=!1;t&&t.isEditable()&&(this.app.element.isEmptyOrImageInline(e.target)?this.app.caret.set(e.target,"after"):this.app.selection.isCollapsed()&&"CODE"===e.target.tagName&&(i=!0,setTimeout(function(){var t=this.app.selection.getElement();t&&i&&"CODE"!==t.tagName&&(this.app.caret.set(e.target,"start"),i=!1)}.bind(this),1)))}}),RedactorX.add("module","caret",{start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},set:function(t,e){var i=this.dom(t).get(),s=this.doc.createRange();i&&this._isInPage(i)&&(this[{start:"_setStart",end:"_setEnd",before:"_setBefore",after:"_setAfter"}[e]](s,i),this._setRange(s))},is:function(t,e,i,s){var n=this.dom(t).get(),a=this.doc.getSelection(),o=!1;if(!n||!a.isCollapsed)return o;var r=this._getPosition(n,s),p=this._getSize(n,i,s);return"end"===e?o=r===p:"start"===e&&(o=0===r),o},_setStart:function(t,e){t.setStart(e,0),t.collapse(!0);var i=this._getInlineInside(e);i&&(t=this._setStartInline(t,i)),this._isInline(e)&&this._insertInvisibleNode(t)},_setStartInline:function(t,e){var i=this.app.element.getAllInlines(e)[0];t.selectNodeContents(i),t.collapse(!0)},_setEnd:function(t,e){var i=1===e.nodeType&&e.lastChild;i&&this._isInline(i)&&(e=i),t.selectNodeContents(e),t.collapse(!1)},_setBefore:function(t,e){t.setStartBefore(e),t.collapse(!0),this._isInline(e)&&this._insertInvisibleNode(t,e)},_setAfter:function(t,e){t.setStartAfter(e),t.collapse(!0);var i=3!==e.nodeType&&e.tagName.toLowerCase();!this._isInline(e)&&"br"!==i&&"svg"!==i||this._insertInvisibleNode(t)},_setRange:function(t){var e=this.win.getSelection();e.removeAllRanges(),e.addRange(t)},_isInPage:function(t){var e=!1;return t&&t.nodeType&&(e=t!==this.doc.body&&this.doc.body.contains(t)),e},_isInline:function(t){return this.app.element.is(t,"inline")},_insertInvisibleNode:function(t,e){var i=this.app.utils.createInvisibleChar();return e?e.parentNode.insertBefore(i,e):t.insertNode(i),t.selectNodeContents(i),t.collapse(!1),i},_getInlineInside:function(t){var e=t.firstChild;if(this._isInline(e)){for(var i=e.firstChild;i;){if(this._isInline(i))return i;i=i.firstChild}return e}},_getSize:function(t,e,i){var s,n=3===t.nodeType;if(e&&0!==e.length){var a=this.dom(t).clone();a.find(e.join(",")).remove(),s=a.html().trim()}else s=n?t.textContent:t.innerHTML,s=n||!1===i?s:s.trim();return this._trimmed(s,n,i).length},_getPosition:function(t,e){var i=this.win.getSelection().getRangeAt(0),s=i.cloneRange(),n=document.createElement("div"),a=3===t.nodeType;s.selectNodeContents(t),s.setEnd(i.endContainer,i.endOffset),n.appendChild(s.cloneContents());var o=a||!1===e?n.innerHTML:n.innerHTML.trim(),r=-1!==o.search(/<\/?br\s?\/?>$/g)?1:0;return(o=this._trimmed(o,a,e)).length+r},_trimmed:function(t,e,i){return!1===i?t=t.replace(/\n$/g,""):(""===(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,"")).replace(/\s+/g," "))||e||(t=t.replace(/\s$/,"")),t)}}),RedactorX.add("module","marker",{start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},build:function(t){var e=this.dom("<span>").attr("id","selection-marker-"+t);return e.addClass(this.prefix+"-selection-marker"),e.html(this.opts.markerChar),e.get()},insert:function(){this.remove();var t=this.app.selection.get(),e=!t.collapsed;if(t.range){var i=this.build("start"),s=this.build("end"),n=t.range.cloneRange();e&&(n.collapse(!1),n.insertNode(s)),n.setStart(t.range.startContainer,t.range.startOffset),n.collapse(!0),n.insertNode(i),t.range.setStartAfter(i),e&&t.range.setEndBefore(s),this.app.selection.setRange(t.range)}},restore:function(){var t=this.find("start"),e=this.find("end"),i=this.app.selection.get(),s=i.range?i.range:this.doc.createRange();if(t){var n=!!e&&e.previousSibling,a=t.nextSibling;a=(!a||3!==a.nodeType||""!==a.textContent.replace(/[\n\t]/g,""))&&a,e?a&&"selection-marker-end"===a.id?this._restoreInject(s,t):n&&a?(s.selectNodeContents(n),s.collapse(!1),s.setStart(a,0)):n&&!a?(s.selectNodeContents(n),s.collapse(!1),s.setStartAfter(t)):(s.setStartAfter(t),s.setEndBefore(e)):a?(s.selectNodeContents(a),s.collapse(!0)):this._restoreInject(s,t),this.app.selection.setRange(s);var o=t&&e?1:0,r=this.app.offset.get();r={start:r.start-o,end:r.end-o},t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e),this.app.offset.set(!1,r)}},find:function(t){var e=this.app.editor.getEditor().find("#selection-marker-"+t);return 0!==e.length&&e.get()},remove:function(){var t=this.find("start"),e=this.find("end");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)},_restoreInject:function(t,e){var i=this.app.utils.createInvisibleChar();this.dom(e).after(i),t.selectNodeContents(i),t.collapse(!1)}}),RedactorX.add("module","offset",{start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},get:function(t){t=this._getEl(t);var e=this.win.getSelection(),i=!1;if(e&&0<e.rangeCount){var s=e.getRangeAt(0);if(t.contains(e.anchorNode)){var n=s.cloneRange();n.selectNodeContents(t),n.setEnd(s.startContainer,s.startOffset);var a=n.toString().length;i={start:a,end:a+s.toString().length}}}return i},set:function(t,e){!1===e&&(e={start:0,end:0}),t=this._getEl(t);var i,s=0,n=this.doc.createRange(),a=[t],o=!1,r=!1;for(n.setStart(t,0),n.collapse(!0);!r&&(i=a.pop());)if(3===i.nodeType){var p=s+i.length;!o&&e.start>=s&&e.start<=p&&(n.setStart(i,e.start-s),o=!0),o&&e.end>=s&&e.end<=p&&(n.setEnd(i,e.end-s),r=!0),s=p}else for(var l=i.childNodes.length;l--;)a.push(i.childNodes[l]);var h=this.win.getSelection();h.removeAllRanges(),h.addRange(n)},_getEl:function(t){return t?this.dom(t).get():this.app.editor.getEditor().get()}}),RedactorX.add("module","selection",{init:function(){this.savedSelection=!1,this.savedMarker=!1},start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},get:function(){var t=this._getSelection(),e=this._getRange(t),i=this._getCurrent(t);return{selection:t,range:e,collapsed:this._getCollapsed(t,e),current:i,parent:this._getParent(i)}},getRange:function(){return this._getRange(this.get().selection)},getNodes:function(t){var e=this.get(),i=t&&(t.type&&"inline"===t.type||t.tags&&-1!==t.tags.indexOf("a")),s=i?"_getAllRangeNodes":"_getRangeNodes",n=[];return 0<(n=this.app.editor.isAllSelected()?this.app.editor.getEditor().children().getAll():e.selection&&e.range?this[s](e.range):n).length?this._filterNodes(n,e.range,i,t):n},getCurrent:function(){var t=this._getSelection();return this._getCurrent(t)},getParent:function(){var t=this.getCurrent();return this._getParent(t)},getElement:function(t){return this._getElement(t,"element")},getInline:function(t){return this._getElement(t,"inline")},getTopInline:function(t){for(var e=t?this.dom(t).get():this.getCurrent(),i=[];e&&this._getElement(e,"inline");)i.push(e),e=e.parentNode;return i[i.length-1]},getDataBlock:function(t){var e=this._getSelection(),i=t||this._getCurrent(e);if(i)for(i=this.dom(i).get();i;){if(1===i.nodeType&&i.getAttribute("data-"+this.prefix+"-type"))return this.dom(i);i=i.parentNode}return this.dom()},getBlock:function(t){return this._getElement(t,"block")},getText:function(t,e){var i=this.get(),s=!1;if(!i.selection)return!1;if(t&&i.range){e=void 0===e?1:e;var n=this.app.editor.getEditor().get(),a=i.range.cloneRange();"before"===t?(a.collapse(!0),a.setStart(n,0),s=a.toString().slice(-e)):"after"===t&&(a.selectNodeContents(n),a.setStart(i.range.endContainer,i.range.endOffset),s=a.toString().slice(0,e))}else s=i.selection?i.selection.toString():"";return s},getHtml:function(){var t="",e=this.get();if(e.selection){var i=e.range.cloneContents(),s=document.createElement("div");s.appendChild(i),t=(t=s.innerHTML).replace(/<p><\/p>$/i,"")}return t},getPosition:function(){var t=this.getRange(),e={top:0,left:0,width:0,height:0};if(this.win.getSelection&&t.getBoundingClientRect){var i=(t=t.cloneRange()).startOffset-1;t.setStart(t.startContainer,i<0?0:i);var s=t.getBoundingClientRect();e={top:s.top,bottom:s.bottom,left:s.left,width:s.right-s.left,height:s.bottom-s.top}}return e},set:function(t,e){t&&(t.removeAllRanges(),t.addRange(e))},setRange:function(t){this.set(this.win.getSelection(),t)},is:function(t){if(void 0===t)return this.get().selection;for(var e=this.dom(t).get(),i=this.getNodes(),s=0;s<i.length;s++)if(i[s]===e)return!0;return!1},isCollapsed:function(){var t=this.get();return this._getCollapsed(t.selection,t.range)},isIn:function(t){var e=this.dom(t).get(),i=this.getCurrent();return!(!i||!e)&&e.contains(i)},isAll:function(t){var e=!t,i=t?this.dom(t).get():this.app.editor.getEditor().get(),s=this.win.getSelection(),n=this._getRange(s),a=e||this.is(i);return!s.isCollapsed&&(!!a&&(void 0!==i.textContent&&i.textContent.trim().length===n.toString().trim().length))},select:function(t){var e=t?this.dom(t).get():this.app.editor.getEditor().get(),i=this.doc.createRange();i.selectNodeContents(e),this.setRange(i)},removeAllRanges:function(){var t=this._getSelection();t&&t.removeAllRanges()},deleteContents:function(){var t=this.getRange();!this.isCollapsed()&&t&&t.deleteContents()},collapse:function(t){t=t||"start";var e=this.get();e.selection&&!e.collapsed&&("start"===t?e.selection.collapseToStart():e.selection.collapseToEnd())},save:function(t){if(!t){var e=this.app.block.get();t=e?e.getBlock():this.app.editor.getEditor()}this.savedSelection={el:t,offset:this.app.offset.get(t)}},restore:function(t){if(!this.savedMarker&&this.savedSelection){var e=this.savedSelection.el;this.dom(e).dataget("instance")&&!1!==t&&this.app.block.set(e),e&&(e.focus(),this.app.offset.set(e,this.savedSelection.offset)),this.savedSelection=!1}},saveMarker:function(){this.savedMarker=!0,this.app.marker.insert()},restoreMarker:function(){this.app.marker.restore(),this.savedMarker=!1,this.savedSelection=!1},_getSelection:function(){var t=this.win.getSelection();if(0<t.rangeCount){var e=t.anchorNode;return 0!==this.dom(e).closest("."+this.prefix+"-container-"+this.uuid).length&&t}return!1},_getRange:function(t){return!!t&&(0<t.rangeCount&&t.getRangeAt(0))},_getCurrent:function(t){return!!t&&t.anchorNode},_getParent:function(t){return!!t&&t.parentNode},_getElement:function(t,e){var i=this._getSelection();if(i){var s=t||this._getCurrent(i);for(s=this.dom(s).get();s;){if(this.app.element.is(s,e))return s;s=s.parentNode}}return!1},_getCollapsed:function(t,e){var i=!1;return t&&t.isCollapsed?i=!0:e&&0===e.toString().length&&(i=!0),i},_getNextNode:function(t){if(t.firstChild)return t.firstChild;for(;t;){if(t.nextSibling)return t.nextSibling;t=t.parentNode}},_getRangeNodes:function(t,e){var i,s=t.startContainer.childNodes[t.startOffset]||t.startContainer,n=t.endContainer.childNodes[t.endOffset]||t.endContainer,a=t.commonAncestorContainer,o=[];if(e){for(this.app.editor.isEditor(s)||o.push(s),i=s.parentNode;i&&!this.app.editor.isEditor(i)&&(o.push(i),i!==a);i=i.parentNode);for(o.reverse(),i=s;i&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(a).length)&&(o.push(i),i!==n);i=this._getNextNode(i));}else for(3===s.nodeType&&o.push(this.getBlock()),i=s;i&&i!==a&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(a).length)&&(o.push(i),i!==n);i=this._getNextNode(i));return o},_getAllRangeNodes:function(t){return this._getRangeNodes(t,!0)},_filterNodes:function(t,e,i,s){var n=this.getText();n=n.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");for(var a=[],o=0;o<t.length;o++){var r=!0;s&&(r=s.types?this._filterByTypes(r,s,t[o]):r,r=s.selected?this._filterBySelected(r,s,t[o],e,n):r,r=s.type?this._filterByType(r,s,t[o],i):r,r=s.tags?this._filterByTags(r,s,t[o]):r),r&&a.push(t[o])}var p=[];if(s&&("blocks"===s.type||"blocks-first"===s.type)){for(var l=0;l<a.length;l++){var h;"blocks-first"===s.type?h=this.app.element.is(a[l],"blocks-first")?a[l]:this.app.element.getFirstLevel(a[l]).get():"blocks"===s.type&&(h=this.app.element.is(a[l],"blocks")?a[l]:this.app.element.getDataBlock(a[l]).get()),this._isInNodesArray(p,h)||p.push(h)}a=p}return a},_filterByTypes:function(t,e,i){var s;return!0===e.types?(s=this.app.element.getType(i))||(t=!1):(s=this.app.element.getType(i),-1===e.types.indexOf(s)&&(t=!1)),t},_filterByType:function(t,e,i,s){var n=e.type;return"blocks"!==n&&"blocks-first"!==n||(n="block"),s?e.links?this.app.element.is(i,n)||(t=!1):(1!==i.nodeType||"A"!==i.tagName)&&this.app.element.is(i,n)||(t=!1):this.app.element.is(i,n)||(t=!1),t},_filterByTags:function(t,e,i){var s=void 0!==i.tagName;return s?s&&-1===e.tags.indexOf(i.tagName.toLowerCase())&&(t=!1):t=!1,t},_filterBySelected:function(t,e,i,s,n){return!0!==e.selected||this._containsNodeText(s,i)?"inside"===e.selected&&(1===i.nodeType&&"A"===i.tagName?t=!0:this._isTextSelected(i,n)||(t=!1)):t=!1,t},_isTextSelected:function(t,e){var i=this.app.utils.removeInvisibleChars(t.textContent);return e===i||-1!==i.search(e)||-1!==e.search(new RegExp("^"+this.app.utils.escapeRegExp(i)+"$"))},_containsNodeText:function(t,e){for(var i,s,n,a=this.doc.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return NodeFilter.FILTER_ACCEPT}},!1);n=a.nextNode();)i=i||n,s=n;var o=t.cloneRange();return i?(o.setStart(i,0),o.setEnd(s,s.length)):o.selectNodeContents(e),t.compareBoundaryPoints(Range.START_TO_START,o)<1&&-1<t.compareBoundaryPoints(Range.END_TO_END,o)},_isInNodesArray:function(t,e){return-1!==t.indexOf(e)}}),RedactorX.add("module","block",{init:function(){this.instance=!1,this.$block=!1},create:function(t){var e=this.app.create("block.paragraph");return t&&e.getBlock().html(t),e},createHtml:function(t){return this.create(t).getOuterHtml()},is:function(t){return t?this._isBlockActive(t):this.get()},get:function(){return this.instance},set:function(t,e,i){t.isBlock&&(t=t.isNested()?e&&"end"===e?t.getLast().getBlock():t.getFirst().getBlock():t.getBlock()),this.app.blocks.unset(),this.app.editor.unsetSelectAll(),!0!==i&&this._isBlockActive(t)||(this.unset(),this.instance=this._getInstance(t),this.$block=this.instance.getBlock(),this.$block.addClass(this.prefix+"-block-focus"),this._setCaret(e),this.app.toolbar.build(),this.app.control.build(),this.app.broadcast("block.set"))},unset:function(){this.instance&&(this.$block.removeClass(this.prefix+"-block-focus"),this.instance=!1,this.$block=!1,this.app.popup.close(),this.app.control.close(),this.app.context.close(),this.app.broadcast("block.unset"))},observe:function(t,e){if(-1!==["line","quote","pre"].indexOf(e)&&!this.opts[e])return!1},format:function(t){this.app.format.set(t)},add:function(t){this.app.popup.close();var e=this.get();this.app.blocks.isMeta()&&(e=this.app.blocks.getLastSelected());var i,s="after";return t&&t.template?(e||(s=this.opts.editor.add),void this.app.insertion.insertContent({html:t.template,position:s})):(i=t.instance?t.instance:this.app.create("block."+t.name,t.source),e?e.isSecondLevel()&&(e=e.getFirstLevel()):s="top"===this.opts.editor.add?(e=this.app.blocks.getFirst(),"before"):(e=this.app.blocks.getLast(),"after"),e.add({instance:i,caret:t.caret?t.caret:"end",position:s}),i)},change:function(t){var e=this._getCurrentInstance();e&&e.change(t)},duplicate:function(){if(this.app.popup.close(),this.is()){var t=this.get();t.isSecondLevel()&&(t=t.getFirstLevel());var e=t.duplicate(),i=t.add({instance:e,caret:"start"});return this.app.broadcast("block.duplicate",{instance:i}),i}},remove:function(t){this.app.popup.close();var e=this.get();if(e){e.isSecondLevel()&&(e=e.getFirstLevel());var i=e.getType(),s="image"===i&&e.getSrc();if(!t||void 0===t.tarverse||!1!==t.tarverse){var n=e.getNext(),a=e.getPrev();e.remove(),n?this.app.block.set(n,"start"):a?this.app.block.set(a,"end"):this.unset()}else this.unset(),e.remove();"image"===i&&this.app.broadcast("image.remove",{url:s}),this.app.broadcast("block.remove",{type:i}),this.app.editor.isEmpty()&&this.app.editor.setEmpty()}},moveUp:function(){var t=this._getCurrentInstance();t&&(t.isSecondLevel()&&(t=t.getFirstLevel()),t.moveUp())},moveDown:function(){var t=this._getCurrentInstance();t&&(t.isSecondLevel()&&(t=t.getFirstLevel()),t.moveDown())},getData:function(){if(this.is())return this.get().getData()},setData:function(t){if(this.is()){var e=t.getData();this.get().setData(e)}},_isBlockActive:function(t){return this.instance&&this.dom(t).get()===this.$block.get()},_getCurrentInstance:function(){var t;return this.app.blocks.isMeta()?t=this.app.blocks.getLastSelected():this.is()&&(t=this.get()),t},_getInstance:function(t){return this.dom(t).dataget("instance")},_setCaret:function(t){var e=this.instance.getType(),i=this.get();-1!==["embed","image","line","layer"].indexOf(e)?(this.app.scroll.save(),this.$block.attr("tabindex","-1"),this.$block.focus(),setTimeout(function(){this.app.selection.removeAllRanges()}.bind(this),1),this.app.scroll.restore()):i.isEditable()&&t&&this.instance.setCaret(t)}}),RedactorX.add("module","scroll",{init:function(){this.scrolltop=!1},save:function(){this.scrolltop=this.getTarget().scrollTop()},restore:function(){!1!==this.scrolltop&&(this.getTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},isTarget:function(){return this.opts.editor.scrollTarget!==window},getTarget:function(){return this.dom(this.opts.editor.scrollTarget)}}),RedactorX.add("module","placeholder",{start:function(){this.placeholder=!1,this.$editor=this.app.editor.getEditor(),this._build()},handleClick:function(t){var e=this.dom(t.target);this._class(e,"has")&&(t.preventDefault(),t.stopPropagation(),this.app.editor.setFocus("start"))},toggle:function(){var t=this.app.editor.isEmpty(!0);return this.placeholder&&t?this.show():this.hide()},show:function(){this._class(this.$editor,"add")},hide:function(){this._class(this.$editor,"remove")},_class:function(t,e){return t[e+"Class"](this.prefix+"-placeholder")},_build:function(){var t=this.opts.placeholder,e=this.app.$element.attr("placeholder");!1===t&&!e||(this.$editor.attr("placeholder",!1!==t?t:e),this.placeholder=!0,this.toggle())}}),RedactorX.add("module","observer",{init:function(){this.observer=!1,this.trigger=!0},build:function(){if(window.MutationObserver){var t=this.app.editor.getEditor().get();this.observer=this._build(t),this.observer.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observer&&this.observer.disconnect(),this.trigger=!0},isButtons:function(){return!this.app.blocks.isMeta()&&!this.app.editor.isAllSelected()&&!(!this.opts.buttons.tags&&!this.opts.buttons.types)},buildButtons:function(t,e){for(var i,s=this.app.block.get(),n=!!s&&s.getType(),a=!!s&&s.getTag(),o=this.app.selection.getNodes({type:"inline",selected:"inside",links:!0}),r=this._getObservedTags(a,o),p=[],l=0;l<r.length;l++)(i=t[r[l]])&&(p=p.concat(i));return n&&(i=e[n])&&(p=p.concat(i)),p},buildActiveButtons:function(t){var e={};for(var i in e.tags=this.opts.buttons.tags?this.opts.buttons.tags:{},e.types=this.opts.buttons.types?this.opts.buttons.types:{},t){var s=t[i].active;s&&(this._buildActiveButton(i,s.tags,e.tags),this._buildActiveButton(i,s.types,e.types))}return e},_build:function(e){var i=this;return new MutationObserver(function(t){i._observe(t[t.length-1],e)})},_observe:function(t,e){"attributes"===t.type&&t.target===e||this.trigger&&(this.app.broadcast("observer.change"),this.app.placeholder.toggle(),this.app.sync.trigger())},_buildActiveButton:function(t,e,i){if(e){for(var s=0;s<e.length;s++){var n=e[s];i[n]?i[n].push(t):i[n]=[t]}return i}},_getObservedTags:function(t,e){var i=[];if(t&&i.push(t),0<e.length)for(var s=0;s<e.length;s++)i.push(e[s].tagName.toLowerCase());return i}}),RedactorX.add("module","sync",{build:function(){this.syncedHtml=this.app.$element.val()},trigger:function(){if(this.opts.editor.sync){var t=this._getHtml();this.is(t)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this._sync(t)}.bind(this),200))}},invoke:function(){var t=this._getHtml();this.syncedHtml=t,this._sync(t)},is:function(t){var e=!1;return this.syncedHtml!==t&&(this.syncedHtml=t,e=!0),e},_getHtml:function(){var t=this.app.editor.getEditor().html();return this.app.parser.unparse(t)},_sync:function(t){var e=this.app.broadcast("editor.before.change",{html:t});e.isStopped()||(this.app.$element.val(e.get("html")),this.app.autosave.send(),this.app.state.trigger(),this.app.broadcast("editor.change",e))}}),RedactorX.add("module","autosave",{send:function(){this.opts.autosave.url&&this._sending()},_getName:function(){return this.opts.autosave.name?this.opts.autosave.name:this.app.$element.attr("name")||"content"+this.uuid},_sending:function(){var e=this._getName(),i={};i[e]=this.app.$element.val(),i=this.app.utils.extendData(i,this.opts.autosave.data),this.ajax.post({url:this.opts.autosave.url,data:i,before:function(t){if(this.app.broadcast("autosave.before.send",{xhr:t,name:e,data:i}).isStopped())return!1}.bind(this),success:function(t){this._complete(t,e,i)}.bind(this)})},_complete:function(t,e,i){var s=t&&t.error?"autosave.error":"autosave.send";this.app.broadcast(s,{name:e,data:i,response:t})}}),RedactorX.add("module","state",{init:function(){this.started=!1,this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},load:function(){this.clear(),this.trigger(!0)},stop:function(){this.clear()},clear:function(){this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},get:function(){return this.undoStorage},add:function(t){t&&(t.ctrlKey||t.metaKey||this._isUndo(t)||this._isRedo(t))||!this.app.observer.trigger||(this.state=this._createState(),!1===this.started&&(this._setState(this.state,0),this.started=!0))},trigger:function(t){if(this.passed){var e=this._createState();this.state?e=this.state:this.state||t||(e=this.storage,this.started=!0),this._addState(e),this.storage=this._createState(),this.state=!1}},listen:function(t){return this._isUndo(t)?(t.preventDefault(),this.undo(),!0):this._isRedo(t)?(t.preventDefault(),this.redo(),!0):void(this.passed=!0)},undo:function(){if(this._hasUndo()){this.passed=!1;var t=this._getUndo();this._setRedo();var e=this.app.parser.parse(t[0]);this.app.editor.getEditor().html(e.children()),this._rebuild(t,"undo");var i=this.app.block.get(),s=!(!i||!i.isEditable())&&i.getBlock();this.app.offset.set(s,t[1])}},redo:function(){if(this._hasRedo()){this.passed=!1;var t=this.redoStorage.pop();this._addState(t);var e=this.app.parser.parse(t[0]);this.app.editor.getEditor().html(e.children()),this._rebuild(t,"redo");var i=this.app.block.get(),s=!(!i||!i.isEditable())&&i.getBlock();this.app.offset.set(s,t[1])}},_rebuild:function(t,e){this.app.editor.build(),this.app.editor.getEditor().find("."+this.prefix+"-block-state").each(function(t){this.app.block.set(t)}.bind(this)),this.app.broadcast("state."+e,{html:t[0],offset:t[1]})},_isUndo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&90===e&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(90===e&&t.shiftKey||89===e&&!t.shiftKey)&&!t.altKey},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length},_getUndo:function(){return 1===this.undoStorage.length?this.undoStorage[0]:this.undoStorage.pop()},_createState:function(){var t=this.app.editor.getEditor().html();t=this.app.utils.wrap(t,function(t){t.find("."+this.prefix+"-block-focus").addClass(this.prefix+"-block-state")}.bind(this));var e=this.app.block.get(),i=!(!e||!e.isEditable())&&e.getBlock();return{html:this.app.parser.unparse(t),offset:this.app.offset.get(i)}},_setState:function(t,e){this.undoStorage[e]=[t.html,t.offset]},_addState:function(t){var e=this.undoStorage[this.undoStorage.length-1];void 0===e||e[0]!==t.html?(this.undoStorage.push([t.html,t.offset]),this._removeOverStorage()):e[1]=t.offset},_setRedo:function(){var t=this._createState();this.redoStorage.push([t.html,t.offset]),this.redoStorage=this.redoStorage.slice(0,this.opts.state.limit)},_removeOverStorage:function(){this.undoStorage.length>this.opts.state.limit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.state.limit))}}),RedactorX.add("module","progress",{stop:function(){this.hide()},show:function(){this.hide(),this.$progress=this.dom("<div>").addClass(this.prefix+"-editor-progress"),this.$progress.attr("id",this.prefix+"-progress"),this.$progressBar=this.dom("<span>"),this.$progress.append(this.$progressBar),this.app.$body.append(this.$progress)},hide:function(t){this.app.$body.find("#"+this.prefix+"-progress").remove()}}),RedactorX.add("module","input",{handle:function(t){var e=t.get("e"),i=t.get("key");if(!this._doSelectAll(e,t))if(t.is("enter")&&t.is("shift"))this.handleShiftEnter(e,i,t);else if(t.is("enter"))this.handleEnter(e,i,t);else if(t.is("space")&&t.is("shift"))this.handleShiftSpace(e,i,t);else if(t.is("space"))this.handleSpace(e,i,t);else if(t.is("tab")&&this.opts.tab.key)this.handleTab(e,i,t);else if(t.is("arrow")){if(t.is(["shift","alt","ctrl"]))return;this.handleArrow(e,i,t)}else t.is(["delete","backspace"])&&this.handleDelete(e,i,t)},handleDelete:function(t,e,i){var s=this.app.block.get(),n=i.is("backspace"),a=i.is("delete");if(this.app.blocks.isMeta())return t.preventDefault(),void this.app.blocks.removeSelected();if(this.app.blocks.is()){t.preventDefault();var o=this.app.blocks.getFirstSelectedBlock(),r=this.dom(o);return this.app.selection.deleteContents(),void this.app.caret.set(r,"end")}if(!(this._deleteInsideSelection(t)||s&&s.isEditable()&&this._trimInvisibleChar(t,i.is("backspace")?"left":"right",a))){var p=this.app.selection.getInline();if(p&&1===p.innerHTML.length)return t.preventDefault(),void(p.innerHTML="");if(!s.handleDelete||!s.handleDelete(t,e,i)){var l=s.getNext(),h=s.getPrev();if(s.isEditable()){if(s.isEditable()){if(s.isAllSelected())return t.preventDefault(),void s.setEmpty();if(s.isSecondLevel()||s.isFigcaption())return;if(a&&l&&s.isCaretEnd())return t.preventDefault(),void(l.isEditable()?"pre"===l.getType()?(this.app.blocks.setMeta(l.getBlock()),s.isEmpty()&&s.remove()):s.appendNext():(l.isNested()?this.app.blocks.setMeta(l.getBlock()):this.app.block.set(l),s.isEmpty()&&s.remove()));if(n&&h&&s.isCaretStart())return t.preventDefault(),void(h.isEditable()?"pre"===h.getType()?(this.app.blocks.setMeta(h.getBlock()),s.isEmpty()&&s.remove()):s.appendToPrev():(h.isNested()?this.app.blocks.setMeta(h.getBlock()):this.app.block.set(h),s.isEmpty()&&s.remove()))}}else t.preventDefault(),s.remove(),l?this.app.block.set(l,"start"):h?this.app.block.set(h,"end"):this.app.editor.isEmpty()?this.app.editor.setEmpty():this.app.block.unset()}}},handleArrow:function(t,e,i){var s=this.app.block.get();if(this.app.editor.isAllSelected()){t.preventDefault();var n=i.is("down-right")?this.app.blocks.getLast():this.app.blocks.getFirst(),a=i.is("down-right")?"end":"start";return this.app.editor.unselectAll(),this.app.selection.removeAllRanges(),void this.app.block.set(n,a)}if(!this.app.blocks.is()){if(this.app.blocks.isMeta())return s=this.app.blocks.getLastSelected(),void this._doArrow(t,i,s);if(s.isEditable()){var o=this.app.selection.getTopInline();if(i.is("left")&&o&&"CODE"===o.tagName){var r=this.app.offset.get(o),p=this.app.caret.is(o,"start");if(!p&&1===r.start&&1===r.end)return t.preventDefault(),void this.app.caret.set(o,"start");if(p)return t.preventDefault(),void this.app.caret.set(o,"before")}}s.isEditable()&&this._trimInvisibleChar(t,i.is("left")?"left":"right")||s.handleArrow&&s.handleArrow(t,e,i)||this._doArrow(t,i,s)}},handleTab:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.isMeta())return t.preventDefault(),void((r=(s=this.app.blocks.getLastSelected()).getNext())&&this.app.block.set(r,"start"));if(this.app.blocks.is()){var n=this.app.blocks.getLastSelectedBlock();(s=this.dom(n).dataget("instance")).isSecondLevel()&&(s=s.getFirstLevel())}if(!s.handleTab||!s.handleTab(t,e,i))if(this.opts.tab.spaces&&s.isEditable()){t.preventDefault();var a=this.opts.tab.spaces,o=document.createTextNode(Array(a+1).join(""));this.app.insertion.insertNode(o,"end")}else{var r;t.preventDefault(),(r=s.getNext())&&this.app.block.set(r,"start")}},handleShiftSpace:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.isMeta())t.preventDefault();else{if(this.app.blocks.is()){t.preventDefault();var n=this.app.blocks.getFirstSelectedBlock(),a=this.dom(n);return this.app.selection.deleteContents(),this.app.caret.set(a,"end"),void this.app.insertion.insertHtml("&nbsp;","end")}if(s.isEditable()){if(s.isAllSelected())return t.preventDefault(),void s.setEmpty();if("pre"!==s.getType())return t.preventDefault(),void this.app.insertion.insertHtml("&nbsp;","end")}}},handleSpace:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.isMeta())return t.preventDefault(),this.app.blocks.getLastSelected().addEmpty({position:"after",caret:"start"}),void this.app.blocks.removeSelected(!1);if(this.app.blocks.is()){var n=this.app.blocks.getFirstSelectedBlock(),a=this.dom(n);return this.app.selection.deleteContents(),void this.app.caret.set(a,"end")}return s.handleSpace&&s.handleSpace(t,e,i)?void 0:s.isEditable()&&s.isAllSelected()?(t.preventDefault(),void s.setEmpty()):void(s.isEditable()||(t.preventDefault(),s.addEmpty({position:"after",caret:"start"}),s.remove()))},handleShiftEnter:function(t,e,i){if(this.app.blocks.isMeta())t.preventDefault();else{if(this.app.blocks.is()){t.preventDefault();var s=this.app.blocks.getFirstSelectedBlock(),n=this.dom(s);return this.app.selection.deleteContents(),this.app.caret.set(n,"end"),void this.app.insertion.insertBreakline()}if(!this._deleteInsideSelection(t)){var a=this.app.block.get();a.isEditable()?(t.preventDefault(),this.app.insertion.insertBreakline()):(t.preventDefault(),a.addEmpty({position:"after",caret:"start"}))}}},handleEnter:function(t,e,i){if(this.app.blocks.isMeta())return t.preventDefault(),void this.app.blocks.getLastSelected().addEmpty({position:"after",caret:"start"});if(this.app.blocks.is())return t.preventDefault(),void this.app.selection.deleteContents();if(!this._deleteInsideSelection(t)){var s=this.app.block.get();if(s.isEditable()){if(s.isAllSelected())return t.preventDefault(),void s.setEmpty();if(!this.app.selection.isCollapsed())return t.preventDefault(),void("pre"===s.getType()?this.app.insertion.insertNewline():this.app.insertion.insertBreakline())}s.isEditable()||(t.preventDefault(),s.addEmpty({position:"after",caret:"start"})),s.handleEnter&&s.handleEnter(t,e,i)}},handleTextareaTab:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=t.target,i=e.value,s=e.selectionStart;e.value=i.substring(0,s)+"    "+i.substring(e.selectionEnd),e.selectionStart=e.selectionEnd=s+4},_deleteInsideSelection:function(t){if(!this.app.selection.isCollapsed()){var e=this.app.selection.getNodes({type:"blocks"});if(1<e.length)return t.preventDefault(),this.app.selection.deleteContents(),this.app.caret.set(e[0],"end"),!0}return!1},_doSelectAll:function(t,e){return this._isAllSelected(e)?(this._setEditorEmpty(t,e),!0):e.is("select")?(t.preventDefault(),this.app.editor.selectAll(),!0):void 0},_doArrow:function(t,e,i){var s,n,a=i.getType(),o=["pre","line","image","embed","layer"];if(e.is("up-left")&&i.isCaretStart()){if(n="end",!(s=i.getPrev())&&-1!==o.indexOf(a))return void this.app.insertion.insertEmptyBlock({position:"before",caret:"start"})}else if(e.is("down-right")&&i.isCaretEnd()&&(n="start",!(s=i.getNext())&&-1!==o.indexOf(a)))return void this.app.insertion.insertEmptyBlock({position:"after",caret:"start"});s&&(t.preventDefault(),this.app.block.set(s,n))},_isAllSelected:function(t){return this.app.editor.isAllSelected()&&t.is(["enter","delete","backspace","alpha","space"])},_setEditorEmpty:function(t,e){e.is(["alpha","space"])||t.preventDefault(),this.app.editor.setEmpty()},_trimInvisibleChar:function(t,e,i){var s,n="left"===e?"before":"after",a=this.app.selection.get(),o=this._isInvisibleChar(n);if(o&&"left"===e)s=a.current,this.dom(s).replaceWith(s.textContent.replace(/\s+$/,""));else if(o&&i&&a.current&&a.current.nextSibling)s=a.current.nextSibling,this.dom(s).replaceWith(s.textContent.replace(/^\s+/,""));else if(o&&"right"===e){t.preventDefault();var r=this.app.offset.get();return this.app.offset.set(!1,{start:r.start+1,end:r.end+1}),!0}},_isInvisibleChar:function(t){var e=this.app.selection.get(),i=this.app.selection.getText(t);return e.current&&3===e.current.nodeType&&0===this.app.utils.searchInvisibleChars(i)}}),RedactorX.add("module","shortcut",{init:function(){this.shortcuts=this.opts.shortcuts,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},add:function(t,e){this.shortcuts[t]=e},remove:function(t){this.opts.shortcuts=this._remove(t,this.opts.shortcuts)},popup:function(t,e){var i=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl",s={},n=0;n=this._buildPopupItems(s,n,this.opts.shortcutsBase,i,"base"),this._buildPopupItems(s,n,this.opts.shortcuts,i),this.app.popup.create("shortcuts",{width:"360px",items:s}),this.app.popup.open({button:e})},handle:function(t){if((this.triggered=!1)===this.shortcuts)return!t.ctrlKey&&!t.metaKey||66!==t.which&&73!==t.which||t.preventDefault(),!0;if(t.ctrlKey||t.metaKey||t.shoftKey||t.altKey)for(var e in this.shortcuts)this._build(t,e,this.shortcuts[e]);return this.triggered},_buildPopupItems:function(t,e,i,s,n){for(var a in i){for(var o=this.dom("<div>").addClass(this.prefix+"-popup-shortcut-item"),r="base"===n?i[a]:i[a].title,p=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-title").html(this.lang.parse(r)),l=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-kbd"),h=("base"===n?a.replace("meta",s):i[a].name.replace("meta",s)).split("+"),c=0;c<h.length;c++)h[c]="<span>"+h[c]+"</span>";l.html(h.join("+")),o.append(p),o.append(l),t[e]={html:o},e++}return e},_build:function(t,e,i){for(var s=e.split(","),n=s.length,a=0;a<n;a++)"string"!=typeof s[a]||i.hasOwnProperty("trigger")||this._handler(t,s[a].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var s=this.hotkeys[t.keyCode],n=91!==t.which&&String.fromCharCode(t.which).toLowerCase(),a="",o={},r=["meta","ctrl","alt","shift"],p=0;p<r.length;p++){var l=r[p];t[l+"Key"]&&s!==l&&(a+=l+"+")}93===t.keyCode&&(a+="meta+"),s&&(o[a+s]=!0),n&&(o[a+n]=!0,o[a+this.hotkeysShiftNums[n]]=!0,"shift+"===a&&(o[this.hotkeysShiftNums[n]]=!0));for(var h=e.length,c=0;c<h;c++)if(o[e[c]])return t.preventDefault(),this.triggered=!0,void this.app.api(i.command,i.params,t)},_remove:function(i,s){return Object.keys(s).reduce(function(t,e){return e!==i&&(t[e]=s[e]),t},{})}}),RedactorX.add("module","cleaner",{cleanHtml:function(t){t=this.app.broadcastHtml("editor.before.clean",t);var e={},i=this.opts.paste.blockTags.concat(this.opts.paste.inlineTags).concat(this.opts.paste.formTags),s=this._isPages(t),n=this._isHtmlMsWord(t),a=this._isEditor(t);if(t=this.app.content.store(t,"embed",e,0),t=this.app.content.removeDoctype(t),t=this.app.content.removeTags(t,this.opts.tags.denied),t=this.app.content.removeComments(t),t=this.app.content.removeTagsWithContent(t,["script","style"]),t=s?this._cleanPages(t):t,t=this._cleanGDocs(t),t=this._encodePhp(t),t=this.app.content.removeTagsExcept(t,i),!a){var o=0!==this.opts.paste.keepClass.length?this.opts.paste.keepClass.join(","):"",r=0!==this.opts.paste.keepAttrs.length?this.opts.paste.keepAttrs.join(","):"";t=this.app.utils.wrap(t,function(t){var e=t.find("*");e.not(o).removeAttr("class"),e.not(r).each(function(t){for(var e=t.get(),i=e.attributes,s=i.length-1;0<=s;s--){var n=i[s].name;"class"!==n&&"dir"!==n&&-1===n.search(/^data-/)&&("IMG"===e.tagName&&"src"===n||"A"===e.tagName&&"href"===n||e.removeAttribute(n))}})})}return t=this.app.content.restore(t,"embed",e),t=n?this._cleanMsWord(t):t,t=a?this.app.content.cacheStyle(t):this.app.content.removeStyleAttr(t),t=(t=(t=(t=(t=this.app.content.removeEmptyInlines(t)).replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>")).replace(/^<li/gi,"<ul><li")).replace(/<\/li>$/gi,"</li></ul>"),(n||s)&&(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),t=this.app.utils.wrap(t,function(t){t.find(".Apple-converted-space").unwrap(),t.find("ul, ol").each(this._placeListToItem.bind(this)),t.find("li p").unwrap()}.bind(this)),this.app.broadcastHtml("editor.clean",t)},_encodePhp:function(t){return t=(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},_isEditor:function(t){return t.match(new RegExp('meta\\stype="'+this.prefix+'-editor"',"i"))},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_isPages:function(t){return t.match(/name="Generator"\scontent="Cocoa\sHTML\sWriter"/i)},_placeListToItem:function(t){var e=t.get(),i=e.previousSibling;if(i&&"LI"===i.tagName){var s=this.dom(i);s.find("p").unwrap(),s.append(e)}},_cleanPages:function(t){return t=(t=t.replace(/\sclass="s[0-9]"/gi,"")).replace(/\sclass="p[0-9]"/gi,"")},_cleanGDocs:function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?bold|font-weight:\s?bold;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?600|font-weight:\s?600;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?700|font-weight:\s?700;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style:\s?italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight:\s?(bold|600|700)[^>]*>([\w\W]*?)<\/span>/gi,"<b>$2</b>")},_cleanMsWord:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).trim()).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(t,e){return 0<e.length?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join(""):""});for(var e="",i=(t=(t=(t=(t=(t=this.app.utils.wrap(t,function(t){t.find("p").each(function(t){var e=/mso-list:\w+ \w+([0-9]+)/.exec(t.attr("style"));e&&t.attr("data-listLevel",parseInt(e[1],10))}),this._parseWordLists(t),t.find("[align]").removeAttr("align"),t.find("[name]").removeAttr("name"),t.find("span").each(function(t){var e=t.attr("style");/mso-list:Ignore/.exec(e)?t.remove():t.unwrap()}),t.find("[style]").removeAttr("style"),t.find("[class^='Mso']").removeAttr("class"),t.find("a").filter(function(t){return!t.attr("href")}).unwrap()}.bind(this))).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,"/$1>\n<$2")).split(/\n/),s=0;s<i.length;s++){var n=""!==i[s]&&-1===i[s].search(/>$/)?" ":"\n";e+=i[s]+n}return e=e.trim()},_parseWordLists:function(t){var o=0,r=null,p=null,l=null;t.find("p").each(function(t){var e=t.attr("data-listLevel");if(null===e&&t.hasClass("MsoListParagraphCxSpMiddle")&&(e=1),null!==e){var i=t.text(),s=/^\s*\w+\./.test(i)?"<ol></ol>":"<ul></ul>";if(t.hasClass("MsoListParagraphCxSpFirst")||t.hasClass("MsoNormal")?(p=this.dom(s),t.before(p)):o<e&&0!==o&&(l=this.dom(s),r.append(l),p=l),e<o)for(var n=o-e+1,a=0;a<n;a++)p=p.parent();t.find("span").first().unwrap(),r=this.dom("<li>"+t.html().trim()+"</li>"),null===p&&(t.before(s),p=t.prev()),p.append(r),t.remove(),o=e}else p=null,o=0}.bind(this))}}),RedactorX.add("module","clipboard",{getContent:function(t){var e=this.isPlainText(t)?"text/plain":"text/html",i=t.getData(e);return i="text/plain"==e?this.app.content.escapeHtml(i):i},setContent:function(t,e,i){var s=t.clipboardData;e=this.app.parser.unparse(e),e='<meta type="'+this.prefix+'-editor"/>'+e,i=i||this.app.content.getTextFromHtml(e,{nl:!0}),s.setData("text/html",e),s.setData("text/plain",i)},isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");return(!i||""===i.trim())&&null!==e}}),RedactorX.add("module","autoparse",{parse:function(t){if(!this.opts.paste.autoparse)return t;var e=[];t=this.app.content.storeComments(t,e),t=this.app.content.removeDoctype(t);for(var i=["figure","html","form","pre","div","span","iframe","code","a","img","link","script"],s=["div","img","html","span"],n=[],a=0,o=0;o<i.length;o++){var r=-1!==s.indexOf(i[o])?"<"+i[o]+"[^>]*>":"<"+i[o]+"[^>]*>([\\w\\W]*?)</"+i[o]+">",p=t.match(new RegExp(r,"gi"));if(null!==p)for(var l=0;l<p.length;l++)t=t.replace(p[l],"#####replaceparse"+a+"#####"),n.push(p[l]),a++}if((t=t.replace("&amp;","&")).match(this.opts.regex.url)&&!t.match(this.opts.regex.imageurl)&&(t=this._formatLinks(t)),t.match(this.opts.regex.imageurl)){var h=t.match(this.opts.regex.imageurl);for(o=0;o<h.length;o++)t=t.replace(h[o],'<img src="'+h[o]+'">')}return t=this._restoreReplaced(n,t),t=this.app.content.restoreComments(t,e),t=this._restoreReplaced(n,t)},_formatLinks:function(t){for(var e=t.match(this.opts.regex.url),i={},s=0;s<e.length;s++){var n=e[s],a=n,o=null!==n.match(/(https?|ftp):\/\//i)?"":"http://",r=-1!==["/","&","=","#"].indexOf(n.slice(-1))?"":"\\b",p=!1!==this.opts.paste.linkTarget?' target="'+this.opts.paste.linkTarget+'"':"";a=-1===(a=a.length>this.opts.link.size?a.substring(0,this.opts.link.size)+"...":a).search("%")?decodeURIComponent(a):a,i["("+n.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")+r+")"]='<a href="'+o+n.trim()+'"'+p+">"+a.trim()+"</a>"}for(var l in i)t=t.replace(new RegExp(l,"g"),i[l]);return t},_restoreReplaced:function(t,e){for(var i=0;i<t.length;i++)e=e.replace("#####replaceparse"+i+"#####",t[i]);return e}}),RedactorX.add("module","fragment",{build:function(t){return this.is(t)?t:this.create(t)},insert:function(t){var e=this.app.selection.get();if(e.range){if(e.collapsed){var i=e.range.startContainer;3!==i.nodeType&&"BR"===i.tagName&&i.parentNode.removeChild(i)}else e.range.deleteContents();t.frag?e.range.insertNode(t.frag):e.range.insertNode(t)}},createContainer:function(t){var e=this.dom("<div>");return"string"==typeof t?e.html(t):e.append(this.dom(t).clone(!0)),e.get()},create:function(t){for(var e,i,s,n="string"==typeof t?this.createContainer(t):t,a=document.createDocumentFragment(),o=[],r=0;e=n.firstChild;){r++;var p=a.appendChild(e);1===r&&(i=p),o.push(p),s=p}return{frag:a,first:i,last:s,nodes:o}},is:function(t){return"object"==typeof t&&t.frag}}),RedactorX.add("module","insertion",{init:function(){this._clear()},start:function(){this.win=this.app.$win.get(),this.doc=this.app.$doc.get()},getFirstInserted:function(){return this.inserted.instances[0]},getLastInserted:function(){var t=this.inserted.instances.length,e=this.inserted.instances[t-1];return e&&e.isFigcaption()&&(e=e.getFigure()),e},getInserted:function(){return this.inserted},setContent:function(t){this._insert(t,"set");var e=this.getInserted();return this.inserted=!1,e},insertContent:function(t){this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,e},insertEmptyBlock:function(t){(t=t||{}).html=this.app.block.createHtml(),this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,e},insertNewline:function(t,e){var i=e?"\n\n":"\n";return this._insertFragment({node:document.createTextNode(i)},t||"after")},insertPoint:function(t){var e,i=this.app.utils.createInvisibleChar(),s=t.clientX,n=t.clientY;if(this.doc.caretPositionFromPoint){var a=this.doc.caretPositionFromPoint(s,n);(e=this.doc.getSelection().getRangeAt(0)).setStart(a.offsetNode,a.offset),e.collapse(!0),e.insertNode(i)}else this.doc.caretRangeFromPoint&&(e=this.doc.caretRangeFromPoint(s,n)).insertNode(i);this.app.caret.set(i,"after")},insertBreakline:function(t){var e=this.app.selection.getNodes({type:"inline"});return this.app.selection.isCollapsed()&&0!==e.length?this._splitInline(e,document.createElement("br")):this._insertFragment({node:document.createElement("br")},t||"after")},insertNode:function(t,e,i){if(i){var s=this.app.selection.getNodes({type:"inline"});if(0!==s.length)return this._splitInline(s,t)}return this._insertFragment({node:this.dom(t).get()},e)},insertHtml:function(t,e){return this._insertFragment({html:t},e)},insertText:function(t,e){var i=this.app.block.get();if(!(i&&!i.isEditable()||this.app.blocks.isMeta())){var s,n=this.win.getSelection();if(n.getRangeAt&&n.rangeCount){t=this.app.content.getTextFromHtml(t,{nl:!0}),s=document.createTextNode(t);var a=n.getRangeAt(0);a.deleteContents(),a.insertNode(s),e=e||"end",this.app.caret.set(s,e)}return s}this.insertContent({html:t,caret:e})},insertListToList:function(t,e,i){var s=t.find("li"),n=s.last();s.addClass(this.prefix+"-pasteitems"),n.addClass(this.prefix+"-pastemarker");var a=t.children(),o=this.dom(this.app.selection.getBlock()),r=this.app.caret.is(e,"start"),p=this.app.caret.is(e,"end"),l=this.app.caret.is(o,"start"),h=this.app.caret.is(o,"end",["ul","ol"]);if(r)e.prepend(a);else if(p)e.append(a);else if(this.app.content.isEmptyHtml(o.html()))o.after(a),o.remove();else if(l)o.before(a);else if(h){var c=o.find("ul, ol");0!==c.length?c.prepend(a):o.after(a)}else this.app.element.split(o).before(a);var d=this.prefix+"-pastemarker",u=this.prefix+"-pasteitems";return i&&(n=this.app.editor.getEditor().find("."+d).removeClass(d),this.app.caret.set(n,"end")),this.app.editor.getEditor().find("."+u).removeClass(u)},detectPosition:function(t,e){if(e)return e;var i=this.app.caret.is(t,"start");return e=this.app.caret.is(t,"end")?"after":i?"before":"split"},_insert:function(t,e){this.html=t.html,this.html=this.app.broadcastHtml("editor.before.insert",this.html),this.isParse=void 0===t.parse||t.parse,this.isClean=void 0!==t.clean&&t.clean,this.isCaret=void 0===t.caret||t.caret,this.isPosition=void 0!==t.position&&t.position,this.isCurrent=void 0!==t.current&&t.current,"set"===e||this.app.editor.isAllSelected()?this._setContent():this._insertContent(),this.app.broadcast("editor.insert",this.inserted)},_insertContent:function(){var t,e,i=this.isCurrent?this.isCurrent:this.app.block.get(),s=!1,n=!1;if(this._checkEmpty(),this._checkLine(),this.app.blocks.isMeta()||this.app.blocks.is()){if(this.isEmpty)return;if(this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes(),this.app.blocks.is()){if(!(a=this.app.blocks.getLastSelectedBlock()))return;i=(e=this.dom(a)).dataget("instance"),this.app.selection.deleteContents(),this._insertToEditable(i,e,t)}else{var a;(a=this.app.blocks.getLastSelected()).getBlock().after(t),this.app.blocks.removeSelected(!1)}}else if(!i||this.isPosition){if(this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes();s="top"===this.isPosition||!this.isPosition&&"top"===this.opts.editor.add?(i=this.app.blocks.getFirst(),"before"):i&&-1!==["after","before","append"].indexOf(this.isPosition)?this.isPosition:(i=this.app.blocks.getLast(),"after"),(e=i.getBlock())[s](t)}else if(this._isListToList(i)){this.app.selection.deleteContents(),this._clean(),this._parse(),this._parseBuild(),e=i.getBlock();var o=this.$parsed.children().first();this.$nodes=this.insertListToList(o,e,"end"),this.isCaret=!1}else{if(!i)return;if(i.isEditable()){if(this.isEmpty)return;this._clean(),this._cleanSpecial(i),this.isLine?this._parseLine():this._parse(),this._parseBuild(),i.isEmpty()?(n=!0,s="after"):this.app.selection.deleteContents(),t=this._buildParsedNodes(),e=i.getBlock(),this._insertToEditable(i,e,t,s,n)}else{if(s="after",this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this.isLine?this._parseLine():this._parse(),this._parseBuild(),t=this._buildParsedNodes(),(e=i.getBlock())[s](t)}}this._buildInserted(),this._buildCaret(),this._buildEditor()},_insertToEditable:function(t,e,i,s,n){this.isLine?(this.$nodes=this._insertFragment({fragment:this.$parsed.get()},"end"),this.isCaret=!1):(this.app.content.isEmptyHtml(e.html())?(s="after",n=!0):s=this.detectPosition(e,s),"split"===s?this.app.element.split(e).before(i):e[s](i),n&&t.remove())},_insertFragment:function(t,e){if(t.html||t.fragment){var i=this.app.fragment.build(t.html||t.fragment);this.app.fragment.insert(i)}else this.app.fragment.insert(t.node);if(e){var s=t.node?t.node:"start"===e?i.first:i.last;this.app.caret.set(s,e)}return t.node?this.dom(t.node):this.dom(i.nodes)},_setContent:function(){this._checkEmpty(),this._checkLine(),this.isEmpty?this.html=this.app.block.createHtml():this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild();var t=this._buildParsedNodes();this.app.editor.unsetSelectAll(),this.app.editor.getEditor().html("").append(t),this.isEmpty&&this.app.broadcast("editor.empty"),this._buildInserted(),this._buildCaret(),this._buildEditor()},_splitInline:function(t,e){var i=this.app.element.split(t[0]);return i.before(e),this.app.caret.set(i,"start"),this.dom(e)},_buildEditor:function(){this.app.editor.build(),this.app.editor.setFocus(),this.app.toolbar.observe(),this.app.context.observe()},_buildCaret:function(){if(this.isCaret){var t,e="end";"start"===this.isCaret?(t=this.getFirstInserted(),e="start"):t=this.getLastInserted(),t&&this.app.block.set(t,e)}},_buildInserted:function(){this.inserted={$nodes:this.$nodes,instances:[]},this.inserted.$nodes.each(this._buildInstance.bind(this))},_buildInstance:function(t){var e=t.dataget("instance");e&&this.inserted.instances.push(e)},_buildParsedNodes:function(){return this.$parsed.get().childNodes},_clear:function(){this.html=!1,this.isLine=!1,this.isEmpty=!1,this.isSplit=!1,this.isClean=!1,this.isParse=!0,this.isCaret=!0,this.isCurrent=!1,this.isPosition=!1},_clean:function(){this.isClean&&(this.html=this.app.cleaner.cleanHtml(this.html))},_cleanSpecial:function(t){var e,i,s=t.getType();-1!==["cell","address","figcaption","quoteitem"].indexOf(s)?e=!0:"list"===s&&(e=!0,i=["ul","ol","li"]),e&&(this.isLine=!0,this.html=this.app.content.addBrToBlocks(this.html),this.html=this.app.content.removeBlockTags(this.html,void 0,i),this.html=this.html.replace(/<br\s?\/?>\n?$/gi,""))},_parse:function(){this.isParse&&(this.html=this.app.parser.parse(this.html,!1))},_parseLine:function(){this.isParse&&(this.html=this.app.parser.parseLine(this.html,!1))},_parseBuild:function(){this.$parsed=this.app.parser.build(this.html),this.$nodes=this.$parsed.children()},_checkEmpty:function(){this.isEmpty=this.app.content.isEmptyHtml(this.html)},_checkLine:function(){this.isLine=this.app.content.isLine(this.html)},_isListToList:function(t){var e=t.getBlock().attr("data-"+this.prefix+"-type"),i=this.dom("<div>").html(this.html);return i.find("b").unwrap(),i=i.children().first(),"list"===e&&0!==i.length&&-1!==["ul","ol"].indexOf(i.get().tagName.toLowerCase())}}),RedactorX.add("module","tidy",{init:function(){},parse:function(t){var e=[],i=[];this.lineBefore=new RegExp("^<(/?"+e.join("|/?")+"|"+i.join("|")+")[ >]"),this.lineAfter=new RegExp("^<(/?"+e.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.newLevel=new RegExp("^</?("+["p","ul","ol","div","h1","h2","h3","h4","h5","h6","blockquote","figure","figcaption","table","thead","tbody","tfoot","tr","td","th"].join("|")+")[ >]");var s=0,n=t.length,a=0,o=null,r=null,p="",l="",h="";for(this.cleanlevel=0;s<n;s++){if(a=s,-1===t.substr(s).indexOf("<"))return l+=t.substr(s),this.finish(l);for(;a<n&&"<"!==t.charAt(a);)a++;for(s!==a&&((h=t.substr(s,a-s)).match(/^\s{2,}$/g)||("\n"===l.charAt(l.length-1)?l+=this.getTabs():"\n"===h.charAt(0)&&(l+="\n"+this.getTabs(),h=h.replace(/^\s+/,"")),l+=h)),o=a;a<n&&">"!==t.charAt(a);)a++;var c;if(s=a,"!--"===(p=t.substr(o,a-o)).substr(1,3)){if(!p.match(/--$/)){for(;"--\x3e"!==t.substr(a,3);)a++;a+=2,p=t.substr(o,a-o),s=a}"\n"!==l.charAt(l.length-1)&&(l+="\n"),l+=this.getTabs(),l+=p+">\n"}else"!"===p[1]?l=this.placeTag(p+">",l):"?"===p[1]?l+=p+">\n":c===p.match(/^<(script|style|pre)/i)?(c[1]=c[1].toLowerCase(),p=this.cleanTag(p),l=this.placeTag(p,l),(r=String(t.substr(s+1)).toLowerCase().indexOf("</"+c[1]))&&(h=t.substr(s+1,r),s+=r,l+=h)):(p=this.cleanTag(p),l=this.placeTag(p,l))}return this.finish(l)},getTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="    ";return t},finish:function(t){return t=(t=(t=(t=t.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,"")).replace(/<script(.*?)>\n<\/script>/gi,"<script$1><\/script>"),this.cleanlevel=0,t},cleanTag:function(t){var e,i="",s="";for((t=(t=(t=t.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ")).match(/\/$/)&&(s="/",t=t.replace(/\/+$/,""));e=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)e[2]?i+=e[1].toLowerCase()+"="+e[2]:e[1]&&(i+=e[1].toLowerCase()),i+=" ",t=t.substr(e[0].length);return i.replace(/\s*$/,"")+s+">"},placeTag:function(t,e){var i=t.match(this.newLevel);return(t.match(this.lineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"===t.charAt(1)&&this.cleanlevel--,"\n"===e.charAt(e.length-1)&&(e+=this.getTabs()),i&&"/"!==t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.lineAfter)||t.match(this.newLevel))&&(e=e.replace(/ *$/,""),e+="\n"),e}}),RedactorX.add("module","source",{start:function(){this.eventname=this.prefix+"-source-events",this._build()},toggle:function(){this.is()?this.close():this.open()},is:function(){return"none"===this.app.container.get("editor").css("display")},open:function(){this.app.broadcast("source.before.open");var t=this.app.editor.getContent();t=this.app.tidy.parse(t);var e=this.app.container.get("editor").height();this.$source.height(e),this.$source.val(t),this.$source.on("input."+this.eventname,this._handleChanges.bind(this)),this.$source.on("keydown."+this.eventname,this.app.input.handleTextareaTab.bind(this)),this.app.editor.unselectAll(),this.app.container.get("editor").hide(),this.app.container.get("source").show();var i=this.app.codemirror.create({el:this.$source,height:e,focus:!0});i&&i.on("change",this._handleChanges.bind(this)),this.app.popup.close(),this.app.control.close(),this.app.context.close(),this.app.toolbar.disable(),this.app.toolbar.disableSticky(),this.app.toolbar.setToggled("html"),this.app.broadcast("source.open")},close:function(){this.app.broadcast("source.before.close");var t=this.getContent();this.app.codemirror.destroy(),this.$source.off("."+this.eventname),this.app.container.get("source").hide(),this.app.container.get("editor").show(),this.app.editor.setContent({html:t,caret:!1}),this.app.toolbar.enable(),this.app.toolbar.enableSticky(),this.app.toolbar.unsetToggled("html"),this.app.broadcast("source.close")},update:function(t){var e=this.app.editor.isTextarea()?"val":"html";this.app.$element[e](t)},getContent:function(){var t=this.$source.val();return t=this.app.codemirror.val(t)},_build:function(){this.opts.source&&(this.$source=this.dom("<textarea>").addClass(this.prefix+"-source"),this.$source.attr("data-gramm_editor",!1),this.app.container.get("source").append(this.$source))},_handleChanges:function(t){var e=this.getContent();this.update(e),this.app.broadcast("source.change",{e:t})}}),RedactorX.add("module","toolbar",{init:function(){this.eventname=this.prefix+"-toolbar",this.activeClass="active",this.toggledClass="toggled",this.disableClass="disable",this.customButtons={},this.aTags={},this.aTypes={}},start:function(){this.$container=this.app.container.get("toolbar"),this.opts.toolbar&&(this._build(),this._buildSticky())},load:function(){this._buildActiveButtons(),this.app.block.get()||(this.$toolbar.html(""),this._buildButtons())},build:function(){if(this.opts.toolbar){var t=this.app.block.get();t&&t.isSecondLevel()&&(t=t.getFirstLevel());var e=this.opts.buttons.editor;t&&t.toolbar&&(e=t.toolbar),this.$toolbar.html("");var i=this._createButtons(e,t);t||this._checkIntialToolbar(i)}},observe:function(){if(this.opts.toolbar&&(this.unsetActive(),this.app.observer.isButtons())){var t=this.app.observer.buildButtons(this.aTags,this.aTypes);this._setActiveKeys(t)}},getElement:function(){return this.$toolbar},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setActive:function(t){this.opts.toolbar&&(this._findButtons().removeClass(this.activeClass),this._findButton(t).removeClass(this.disableClass).addClass(this.activeClass))},setToggled:function(t){this.opts.toolbar&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).removeClass(this.disableClass).addClass(this.toggledClass))},unsetActive:function(t){this.opts.toolbar&&(t?this._findButton(t):this._findButtons()).removeClass(this.activeClass)},unsetToggled:function(t){this.opts.toolbar&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this.opts.toolbar&&this._findButtons().removeClass(this.disableClass)},disable:function(t){this.opts.toolbar&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},disableSticky:function(){var t=this.app.container.get("toolbar");t.removeClass(this.prefix+"-toolbar-sticky"),t.css("top","")},enableSticky:function(){if(this.opts.toolbar.sticky){var t=this.app.container.get("toolbar");t.addClass(this.prefix+"-toolbar-sticky"),t.css("top",this.opts.toolbar.stickyTopOffset+"px")}},isSticky:function(){var t=this.app.container.get("toolbar"),e=this.app.container.get("main"),i=e.offset().top+parseInt(e.css("border-top-width")),s=t.offset().top;return i<s||s<i},_build:function(){this.$toolbar=this.dom("<div>").addClass(this.prefix+"-toolbar"),this.$container.append(this.$toolbar),this.$container.addClass("is-"+this.prefix+"-toolbar")},_buildSticky:function(){this.opts.toolbar.sticky&&(this._toggleSticky("add",this.opts.toolbar.stickyTopOffset+"px"),this._startEvent())},_buildButtons:function(){var t=this._createButtons(this.opts.buttons.editor);this._checkIntialToolbar(t)},_buildActiveButtons:function(){var t=this.app.observer.buildActiveButtons(this.customButtons);this.aTags=t.tags,this.aTypes=t.types},_checkIntialToolbar:function(t){if(0===t&&!this.opts.topbar){var e=this.app.blocks.getFirst(),i=e.toolbar;this.$toolbar.html(""),this._createButtons(i,e),this.disable()}},_findButtons:function(){return this.$toolbar.find("."+this.prefix+"-button-toolbar")},_findButton:function(t){return this.$toolbar.find("[data-name="+t+"]")},_createButtons:function(t,e){var i=t;e&&(i=$R.extend(!0,{},t,this.customButtons));var s=0;for(var n in i)"add"===n&&!this.opts.addbar||"html"===n&&!this.opts.source||"format"===n&&!this.opts.format||e&&!e.isAllowedButton(n,i[n])||(this.app.create("button",n,i[n],this.$toolbar,"toolbar"),s++);return s},_setActiveKeys:function(t){for(var e=0;e<t.length;e++)this._findButton(t[e]).addClass(this.activeClass)},_getObservedTags:function(t,e){var i=[];if(t&&i.push(t),0<e.length)for(var s=0;s<e.length;s++)i.push(e[s].tagName.toLowerCase());return i},_toggleSticky:function(t,e){var i="remove"===t?"removeClass":"addClass";this.$container[i](this.prefix+"-toolbar-sticky"),this.$container.css("top",e)},_startEvent:function(){this.app.scroll.getTarget().on("scroll."+this.eventname,this._observeSticky.bind(this))},_stopEvent:function(){this.app.scroll.getTarget().off("."+this.eventname)},_observeSticky:function(){var t=this.app.scroll.getTarget(),e=this.app.scroll.isTarget()?parseInt(t.css("padding-top")):0;this.$container.css("top",0-e+this.opts.toolbar.stickyTopOffset+"px"),this.isSticky()?this.app.broadcast("toolbar.sticky"):this.app.broadcast("toolbar.static")}}),RedactorX.add("module","button",{init:function(t,e,i,s){if("object"==typeof t)this.name=t.name,this.obj=e,this._buildFromElement(t.element);else if(t){this.type=s||!1,this.name=t;var n=this._observe(e);this.obj=void 0===n?e:n,this.obj&&this._build(t,i)}},setColor:function(t,e){var i=t.getName();if("background"===i||"text-color"===i){var s="background"===i?"background-color":"color";this.setBackground(e[s])}},isButton:function(){return!0},isControl:function(){return this._has("control")},getName:function(){return this.name},getTitle:function(){return this.title},getParams:function(){return!!this._has("params")&&this.obj.params},getOffset:function(){return this.$button.offset()},getDimension:function(){return{width:this.$button.width(),height:this.$button.height()}},getElement:function(){return this.$button},setBackground:function(t){this._background("add",t)},resetBackground:function(){this._background("remove","")},_has:function(t){return this.obj.hasOwnProperty(t)},_observe:function(t){return t.hasOwnProperty("observer")&&(t=this.app.api(t.observer,t,this.name)),t},_background:function(t,e){var i="remove"===t?"removeClass":"addClass";this.$icon[i](this.prefix+"-button-icon-color").css({"background-color":e,color:""!==e?this.app.color.invert(e):""})},_buildFromElement:function(t){this.$button=this.dom(t),this.$button.addClass(this.prefix+"-button-target"),this._buildData()},_build:function(t,e){this._buildTitle(),this._buildElement(),this._buildIcon(),this._buildData(e)},_buildData:function(t){this.$button.attr({tabindex:"-1","data-name":this.name,"data-command":this.obj.command||!1}),this.$button.dataset("instance",this);var e=this._has("command")?"_catch":"_stop";this.$button.on("click."+this.prefix+"-button",this[e].bind(this)),this.$button.on("dragstart."+this.prefix+"-button",function(t){t.preventDefault()}),t&&(this._buildTooltip(),this._buildBackground(),this._buildPosition(t))},_buildTitle:function(){this.title=void 0!==this.obj.title?this.lang.parse(this.obj.title):""},_buildElement:function(){this.$button=this.dom('<a href="#"></a>'),this.$button.addClass(this.prefix+"-button "+this.prefix+"-button-target"),this.type&&this.$button.addClass(this.prefix+"-button-"+this.type),this._has("classname")&&this.$button.addClass(this.obj.classname)},_buildIcon:function(){var t=this._has("icon"),e='<span class="'+this.prefix+"-icon-"+this.name+'"></span>';this.$icon=this._buildIconElement(),t&&!0!==this.obj.icon&&(e=-1!==this.obj.icon.search(/</)?this.obj.icon:'<span class="'+this.prefix+"-icon-"+this.obj.icon+'"></span>'),this.$icon.append(e),this.$button.append(this.$icon)},_buildIconElement:function(){return this.dom("<span>").addClass(this.prefix+"-button-icon")},_buildTooltip:function(){"toolbar"===this.type&&this.app.tooltip.build(this.$button,this.title)},_buildBackground:function(){this._has("background")&&this.setBackground(this.obj.background)},_buildPosition:function(t){if(this._has("position")){var e=this.obj.position;if("first"===e)t.prepend(this.$button);else if("object"==typeof e){var i=e.hasOwnProperty("after")?"after":"before",s=e[i],n=this._findPositionElement(s,t);n?n[i](this.$button):t.append(this.$button)}}else t.append(this.$button)},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var s=0;s<t.length&&0===(i=e.find("[data-name="+t[s]+"]")).length;s++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0},_stop:function(t){t.preventDefault(),t.stopPropagation()},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-button-target");if(!e.hasClass("disable")){this.app.editor.setFocus();var i=e.attr("data-command"),s=e.attr("data-name"),n=e.dataget("instance");this.app.api(i,this.getParams(),n,s,t),this.app.tooltip.close()}}}),RedactorX.add("module","tooltip",{build:function(t,e){if(e=!!e&&e.replace(/(<([^>]+)>)/gi,"")){var i=this.prefix+"-button-"+this.uuid;t.attr("data-tooltip",e),t.on("mouseover."+i,this.open.bind(this)),t.on("mouseout."+i,this.close.bind(this))}},open:function(t){if(!this.app.popup.isOpen()){var e=this.dom(t.target).closest("."+this.prefix+"-button-target");if(!e.hasClass("disable")){var i=this.dom("<span>").addClass(this.prefix+"-tooltip").html(e.attr("data-tooltip")),s=e.offset(),n=e.height();i.css({top:s.top+n+"px",left:s.left+"px"}),this.opts.bsmodal&&i.css("z-index",1051),this.app.$body.append(i)}}},close:function(){this.app.$body.find("."+this.prefix+"-tooltip").remove()}}),RedactorX.add("module","codemirror",{init:function(){this.cm=!1},create:function(t){if(this.is()){var e="object"==typeof this.opts.codemirror?this.opts.codemirror:{},i=this.opts.codemirrorSrc?this.opts.codemirrorSrc:CodeMirror;return this.cm=i.fromTextArea(this.dom(t.el).get(),e),t.height&&this.cm.setSize(null,t.height),t.focus&&this.cm.focus(),this.cm}},destroy:function(t){this.cm&&(this.cm.toTextArea(),this.cm=!1)},is:function(){return this.opts.codemirror},val:function(t){return this.is()&&this.cm&&(t=this.cm.getValue()),t}}),RedactorX.add("module","addbar",{init:function(){this.customItems={}},popup:function(t,e){if(this.opts.addbar){this.app.popup.create("addbar",{width:"380px",items:this.buildItems()});var i=e.isButton||e.isControl?{button:e}:{};this.app.popup.open(i)}},add:function(t,e){this.customItems[t]=e,this.customItems[t].container=!0,this.customItems[t].command=e.command?e.command:"block.add",e.template&&(this.customItems[t].params={template:e.template})},buildItems:function(){for(var t={},e=this.opts.buttons.addbar,i=this.opts.buttonsObj,s=0;s<e.length;s++){var n=e[s],a="text"===n?"paragraph":n;this._isHidden(a)||(t[n]=i[n],t[n].container=!0,t[n].icon=!0,t[n].params={name:a})}for(var o in this.opts.addbar.add)this._isHidden(o)||(t[o]=this.opts.addbar.add[o],t[o].container=!0,t[o].command="block.add",t[o].params={template:this.opts.addbar.add[o].template});return t=$R.extend(!0,{},t,this.customItems)},_isHidden:function(t){return-1!==this.opts.addbar.hide.indexOf(t)}}),RedactorX.add("module","format",{popup:function(t,e){for(var i=this.app.block.get(),s=!!i&&i.getTag(),n=this.opts.format,a={},o=0;o<n.length;o++){var r=n[o];a[r]={title:this.opts.formatObj[r].title,params:{tag:r},command:"block.format",shortcut:this.opts.formatObj[r].shortcut,active:r===s}}this.app.popup.create("format",{width:"300px",items:a}),this.app.popup.open({button:e})},set:function(t){if(this.app.popup.close(),!this.app.blocks.isMeta()){var e={type:this.opts.formatObj[t.tag].type,tag:t.tag},i=this.app.blocks.getSelectedBlocks("editable"),s=this.app.block.get();s?this.setSingle(s,e):0!==i.length&&this.setMultiple(i,e)}},setSingle:function(t,e){var i,s=t.isEmpty(),n=!!s&&"start";if(this.tag=t.getTag(),this.type=t.getType(),this.$block=t.getBlock(),s||this.app.selection.saveMarker(),this._isSameTag(e)&&(e=this._checkSameFormat(e)),e&&(this._isListToText(e,"list")?i=this._formatListToText(e):this._isTextToList(e,"list")?this._formatTextToList(e,!1,n):this._replaceTo(t,e,n)),s||this.app.selection.restoreMarker(),i){var a=this.app.selection.getDataBlock();this.app.block.set(a,n)}t=this.app.block.get(),this.app.editor.build(),this.app.broadcast("block.format",{instance:t})},setMultiple:function(t,i){var e,s,n;this.app.selection.saveMarker();for(var a=0;a<t.length;a++)if((n=t[a].tagName.toLowerCase())!==i.tag)if(-1===["ul","ol"].indexOf(n)&&-1!==["ul","ol"].indexOf(i.tag)){s=(e=this.app.create("block."+i.type)).getBlock();var o=this.dom("<li>").html(t[a].innerHTML);s.append(o),(r=this.dom(t[a])).after(s),r.remove()}else if(-1!==["ul","ol"].indexOf(n)&&-1===["ul","ol"].indexOf(i.tag)){var r,p=(r=this.dom(t[a])).find("li");p.find("ul, ol").each(function(t){t.parent().after(t)}),p.find("ul, ol").unwrap(),p.each(function(t){var e=this.dom("<"+i.tag+">");e.html(t.html()),t.remove(),this.app.create("block."+i.type,e),r.before(e)}.bind(this)),r.remove()}else(s=this.app.element.replaceToTag(t[a],i.tag)).removeAttr("style class data-"+this.prefix+"-style-cache"),e=this.app.create("block."+i.type,s);this.app.selection.restoreMarker(),this.app.editor.build(),this.app.editor.unsetSelectAll(),this.app.broadcast("block.format",{instance:e})},_isSameTag:function(t){return this.tag===t.tag&&this.type===t.type},_checkSameFormat:function(t){return-1!==["heading","list","address"].indexOf(this.type)?t=this._buildDefaultFormat():"paragraph"===this.type&&(t=!1),t},_buildDefaultFormat:function(){return{type:"paragraph",tag:"p"}},_formatListToText:function(t){var e=this._getListItems();return this._createItems(e,t),this.$block.remove(),e},_formatTextToList:function(t,e){var i=this.app.create("block."+t.type,"<"+t.tag+">").getBlock(),s=this.dom("<li>").html(this.$block.html());i.append(s),this.app.create("block."+t.type,i),this.$block.after(i),this.$block.remove(),this.app.block.set(i,e)},_replaceTo:function(t,e,i){var s=t.getBlock(),n=this.app.element.replaceToTag(s,e.tag);n.removeAttr("style class data-"+this.prefix+"-style-cache"),this.app.create("block."+e.type,n),this.app.block.set(n,i)},_createItems:function(t,i){t.each(function(t){var e=this.dom("<"+i.tag+">");e.html(t.html()),t.remove(),this.app.create("block."+i.type,e),this.$block.before(e)}.bind(this))},_isListToText:function(t,e){return this.type===e&&-1!==["heading","address","paragraph"].indexOf(t.type)},_isTextToList:function(t,e){return t.type===e&&-1!==["heading","address","paragraph","list"].indexOf(this.type)},_getListItems:function(){var t=this.$block.find("li");return t.find("ul, ol").each(function(t){t.parent().after(t)}),t.find("ul, ol").unwrap(),t}}),RedactorX.add("module","list",{indent:function(t,e){var i=this.app.selection.get(),s=this.app.selection.getBlock(),n=this.dom(s),a=n.prevElement(),o=a.get(),r=i.collapsed&&s&&o&&"LI"===o.tagName;if(this.app.selection.save(s),r){var p=(a=this.dom(o)).children("ul, ol"),l=n.closest("ul, ol");if(0!==p.length)p.append(n);else{var h=l.get().tagName.toLowerCase(),c=this.dom("<"+h+">");c.append(n),a.append(c)}}return this.app.selection.restore(),r},outdent:function(t,e){var i=this.app.selection.get(),s=this.app.selection.getBlock(),n=this.dom(s),a=!1;if(i.collapsed&&s){var o,r,p=n.parent(),l=p.closest("li"),h=n.prevElement(),c=n.nextElement(),d=h.get(),u=c.get(),f=!1===d,m=!1!==d&&!1!==u;if(this.app.selection.save(s),0!==l.length){if(m){o=this._getAllNext(n.get()),r=this.dom("<"+p.get().tagName.toLowerCase()+">");for(var g=0;g<o.length;g++)r.append(o[g]);l.after(n),n.append(r)}else l.after(n),0===p.children().length?p.remove():f&&n.append(p);a=!0}this.app.selection.restore()}return a},_getAllNext:function(t){for(var e=[];t;){if(!(t=this.dom(t).nextElement().get()))return e;e.push(t)}return e}}),RedactorX.add("module","embed",{popups:{insert:{insert:{title:"## buttons.insert ##",command:"embed.insert",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}},save:{save:{title:"## buttons.save ##",command:"embed.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}},edit:{title:"## embed.embed ##",width:"100%",form:{embed:{type:"textarea",label:"## embed.description ##",rows:6},caption:{type:"input",label:"## embed.caption ##"},responsive:{type:"checkbox",text:"## embed.responsive-video ##"}}}},build:function(t){t?this._callScripts(t):this._findScripts()},observe:function(){if(!this.opts.embed)return!1},popup:function(){var t=this.popups.edit;t.footer=this.popups.insert,this.app.popup.create("embed",t),this.app.popup.open({focus:"embed"}),this._buildCodemirror()},edit:function(t){var e=this.app.block.get(),i=this.popups.edit;i.footer=this.popups.save;var s={embed:e.getEmbedCode(),caption:e.getCaption(),responsive:e.isResponsive()};this.app.popup.create("embed",i),this.app.popup.setData(s),this.app.popup.open({focus:"embed"}),this._buildCodemirror()},insert:function(){this.app.popup.close();var t=this.app.popup.getData(),e=this._getEmbedCode(t);if(""!==e){var i=this._createInstance(t,e);this.app.block.add({instance:i})}},save:function(){this.app.popup.close();var t=this.app.block.get(),e=this.app.popup.getData(),i=this._getEmbedCode(e);if(""!==i){var s=this._createInstance(e,i,t);this._isNeedToChange(e,s,t)&&this.app.block.change(s)}else this.app.block.remove()},_buildCodemirror:function(){var t=this.app.popup.getInput("embed");this.app.codemirror.create({el:t,height:"200px",focus:!0}),this.app.popup.updatePosition()},_findScripts:function(){var t=this.app.editor.getEditor().find("[data-"+this.prefix+"-type=embed]").find("script").getAll();this.build.call(this,t)},_callScripts:function(scripts){for(var i=0;i<scripts.length;i++)if(""!==scripts[i].src){var src=scripts[i].src;this.app.$doc.find('head script[src="'+src+'"]').remove();var $script=this.dom("<script>").attr({src:src,async:!0,defer:"true"});$script.on("load",function(){if(-1!==src.search("instagram")){var t=this.app.$win.get();t.instgrm&&t.instgrm.Embeds.process()}this.build(scripts.slice(i+1))}.bind(this));var head=this.app.$doc.get().getElementsByTagName("head")[0];head&&head.appendChild($script.get())}else try{eval(scripts[i].innerHTML)}catch(t){}},_getEmbedCode:function(t){var e=t.embed.trim();return e=this.app.codemirror.val(e),e=this.app.content.sanitize(e),e=this._isHtmlString(e)||""===e?e:this._parseUrl(e)},_createInstance:function(t,e,i){var s;i?(s=i.duplicate().getBlock()).html(e):s=this._isFigure(e)?e:"<figure>"+e+"</figure>";var n=this.app.create("block.embed",s);return n.setCaption(t.caption),t.responsive&&n.addResponsive(),n},_parseUrl:function(t){var e='<iframe width="560" height="315" src="',i='" frameborder="0" allowfullscreen></iframe>';return t.match(this.opts.regex.youtube)?e+t.replace(this.opts.regex.youtube,"//www.youtube.com/embed/$1")+i:t.match(this.opts.regex.vimeo)?e+t.replace(this.opts.regex.vimeo,"//player.vimeo.com/video/$2")+i:t},_isNeedToChange:function(t,e,i){return i.getEmbedCode()!==e.getEmbedCode()||(t.responsive!==i.isResponsive()||(t.caption!==i.getCaption()||void 0))},_isHtmlString:function(t){return/^\s*<(\w+|!)[^>]*>/.test(t)},_isFigure:function(t){return/^<figure/.test(t)}}),RedactorX.add("module","image",{init:function(){this.dataStates=[]},popup:function(){this.app.popup.create("image",{title:"## popup.add-image ##",width:"100%"});var t=this.app.popup.getBody();this.opts.image.url&&this._createImageByUrl(t),this.opts.image.url&&(this.opts.image.upload||this.opts.image.select)&&this._createOrSection(t),this.$upload=this.createUploadBox(this.opts.image.upload,t),this.createSelectBox(this.opts.image.select,t,"image.insertFromSelect"),this._buildUpload(this.$upload,"image.insertByUpload"),this.app.popup.open()},edit:function(t){this.app.popup.create("image-edit",{title:"## popup.image ##",width:"100%",getter:"block.getData",setter:"block.setData",form:{alt:{type:"input",label:"## image.alt-text ##"},caption:{type:"input",label:"## image.caption ##",observer:"image.observeImageCaption"},link:{type:"input",label:"## image.link ##",observer:"image.observeImageLink"},target:{type:"checkbox",text:"## image.link-in-new-tab ##",observer:"image.observeImageLink"}},footer:{save:{title:"## buttons.save ##",command:"image.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}),this._buildEditUpload(),this.app.popup.open()},observe:function(){if(!this.opts.image)return!1},observeStates:function(){this._findImages().each(this._addImageState.bind(this))},observeImageLink:function(t){return!!this.opts.image.link&&t},observeImageCaption:function(t){var e=this.app.block.get();return!(!e||"figure"!==e.getTag())&&t},paste:function(t,e){var i={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:!1,success:"image.insertFromBlob",error:"image.error"};this.app.create("upload").send(e,[t],i)},drop:function(t,e){for(var i=[],s=0;s<e.files.length;s++){var n=e.files[s]||e.items[s].getAsFile();n&&i.push(n)}var a={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:"image.insertByDrop",error:"image.error"};if(0<i.length){var o=this.dom(t.target).closest("[data-"+this.prefix+"-type]");0!==o.length&&this.app.block.set(o),this.app.create("upload").send(t,i,a)}},insertFromClipboard:function(t){var e=t.getData("text/plain")||t.getData("text/html");if(""===(e=e.trim())){for(var i=t.items,s=null,n=0;n<i.length;n++)0===i[n].type.indexOf("image")&&(s=i[n].getAsFile());return null!==s?(this.paste(s),!0):void 0}},insertFromBlob:function(t){this.insert(t)},insertByDrop:function(t,e){if(this.app.block.is()){var i=this.app.block.get(),s=e.target,n=i.getType();if("card"===n&&s&&"IMG"===s.tagName&&i.hasImage()||"image"===n)return void this.change(t);e&&"card"!==n&&i.isEditable()&&this.app.insertion.insertPoint(e)}this.insert(t)},insertByUpload:function(t){this.insert(t)},insertByUrl:function(t){t.preventDefault();var e=this.$urlinput.val();if(""!==e.trim()){var i={file:{url:e,id:this.app.utils.getRandomId()}};this.insert(i)}},insertFromSelect:function(t){t.preventDefault();var e=this.dom(t.target),i={url:e.attr("data-url")},s=e.attr("data-id");null!==s&&(i.id=s),this.insert({file:i})},changeClone:function(t){for(var e in t){this.$imageclone.attr("src",t[e].url);break}this.change(t,!1)},change:function(t,e){!1!==e&&this.app.popup.close();var i=this.app.block.get();for(var s in t)return i.setImage(t[s]),this.app.broadcast("image.change",t[s]),void this.app.broadcast("image.upload",{instance:i,data:t[s]})},save:function(t){this.app.popup.close(),this.app.block.setData(t)},insert:function(t){this.app.popup.close(),this.imageslen=0,this.imagescount=0;var e=this.opts.image.tag;for(var i in t){var s=this.dom("<"+e+">"),n=this._createImageFromResponseItem(t[i]);s.append(n);var a=this.app.create("block.image",s);this.app.block.add({instance:a}),this.app.broadcast("image.upload",{instance:a,data:t[i]}),this.$last=a.getBlock(),this.imageslen++}},error:function(t){this.app.broadcast("image.upload.error",{response:t})},getStates:function(){var t=this._findImages();for(var e in this.dataStates){var i=this.dataStates[e],s=t.is('[data-image="'+i.id+'"]');this._setImageState(i.id,s)}return this.dataStates},createUploadBox:function(t,e){if(t){var i=this.dom("<div>");return e.append(i),i}},createSelectBox:function(t,e,i){t&&(this.$selectbox=this._createImagesBox(e),"object"==typeof t?this._parseList(t,i):this.ajax.get({url:t,data:{d:(new Date).getTime()},success:function(t){this._parseList(t,i)}.bind(this)}))},_findImages:function(){return this.app.editor.getEditor().find("[data-image]")},_addImageState:function(t){var e=t.attr("data-image");this.dataStates[e]={type:"image",status:!0,url:t.attr("src"),$img:t,id:e}},_setImageState:function(t,e){this.dataStates[t].status=e},_checkImageLoad:function(){this.imagescount++,this.imagescount===this.imageslen&&(this.app.block.unset(),this.app.block.set(this.$last))},_buildEditUpload:function(){if(this.opts.image.upload){var t=this.app.block.get(),e=this.app.popup.getBody(),i=this._createFormItem();i.addClass(this.prefix+"-form-item-edit-image-box"),this.$imageclone=t.getImage().clone();var s=this.dom("<div>").addClass(this.prefix+"-form-item-image");s.append(this.$imageclone),i.append(s),this.$upload=this.dom("<div>"),i.append(this.$upload),e.prepend(i),this._buildUpload(this.$upload,"image.changeClone")}},_buildUpload:function(t,e){if(this.opts.image.upload){var i={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:e,error:"image.error"};this.app.create("upload",t,i)}},_createImageFromResponseItem:function(t){var e=this.dom("<img>").attr("src",t.url).one("load",this._checkImageLoad.bind(this));return t.hasOwnProperty("id")&&e.attr("data-image",t.id),t.hasOwnProperty("2x")&&e.attr("srcset",t["2x"]+" 2x"),e},_createImagesBox:function(t){var e=this.dom("<div>").addClass(this.prefix+"-popup-images-box");return t.append(e),e},_createOrSection:function(t){var e=this.dom("<div>").addClass(this.prefix+"-popup-image-section-or");e.html(this.lang.get("image.or")),t.append(e)},_createImageByUrl:function(t){var e=this._createFormItem();this.$urlinput=this._createUrlInput(),this.$urlbutton=this._createUrlButton(),e.append(this.$urlinput),e.append(this.$urlbutton),t.append(e),this.$urlinput.focus()},_createFormItem:function(){return this.dom("<div>").addClass(this.prefix+"-form-container-flex")},_createUrlInput:function(){var t=this.dom("<input>").addClass(this.prefix+"-form-input");return t.attr("placeholder",this.lang.get("image.url-placeholder")),t},_createUrlButton:function(){var t=this.dom("<button>").addClass(this.prefix+"-form-button "+this.prefix+"-form-button-primary");return t.html(this.lang.get("buttons.insert")),t.one("click",this.insertByUrl.bind(this)),t},_parseList:function(t,e){for(var i in t){var s=t[i];if("object"==typeof s){var n=this.dom("<img>"),a=s.thumb?s.thumb:s.url;n.addClass(this.prefix+"-popup-event"),n.attr("src",a),n.attr("data-url",s.url),n.attr("data-callback",e),s.hasOwnProperty("id")&&n.attr("data-id",s.id),n.on("click."+this.prefix+"-popup-event-"+this.uuid,function(t){var e=this.dom(t.target).attr("data-callback");this.app.api(e,t)}.bind(this)),this.$selectbox.append(n)}}}}),RedactorX.add("class","upload",{defaults:{type:"image",box:!1,url:!1,cover:!0,name:"file",data:!1,multiple:!0,placeholder:!1,hidden:!0,target:!1,success:!1,error:!1,remove:!1,trigger:!1,input:!1},init:function(t,e){this.eventname=this.prefix+"-upload",t&&this._build(t,e)},send:function(t,e,i){this.p=this._buildParams(i),this._send(t,e)},complete:function(t,e){this._complete(t,e)},_build:function(t,e){this.p=this._buildParams(e),this.$element=this.dom(t),"INPUT"===this.$element.get().tagName?this._buildByInput():this._buildByBox()},_buildParams:function(t){return $R.extend(!0,this.defaults,t)},_buildByInput:function(){this.$input=this.$element,this.p.box?(this._buildBox(),this._buildPlaceholder()):this.p.input=!0,this._buildAccept(),this._buildMultiple(),this._buildEvents()},_buildByBox:function(){this._buildInput(),this._buildAccept(),this._buildMultiple(),this._buildBox(),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.$box=this.dom("<div>").addClass(this.prefix+"-form-upload-box"),this.$element.before(this.$box),this.p.hidden&&this.$element.hide()},_buildPlaceholder:function(){this.p.placeholder&&(this.$placeholder=this.dom("<span>").addClass(this.prefix+"-form-upload-placeholder"),this.$placeholder.html(this.p.placeholder),this.$box.append(this.$placeholder))},_buildInput:function(){this.$input=this.dom("<input>"),this.$input.attr("type","file"),this.$input.attr("name",this._getUploadParam()),this.$input.hide(),this.$element.before(this.$input)},_buildAccept:function(){if("image"===this.p.type){var t=this.opts.image.types.join(",");this.$input.attr("accept",t)}},_buildMultiple:function(){"image"===this.p.type&&(this.p.multiple?this.$input.attr("multiple","multiple"):this.$input.removeAttr("multiple"))},_buildEvents:function(){this.$input.on("change."+this.eventname+"-"+this.uuid,this._change.bind(this)),!1===this.p.input&&(this.$box.on("click."+this.eventname,this._click.bind(this)),this.$box.on("drop."+this.eventname,this._drop.bind(this)),this.$box.on("dragover."+this.eventname,this._dragover.bind(this)),this.$box.on("dragleave."+this.eventname,this._dragleave.bind(this)))},_buildData:function(t,e,i){if(this.p.multiple)for(var s=0;s<e.length;s++)i.append(t+"[]",e[s]);else i.append(t+"[]",e[0]);return i},_getUploadParam:function(){return this.p.name},_click:function(t){t.preventDefault(),this.$input.click()},_change:function(t){this._send(t,this.$input.get().files)},_drop:function(t){t.preventDefault(),this._send(t)},_dragover:function(t){return t.preventDefault(),this._setStatus("hover"),!1},_dragleave:function(t){return t.preventDefault(),this._removeStatus(),!1},_setStatus:function(t){!this.p.input&&this.p.box&&(this._removeStatus(),this.$box.addClass(this.prefix+"-form-upload-"+t))},_removeStatus:function(){if(!this.p.input&&this.p.box)for(var t=["hover","error"],e=0;e<t.length;e++)this.$box.removeClass(this.prefix+"-form-upload-"+t[e])},_send:function(t,e){e=e||t.dataTransfer.files;var i=new FormData,s=this._getUploadParam();i=this._buildData(s,e,i),i=this.app.utils.extendData(i,this.p.data),this._sendData(t,e,i)},_sendData:function(e,i,s){"function"==typeof this.p.url?this.p.url.call(this.app,this,{data:s,files:i,e:e}):(this.app.progress.show(),this.ajax.post({url:this.p.url,data:s,before:function(t){if(this.app.broadcast("upload.before.send",{xhr:t,data:s,files:i,e:e}).isStopped())return this.app.progress.hide(),!1}.bind(this),success:function(t){this._complete(t,e)}.bind(this)}))},_complete:function(t,e){t&&t.error?(this._setStatus("error"),this.p.error&&(this.app.broadcast("upload.error",{response:t}),this.app.api(this.p.error,t,e))):(this._removeStatus(),this.p.success&&(this.app.broadcast("upload.complete",{response:t}),this.app.api(this.p.success,t,e))),setTimeout(this.app.progress.hide.bind(this.app),500)}}),RedactorX.add("module","inline",{removeFormat:function(){this.app.popup.close();var t=this.app.block.get().getBlock();this.app.selection.save(t);for(var e=this.app.selection.getNodes({type:"inline"}),i=0;i<e.length;i++){var s=this.dom(e[i]);s.attr("data-"+this.prefix+"-type")||s.unwrap()}this.app.selection.restore(),this.app.toolbar.observe(),this.app.context.observe()},set:function(t){if(this.app.popup.isOpen()&&this.app.popup.close(),!(this.app.blocks.isMeta()||this.app.blocks.is()||this.app.editor.isAllSelected())){this.params=t;var e=[];return e=this.app.selection.get().collapsed?this.formatCollapsed():this.formatUncollapsed(),this.app.toolbar.observe(),this.app.context.observe(),this.app.broadcast("inline.format",{nodes:e}),e}},formatCollapsed:function(){var t,e=this.app.selection.getInline(),i=this.dom(e),s=this._getParamsTags(),n=this._isSameTag(e,s),a=!(!this.params||!this.params.caret)&&this.params.caret;if(e)if(this.app.content.isEmptyHtml(e.innerHTML))if(n)this.app.caret.set(e,a||"after"),i.remove();else{var o=this.app.element.replaceToTag(e,this.params.tag);this.app.caret.set(o,a||"start")}else if(n){var r=this.app.content.extractHtmlFromCaret(e),p=this.dom("<"+this.params.tag+" />");p=this.app.element.cloneAttrs(e,p),i.after(p.append(r)),this.app.caret.set(p,a||"before")}else t=this._insertInline(this.params.tag,a);else t=this._insertInline(this.params.tag,a);if(t&&this.params&&void 0!==this.params.attr){var l=this.dom(t);for(var h in this.params.attr)l.attr(h,this.params.attr[h])}return t||[]},formatUncollapsed:function(){var t=this.app.block.get(),e=t.getBlock();this.app.selection.save(e),this._convertTags("u",t),this._convertTags("del",t),this.app.selection.restore();var i=this.app.selection.getNodes({type:"inline"});this.app.selection.save(e),this._convertToStrike(i,t),this.app.selection.restore(),this.app.selection.save(e),document.execCommand("strikethrough");var s=this._revertToInlines(t);this.app.selection.restore();for(var n=[],a=this.app.selection.getText(),o=0;o<s.length;o++)this._isInSelection(s[o],a)&&n.push(s[o]);if(this._clearEmptyStyle(),this.params&&void 0!==this.params.attr)for(var r=0;r<n.length;r++)for(var p in this.params.attr)n[r].setAttribute(p,this.params.attr[p]);if(this.app.selection.save(e),e.get().normalize(),this._revertTags("u",t),this._revertTags("del",t),this.app.selection.restore(),this.params&&this.params.caret){var l=n[n.length-1];this.app.caret.set(l,this.params.caret)}return n},_clearEmptyStyle:function(){for(var t=this.app.selection.getNodes({type:"inline"}),e=0;e<t.length;e++){this._clearEmptyStyleAttr(t[e]);var i=t[e].childNodes;if(i)for(var s=0;s<i.length;s++)this._clearEmptyStyleAttr(i[s])}},_clearEmptyStyleAttr:function(t){3!==t.nodeType&&""===t.getAttribute("style")&&t.removeAttribute("style")},_isSameTag:function(t,e){return t&&-1!==e.indexOf(t.tagName.toLowerCase())},_isInSelection:function(t,e){var i=this.app.utils.removeInvisibleChars(t.textContent);return-1!==e.search(new RegExp(this.app.utils.escapeRegExp(i)))},_insertInline:function(t,e){return this.app.insertion.insertNode(document.createElement(t),e||"start")},_convertTags:function(e,t){this.params.tag!==e&&t.getBlock().find(e).each(function(t){this.app.element.replaceToTag(t,"span").addClass(this.prefix+"-convertable-"+e)}.bind(this))},_revertTags:function(i,t){t.getBlock().find("span."+this.prefix+"-convertable-"+i).each(function(t){var e=this.app.element.replaceToTag(t,i);e.removeClass(this.prefix+"-convertable-"+i),this.app.element.removeEmptyAttrs(e,["class"])&&e.removeAttr("class")}.bind(this))},_convertToStrike:function(t){for(var e=this._getParamsTags(),i=0;i<t.length;i++){var s=t[i],n=this.dom(s),a=t[i].tagName.toLowerCase();-1!==e.indexOf(a)&&this._replaceToStrike(n)}},_getParamsTags:function(){var t=[this.params.tag];return"b"===this.params.tag||"strong"===this.params.tag?t=["b","strong"]:"i"!==this.params.tag&&"em"!==this.params.tag||(t=["i","em"]),t},_replaceToStrike:function(t){t.replaceWith(function(){return this.dom("<strike>").append(t.html())}.bind(this))},_revertToInlines:function(t){var i=[];return t.getBlock().find("strike").each(function(t){var e=this.app.element.replaceToTag(t,this.params.tag);i.push(e.get())}.bind(this)),i}}),RedactorX.add("module","link",{popups:{format:{format:{title:"## link.link ##",command:"link.format",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}},edit:{edit:{title:"## link.edit-link ##",command:"link.format",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}},form:{text:{type:"input",label:"## link.text ##"},url:{type:"input",label:"## link.url ##"},target:{type:"checkbox",text:"## link.link-in-new-tab ##"}},insert:{insert:{title:"## buttons.insert ##",command:"link.insert",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}},save:{save:{title:"## buttons.save ##",command:"link.save",type:"primary"},unlink:{title:"## link.unlink ##",command:"link.unlink",type:"danger"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}},popup:function(t,e){var i=0!==this.getLink().length?this.popups.edit:this.popups.format;this.app.popup.create("link-items",{items:i}),this.app.popup.open({button:e})},format:function(t){this.app.selection.restore();var e=this.getLink(),i=0!==e.length,s=this.app.selection.getText();this.app.selection.save();var n=i?this.popups.save:this.popups.insert;if(this.app.popup.create("link",{title:"## popup.link ##",width:"600px",form:this.popups.form,footer:n}),i){var a={text:e.text(),url:e.attr("href"),target:e.attr("target")||this.opts.link.target};a=this._encodeUrl(a),this.app.popup.setData(a)}else this.app.popup.setData({text:s});var o=i?{focus:"url"}:{focus:s?"url":"text"};this.app.popup.open(o)},insert:function(){this.app.popup.close();var t=this.app.inline.set({tag:"a",caret:"after"}),e=this.dom(t);this._save(e,"add")},save:function(){this.app.popup.close();var t=this.getLink();this._save(t,"change")},unlink:function(){this.app.popup.close();var t=this.app.selection.getNodes({tags:["a"]});if(0!==t.length){for(var e=0;e<t.length;e++){var i=this.dom(t[e]);this.app.broadcast("link.remove",{url:i.attr("href"),text:i.text()}),i.unwrap()}this.app.toolbar.observe(),this.app.context.observe()}},getLink:function(){var t=this.app.selection.getNodes({tags:["a"]});return 0!==t.length?this.dom(t[0]):this.dom()},_save:function(t,e){var i=this.app.popup.getData();i=this._cleanUrl(i),""!==(i=this._encodeUrl(i)).url&&(i=this._setUrl(t,i),1===t.length&&(i=this._setText(t,i)),i=this._setTarget(t,i),this.app.broadcast("link."+e,i))},_cleanUrl:function(t){return t.url=this.app.content.escapeHtml(t.url),t.url=-1!==t.url.search(/^javascript:/i)?"":t.url,t},_encodeUrl:function(t){return t.url=t.url.replace("&amp;","&"),t},_setUrl:function(t,e){return t.attr("href",e.url),e},_setText:function(t,e){return e.text=""===e.text?e.url:e.text,t.text(e.text),e},_setTarget:function(t,e){return e.target?t.attr("target","_blank"):t.removeAttr("target"),e}}),RedactorX.add("module","table",{add:function(){var t=this.app.block.add({name:"table",source:this.opts.table.template,caret:!1}).getFirstCell();t&&this.app.caret.set(t.getBlock(),"start")},observe:function(){if(!this.opts.table)return!1},popup:function(t,e){this.app.popup.create("table",{items:{addhead:{title:"## table.add-head ##",command:"table.addHead"},addcolumnafter:{title:"## table.add-column-after ##",command:"table.addColumnAfter"},addcolumnbefore:{title:"## table.add-column-before ##",command:"table.addColumnBefore"},addrowbelow:{title:"## table.add-row-below ##",command:"table.addRowBelow"},addrowabove:{title:"## table.add-row-above ##",command:"table.addRowAbove"},removehead:{title:"## table.remove-head ##",command:"table.removeHead",divider:"top"},removecolumn:{title:"## table.remove-column ##",command:"table.removeColumn"},removerow:{title:"## table.remove-row ##",command:"table.removeRow"},removetable:{title:"## table.delete-table ##",command:"table.removeTable",divider:"top"}}}),this.app.popup.open({button:e})},addHead:function(){this.removeHead();var t=this.app.block.get().getTable().getBlock(),e=t.find("tr").first().children("td, th").length,i=this.dom("<thead>"),s=this._buildRow(e,"<th>");i.append(s),t.prepend(i),this.app.block.set(s.children("td, th").first(),"start")},addRowBelow:function(){this._addRow("below")},addRowAbove:function(){this._addRow("above")},addColumnBefore:function(){this._addColumn("before")},addColumnAfter:function(){this._addColumn("after")},removeTable:function(){this.app.popup.close(),this.app.block.remove()},removeHead:function(){this.app.popup.close();var t=this.app.block.get().getTable().getBlock().find("thead");0!==t.length&&t.remove()},removeRow:function(){this.app.popup.close(),this.app.control.close(),this.app.block.get().getRow().remove()},removeColumn:function(){this.app.popup.close(),this.app.control.close();var i=this.app.block.get().getBlock(),t=i.closest("table"),e=i.closest("tr"),s=0;e.find("td, th").each(function(t,e){t.get()===i.get()&&(s=e)}),t.find("tr").each(function(t){var e=t.find("td, th").get(s);this.dom(e).remove()}.bind(this))},cellSetting:function(t,e){var i=this.app.block.get();this.app.popup.create("cell",{title:"## table.column ##",width:"300px",form:{width:{type:"input",label:"## table.width ##"},nowrap:{type:"checkbox",text:"## table.nowrap ##"}},footer:{insert:{title:"## buttons.save ##",command:"table.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}).setData({width:i.getWidth(),nowrap:i.getNowrap()}),this.app.popup.open({button:e,focus:"width"})},save:function(t){this.app.popup.close();var e=t.getData(),i=this.app.block.get();""!==e.width&&i.setWidth(e.width),i.setNowrap(e.nowrap)},_addColumn:function(a){this.app.popup.close();var i=this.app.block.get().getBlock(),t=i.closest("table"),s=i.closest("tr"),o=0;s.find("td, th").each(function(t,e){t.get()===i.get()&&(o=e)});var r,p=0;t.find("tr").each(function(t,e){t.get()===s.get()&&(p=e)}),t.find("tr").each(function(t,e){var i=t.find("td, th").get(o),s=this.dom(i),n=s.clone();n.html(""),this.app.create("block.cell",n),p===e&&(r=n),s[a](n)}.bind(this)),r&&this.app.block.set(r,"start")},_addRow:function(t){this.app.popup.close();var e="below"===t?"after":"before",i=this.app.block.get().getBlock(),s=i.closest("tr"),n=i.closest("thead"),a=s.children("td, th").length,o=this._buildRow(a,"<td>");0!==n.length?n.after(o):s[e](o),this.app.block.set(o.find("td, th").first(),"start")},_buildRow:function(t,e){var i=this.dom("<tr>");this.app.create("block.row",i);for(var s=0;s<t;s++){var n=this.dom(e);this.app.create("block.cell",n),i.append(n)}return i}}),RedactorX.add("module","context",{init:function(){this.customButtons={},this.activeClass="active",this.eventname="."+this.prefix+"-context",this.aTags={},this.aTypes={}},start:function(){this.opts.context&&this._build()},stop:function(){this.app.scroll.isTarget()&&this.app.scroll.getTarget().off(this.eventname)},isOpen:function(){this.$context.hasClass("open")},close:function(){this.opts.context&&this._close()},add:function(t,e){this.customButtons[t]=e},observe:function(){this.opts.context&&this._observe()},_doOpen:function(t){!1===this.opts.context||this.app.utils.isMobile()||setTimeout(function(){this._isSelection()?this._open(t):this._close()}.bind(this),0)},_open:function(t){this.$context.html(""),this._buildButtons(),this._buildCustomButtons(),this._buildActiveButtons(),this._buildPosition(t),this._buildEvents(),this._observe()},_close:function(){this.$context.removeClass("open"),this.$context.hide(),this.app.editor.getEditor().off(this.eventname),this.app.scroll.isTarget()&&this.app.scroll.getTarget().off(this.eventname)},_isSelection:function(){if(this.app.blocks.is())return!1;var t=this.app.block.get(),e=t&&t.isEditable(),i=t&&"pre"!==t.getType();return e&&i&&this.app.selection.is()&&!this.app.selection.isCollapsed()},_scroll:function(){var t=this.app.selection.getPosition().bottom+this.app.$doc.scrollTop();if(this.$context.css("top",t+2+"px"),this.app.scroll.isTarget()){var e=this.app.scroll.getTarget(),i=e.offset().top+e.height(),s=e.offset().top;i<t+this.$context.height()||t<s?this.$context.hide():this.$context.show()}},_build:function(){this.$context=this.dom("<div>").addClass(this.prefix+"-context "+this.prefix+"-context-"+this.uuid).hide(),this.app.$body.append(this.$context),this.app.editor.getEditor().on("mouseup."+this.prefix+"-context-up",this._doOpen.bind(this))},_buildButtons:function(){for(var t=this.opts.buttons.context,e=0;e<t.length;e++){var i=t[e],s=this.opts.buttonsObj[i];this.app.create("button",i,s,this.$context,"context")}},_buildCustomButtons:function(){var t=this.customButtons;for(var e in t)this.app.create("button",e,t[e],this.$context,"context")},_buildPosition:function(t){var e=this.app.selection.getPosition(),i=this.$context.width(),s=e.bottom+this.app.$doc.scrollTop(),n=this.app.editor.getRect(),a=t.pageX-i/2;a<n.left&&(a=n.left+4),a+i>n.right&&(a=n.right-i-4),this.$context.css({left:a+"px",top:s+2+"px"}),this.$context.addClass("open"),this.$context.show()},_buildEvents:function(){var t=this.app.editor.getEditor();t.on("mousedown"+this.eventname,this._close.bind(this)),t.on("keydown"+this.eventname,this._close.bind(this)),this.app.scroll.isTarget()&&this.app.scroll.getTarget().on("scroll"+this.eventname,this._scroll.bind(this))},_buildActiveButtons:function(){var t=this.app.observer.buildActiveButtons(this.customButtons);this.aTags=t.tags,this.aTypes=t.types},_observe:function(){if(this._unsetActive(),this.app.observer.isButtons()){var t=this.app.observer.buildButtons(this.aTags,this.aTypes);this._setActiveKeys(t)}},_setActiveKeys:function(t){for(var e=0;e<t.length;e++)this._findButton(t[e]).addClass(this.activeClass)},_unsetActive:function(){this._findButtons().removeClass(this.activeClass)},_findButtons:function(){return this.$context.find("."+this.prefix+"-button-context")},_findButton:function(t){return this.$context.find("[data-name="+t+"]")}}),RedactorX.add("module","topbar",{init:function(){this.activeClass="active",this.toggledClass="disable",this.disableClass="disable",this.customButtons={}},start:function(){this._isTopbar()&&this._build()},load:function(){this._buildButtons()},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setToggled:function(t){this._isTopbar()&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).addClass(this.toggledClass))},unsetToggled:function(t){this._isTopbar()&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this._isTopbar()&&this._findButtons().removeClass(this.disableClass)},disable:function(){this._isTopbar()&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},_isTopbar:function(){return this.opts.topbar},_build:function(){this.$topbar=this.dom("<div>").addClass(this.prefix+"-topbar"),this.app.container.get("toolbar").append(this.$topbar)},_buildButtons:function(){for(var t={},e=this.opts.buttons.topbar,i=0;i<e.length;i++){var s=e[i];t[s]=this.opts.buttonsObj[s]}for(var n in t=$R.extend(!0,{},t,this.customButtons),this.opts.topbar.add&&(t=$R.extend(!0,{},t,this.opts.topbar.add)),t)this.opts.topbar.hide&&-1!==this.opts.topbar.hide.indexOf(n)||this.app.create("button",n,t[n],this.$topbar,"topbar")},_findButtons:function(){return this.$topbar.find("."+this.prefix+"-button-topbar")},_findButton:function(t){return this.$topbar.find("[data-name="+t+"]")}}),RedactorX.add("module","statusbar",{init:function(){this.items={}},start:function(){this._build()},add:function(t,e){return this.update(t,e)},update:function(t,e){var i;return void 0!==this.items[t]?i=this.items[t]:(i=this.dom("<li>"),this.$statusbar.append(i),this.items[t]=i),i.html(e)},get:function(t){return this.items[t]?this.items[t]:this.items},remove:function(t){this.items[t]&&(this.items[t].remove(),delete this.items[t])},clear:function(){this.items={},this.$statusbar.html("")},_build:function(){this.$statusbar=this.dom("<ul>"),this.$statusbar.addClass(this.prefix+"-statusbar "+this.prefix+"-statusbar-"+this.uuid),this.$statusbar.attr("dir",this.opts.editor.direction),this.app.container.get("statusbar").append(this.$statusbar)}}),RedactorX.add("module","control",{init:function(){this.instance=!1,this.customItems={},this.eventName=this.prefix+"-control"},start:function(){this._build()},stop:function(){this.$control.remove(),this.instance=!1},getElement:function(){return this.$control},add:function(t,e){this.customItems[t]=e},build:function(){if(this._isControl()){var t=this.app.block.get();t.isFigcaption()||(t.isSecondLevel()&&(t=t.getFirstLevel()),t?this.open(t):this.close())}},open:function(t){if(this._isControl())if(this.instance=t,this.instance){this.$control.show(),this.updatePosition();var e=this.app.scroll.getTarget();e.on("resize."+this.eventName,this.updatePosition.bind(this)),e.on("scroll."+this.eventName,this.updatePosition.bind(this)),this.$button.off("."+this.prefix+"-control-button"),this.app.$win.off("."+this.prefix+"-control-button"),this.opts.control&&this.$button.on("click."+this.prefix+"-control-button",this._click.bind(this)),this.opts.reorder&&this.$button.on("mousedown."+this.prefix+"-control-button touchstart."+this.prefix+"-control-button",this._press.bind(this))}else this.close()},close:function(){if(this._isControl()){if(this.$control.hide(),this.instance){var t=this.instance.getBlock();this.app.content.unfixListMargin(t)}this.app.scroll.getTarget().off("."+this.eventName),this.instance=!1}},updatePosition:function(){if(this._isControl())if(this.instance){if("list"===this.instance.getType()){var t=this.instance.getBlock();this.app.content.fixListMargin(t)}var e=this.instance.isEditable(),i=this.instance.getOffset(),s=this.$control.width(),n=e?-3:4,a=i.top-n-0,o=i.left-s-0;if(this.$control.show(),this.app.scroll.isTarget()){var r=this.app.scroll.getTarget(),p=r.offset().top+r.height(),l=r.offset().top;(p<a+this.$control.height()||a<l)&&this.$control.hide()}this.$control.css({top:a+"px",left:o+"px"})}else this.close()},_isControl:function(){return this.opts.control||this.opts.reorder},_click:function(t){t.preventDefault(),t.stopPropagation();var e={},i={};e=this.instance.control;for(var s in e=$R.extend(!0,{},e,this.customItems))this.instance.isAllowedButton(s,e[s])&&(i[s]=e[s],i[s].icon=!e[s].icon||e[s].icon,i[s].control=!0);this.app.popup.create("control",{items:i}),this.app.context.close(),this.app.popup.open({control:this.$button})},_press:function(t){t.preventDefault(),t.stopPropagation(),this.app.$win.on("mouseup."+this.prefix+"-control-button touchend."+this.prefix+"-control-button",this._release.bind(this)),this.app.$win.on("mousemove."+this.prefix+"-control-button touchmove."+this.prefix+"-control-button",this._move.bind(this))},_release:function(t){this.$button.removeClass(this.prefix+"-handle"),this.app.$win.off("."+this.prefix+"-control-button"),this.app.observer.trigger=!0,this.app.event.trigger=!1,this.oldY=0,this.dragging=!1,this._trashDragItem(),this.updatePosition(),this.$control.show(),setTimeout(function(){this.app.event.trigger=!0}.bind(this),1)},_move:function(t){if(t.preventDefault(),!this.$button.hasClass(this.prefix+"-handle")){var e=this.instance.getBlock().get();this.$button.addClass(this.prefix+"-handle"),this.dragging=!0,this.$dragItem=this._makeDragItem(e,t.target),this.$control.hide()}var i=!1,s=0===this.oldY?0:this.oldY-t.pageY;0<s?i="up":s<0&&(i="down"),this._moveItem(this.$dragItem,s),this.oldY=t.pageY;var n=t.pageY,a=this.app.editor.getRect(),o=this.app.$doc.scrollTop(),r=o>a.top?o+40:a.top+40,p=this.app.$win.height()+o-40,l=a.top,h=a.top+this.app.editor.getEditor().height();if(this.app.scroll.isTarget()){var c=this.app.scroll.getTarget(),d=c.offset();l=d.top,r=o>a.top?d.top+40:r,p=(h=d.top+c.height())-40}"up"===i&&n<r&&l<n?this._scroll(-10):"down"===i&&p<n&&n<h&&this._scroll(10);for(var u=this.app.editor.getEditor().children(),f=u.length,m=0;m<f;m++){var g=u.eq(m).get();g!==this.$clickItem.get()&&this._isOver(this.dom(g))&&this._swapItems(g)}},_build:function(){this.$control=this.dom("<div>").addClass(this.prefix+"-control "+this.prefix+"-control-"+this.uuid).hide(),this.$button=this.dom("<span>").addClass(this.prefix+"-icon-sort "+this.prefix+"-button-control"),this.$control.append(this.$button),this.opts.bsmodal&&this.$control.css("z-index",1051),this.app.$body.append(this.$control)},_isOver:function(t){var e=this.$dragItem.offset().top,i=t.offset(),s=t.height();return e>i.top&&e<i.top+s},_scroll:function(t){var e=this.app.scroll.isTarget()?this.app.scroll.getTarget():this.app.$win,i=e.scrollTop();e.scrollTop(i+t)},_swapItems:function(t){var e=this.$dragItem.offset().top,i=this.$clickItem,s=this.dom(t),n=s.offset(),a=s.height()/2;s[a+n.top>e?"before":"after"](i)},_moveItem:function(t,e){var i=t.offset().top;i-=e,t.css("top",i+"px"),this.$control.css("top",i+"px")},_makeDragItem:function(t){this._trashDragItem();var e=this.dom(t),i=e.offset();this.$clickItem=e,this.$clickItem.addClass(this.prefix+"-drag-active");var s=e.clone();s.removeClass(this.prefix+"-drag-active "+this.prefix+"-element-active"),s.css({"font-family":e.css("font-family"),"font-size":e.css("font-size"),"line-height":e.css("line-height"),margin:0,padding:0});var n=this.dom("<div>").addClass(this.prefix+"-dragging");return n.append(s),n.css({opacity:.95,position:"absolute","z-index":999,left:i.left+"px",top:i.top+"px",width:e.width()+"px"}),this.app.$body.append(n),n},_trashDragItem:function(){this.$dragItem&&this.$clickItem&&(this.$clickItem.removeClass(this.prefix+"-drag-active"),this.$clickItem=null,this.$dragItem.remove(),this.$dragItem=null)}}),RedactorX.add("module","popup",{defaults:{title:!1,type:!1,width:!1,setter:!1,getter:!1,builder:!1,observer:!1,form:!1,items:!1,focus:!1,footer:!1},init:function(){this.defaultWidth="240px",this.name=!1,this.control=!1,this.data=!1,this.tools=!1,this.params={}},start:function(){this._build(),this._buildDepth()},stop:function(){this._stopEvents(),this.$popup&&this.$popup.remove()},isOpen:function(t){var e=this.$popup.hasClass("open");return t?this._getName()===t&&e:e},get:function(t){return this.params[t]},getElement:function(){return this.$popup},getHeader:function(){return this.$header},getBody:function(){return this.$body},getItems:function(){return this.$items},getFooter:function(){return this.$footer},getName:function(){return this.name},getButton:function(){return this.button},getTool:function(t){return void 0!==this.tools[t]&&this.tools[t]},getInput:function(t){var e=this.getTool(t);return e?e.getInput():this.dom()},getFormItem:function(t){var e=this.getTool(t);return e?e.getInput().closest("."+this.prefix+"-form-item"):this.dom()},getData:function(t){var e;if(t)void 0!==this.tools[t]&&(e=this.tools[t].getValue());else for(var i in e={},this.tools)e[i]=this.tools[i].getValue();return e},set:function(t,e){this.params[t]=e},setFocus:function(t){void 0!==this.tools[t]&&this.tools[t].setFocus()},setWidth:function(t){this.$popup.attr("data-width",t),"100%"===t&&(t=this._getEditorWidth()+"px"),this.$popup.css("width",t),this.app.$win.on("resize."+this.prefix+"-popup-"+this.uuid,this._resize.bind(this)),this._resize()},setData:function(t){this.data=t},has:function(t){return this.params.hasOwnProperty(t)},create:function(t,e){return this.isOpen(t)?this.stack:(this._reset(),this.name=t,this.tools={},this.params=this._buildParams(e),this._buildHeader(),this._buildBody(),this._buildFooter(),this._buildRender(),this.params.observer&&this.app.api(this.params.observer,this),this)},open:function(t){this.isOpen()?this.isOpen(this.name)?this.close(!1):(this.close(!1),this._open(t,!1)):this._open(t)},close:function(t){this.isOpen()&&(t&&this._isPopupTarget(t)||(this._stopEvents(),this._resetToolbarToggledButton(),!1!==t&&(this.app.scroll.save(),this.app.selection.restore(),this.app.scroll.restore()),this.$popup.hide(),this._closed()))},updatePosition:function(t){this._buildPosition(t),this._buildHeight()},_open:function(t,e){t&&t.focus&&this.set("focus",t.focus),!1===e||this.app.blocks.isMeta()||this.app.selection.save(),this._buildButton(t),this._buildControl(t),this._buildName(),this._setToolbarToggledButton(),this._startEvents(),this.app.broadcast("popup.before.open"),this._render(),this._buildPosition(),!1===e?(this.$popup.show(),this._opened()):this.$popup.fadeIn(100,this._opened.bind(this))},_opened:function(){this._buildHeight(),this.$popup.addClass("open"),this.app.broadcast("popup.open"),this._buildFocus()},_closed:function(){this.$popup.removeAttr("data-"+this.prefix+"-popup-name"),this.$popup.removeClass("open"),this.app.broadcast("popup.close")},_render:function(){this._renderHeader(),this._renderWidth(),this._renderType(),this._renderItems(),this._renderForm(),this._renderFooter()},_renderHeader:function(){this.$popup.removeClass("has-header");var t=this.get("title");if(t){this.$header.html(""),this.$popup.addClass("has-header");var e=this.dom("<span>").addClass(this.prefix+"-popup-header-item");e.html(this.lang.parse(t)),this.$header.append(e),this._buildClose()}},_renderType:function(){this.$popup.removeClass(this.prefix+"-popup-type-grid");var t=this.get("type");t&&this.$popup.addClass(this.prefix+"-popup-type-"+t)},_renderWidth:function(){this.setWidth(this.get("width"))},_renderItems:function(){if(this.$popup.removeClass("has-items"),this.items)for(var t in this.$popup.addClass("has-items"),this.$items=this.dom("<div>").addClass(this.prefix+"-popup-items"),this.$body.append(this.$items),this.items){if(this.items[t].hasOwnProperty("observer")){var e=this.app.api(this.items[t].observer,this.items[t],t,this);void 0!==e&&(this.items[t]=e)}if(!1!==this.items[t]){var i=this.app.create("popup.item",this,t,this.items[t]).getElement();this._renderItemPosition(this.$items,i,this.items[t])}}},_renderItemPosition:function(t,e,i){if(i.position){var s=i.position;if("first"===s)t.prepend(e);else if("object"==typeof s){var n=s.hasOwnProperty("after")?"after":"before",a=s[n],o=this._findPositionElement(a,t);o?o[n](e):t.append(e)}}else t.append(e)},_renderForm:function(){this.formitems=this.get("form"),this.formitems&&(this.$form=this.dom("<form>").addClass(this.prefix+"-popup-form"),this._renderTools(),this._renderData(),this.$popup.addClass("has-form"),this.$body.append(this.$form))},_renderTools:function(){for(var t in this.formitems)this._renderTool(t,this.formitems[t])},_renderTool:function(t,e){var i=this.app.create("tool."+e.type,t,e,this,this.data),s=i.getElement();s&&(this.tools[t]=i,this.$form.append(s))},_renderData:function(){if(this.data)for(var t in this.data)void 0!==this.tools[t]&&this.tools[t].setValue(this.data[t])},_renderFooter:function(){this.$popup.removeClass("has-footer");var t=this.get("footer");if(t){this.$footer.html("");var e=0;for(var i in t)if(!1!==t[i]){var s=this.app.create("popup.button",i,this,t[i]);this.$footer.append(s.getElement()),e++}0!==e&&this.$popup.addClass("has-footer")}},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var s=0;s<t.length&&0===(i=e.find("[data-name="+t[s]+"]")).length;s++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0},_build:function(){this.$popup=this.dom("<div>").addClass(this.prefix+"-popup "+this.prefix+"-popup-"+this.uuid).hide(),this.$popup.attr("dir",this.opts.editor.direction),this.app.$body.append(this.$popup)},_buildDepth:function(){this.opts.bsmodal&&(this.$popup.css("z-index",1052),window.jQuery&&jQuery(document).off("focusin.modal"))},_buildParams:function(t){return $R.extend({},!0,this.defaults,t)},_buildButton:function(t){t&&(this.button=!!t.hasOwnProperty("button")&&t.button)},_buildControl:function(t){t&&(this.control=!!t.hasOwnProperty("control")&&t.control)},_buildName:function(){this.$popup.attr("data-"+this.prefix+"-popup-name",this.name).addClass(this.prefix+"-popup-"+this.name)},_buildHeader:function(){this.$header=this.dom("<div>").addClass(this.prefix+"-popup-header"),this.$popup.append(this.$header)},_buildBody:function(){this.$body=this.dom("<div>").addClass(this.prefix+"-popup-body"),this.$popup.append(this.$body)},_buildFooter:function(){this.$footer=this.dom("<div>").addClass(this.prefix+"-popup-footer"),this.$popup.append(this.$footer)},_buildRender:function(){this.params.width=this.params.width?this.params.width:this.defaultWidth,this.params.setter=!!this.params.setter&&this.params.setter,this.params.getter=!!this.params.getter&&this.params.getter,this.data=!!this.params.getter&&this.app.api(this.params.getter,this),this.params.builder?this.items=this.app.api(this.params.builder,this):this.params.items&&(this.items=this.params.items)},_buildFocus:function(){this.has("focus")&&this.setFocus(this.get("focus"))},_buildPosition:function(t){var e;e=this._isButton()&&this.button.isControl()||this._isControl()?this._buildPositionControl():this._isButton()?this._buildPositionButton():this._buildPositionModal(),this.$popup.css({top:e.top-1+"px",left:e.left+"px"})},_buildPositionButton:function(){var t=this.app.editor.getRect(),e=this.button.getOffset(),i=this.button.getDimension(),s=this.$popup.width(),n={};return this._isToolbarButton()||this._isTopbarButton()?(n={top:e.top+i.height,left:e.left}).left+s>t.right&&(n.left=e.left+i.width-s):(n={top:e.top+t.top+i.height,left:e.left+t.left+i.width/2-s/2}).left+s>t.right&&(n.left=t.left+t.width-s),(n.left<t.left||n.left<0)&&(n.left=t.left),n},_buildPositionControl:function(){var t=this.app.block.get();t.isSecondLevel()&&(t=t.getFirstLevel());var e=t.getBlock().offset();return{top:e.top,left:e.left}},_buildPositionModal:function(){var t,e,i;if(this.opts.toolbar){var s=this.app.container.get("toolbar"),n=s.height();e=(t=s.offset()).top+n,i=t.left}else{var a=this.app.block.get();a.isSecondLevel()&&(a=a.getFirstLevel()),e=(t=a.getBlock().offset()).top,i=t.left}return{top:e,left:i}},_buildHeight:function(){var t,e=this.app.scroll.getTarget(),i=(this.app.container.get("main"),this.$popup.offset()),s=(this.app.scroll.isTarget()?(t=i.top-e.offset().top,e.height()-parseInt(e.css("border-bottom-width"))):(t=i.top-e.scrollTop(),e.height()))-t-10;this.$popup.css("max-height",s+"px")},_buildClose:function(){var t=this.dom("<span>").addClass(this.prefix+"-popup-close");t.one("click",this._catchClose.bind(this)),this.$header.append(t)},_reset:function(){this.button=!1,this.control=!1,this.data=!1,this.tools=!1,this.items=!1,this.params={},this.$popup.html(""),this.$popup.removeClass("has-header has-items has-form has-footer "+this.prefix+"-popup-"+this.name)},_resetToolbarToggledButton:function(){if(this.button){var t=this.button.getName();this.app.toolbar.unsetToggled(t)}},_setToolbarToggledButton:function(){if(this.app.toolbar.unsetToggled(),this._isToolbarButton()){var t=this.button.getName();this.app.toolbar.setToggled(t)}},_isButton:function(){return this.button},_isControl:function(){return this.control},_isToolbarButton:function(){return this.button&&"toolbar"===this.button.type},_isTopbarButton:function(){return this.button&&"topbar"===this.button.type},_isPopupTarget:function(t){return 0!==this.dom(t.target).closest("."+this.prefix+"-popup").length},_getName:function(){return this.$popup.attr("data-"+this.prefix+"-popup-name")},_getEditorWidth:function(){var t=this.app.editor.getEditor(),e=parseInt(t.css("padding-left")),i=parseInt(t.css("padding-right"));return t.width()-e-i},_resize:function(){var t=this.$popup.attr("data-width"),e=this._getEditorWidth();if("100%"!==t&&parseInt(t)<e)return;this.$popup.css("width",e+"px")},_startEvents:function(){var t=this.app.scroll.getTarget(),e=this.prefix+"-popup";t.on("resize."+e,this.updatePosition.bind(this)),t.on("scroll."+e,this.updatePosition.bind(this))},_stopEvents:function(){var t=this.prefix+"-popup";this.app.scroll.getTarget().off("."+t)},_catchClose:function(t){t.preventDefault(),t.stopPropagation(),this.close()}}),RedactorX.add("class","popup.item",{defaults:{container:!1,title:!1,html:!1,active:!1,divider:!1,remover:!1,classname:!1,params:!1,instance:!1,observer:!1,command:!1},init:function(t,e,i){this.popup=t,this.name=e,this.params=this._buildParams(i),this._build(),this._buildContainer(),this._buildIcon(),this._buildTitle(),this._buildImage(),this._buildShortcut(),this._buildActive(),this._buildHidden(),this._buildDivider(),this._buildCommand(),this._buildRemover()},getPopup:function(){return this.popup},getName:function(){return this.name},getParams:function(){return this.params.params},getElement:function(){return this.$item},getInstance:function(){return this.params.instance},isControl:function(){return this.params.control},_build:function(){this.$item=this.params.html?this.dom(this.params.html):this.dom("<div>"),this.$item.addClass(this.prefix+"-popup-item "+this.prefix+"-popup-stack-item"),this.$item.attr({"data-name":this.name})},_buildContainer:function(){this.params.container&&this.$item.addClass(this.prefix+"-popup-item-container")},_buildTitle:function(){this.params.title&&(this.$title=this.dom("<span>").addClass(this.prefix+"-popup-item-title"),this.$title.html(this.lang.parse(this.params.title)),this.$item.append(this.$title))},_buildImage:function(){this.params.image&&(this.$image=this.dom("<span>").addClass(this.prefix+"-popup-item-image"),this.$image.html(this.params.image),this.$item.append(this.$image))},_buildIcon:function(){this.params.icon&&(this.$icon=this.dom("<span>").addClass(this.prefix+"-popup-item-icon"),!0===this.params.icon?this.$icon.addClass(this.prefix+"-icon-"+this.name):-1!==this.params.icon.search(/</)?this.$icon.html(this.params.icon):this.$icon.addClass(this.prefix+"-icon-"+this.params.icon),this.$item.append(this.$icon))},_buildShortcut:function(){if(this.params.shortcut){var t=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl";t=this.params.shortcut.replace("Ctrl",t),this.$shortcut=this.dom("<span>").addClass(this.prefix+"-popup-item-shortcut"),this.$shortcut.html(t),this.$item.append(this.$shortcut)}},_buildParams:function(t){return $R.extend({},!0,this.defaults,t)},_buildActive:function(){this.params.active&&this.$item.addClass("active")},_buildHidden:function(){this.params.hidden&&this.$item.addClass(this.prefix+"-popup-item-hidden")},_buildDivider:function(){this.params.divider&&this.$item.addClass(this.prefix+"-popup-item-divider-"+this.params.divider)},_buildCommand:function(){this.params.command&&(this.$item.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catch.bind(this)),this.$item.attr("data-command",this.params.command))},_buildRemover:function(){if(this.params.title&&this.params.remover){var t=this.dom("<span>").addClass(this.prefix+"-popup-item-trash "+this.prefix+"-icon-trash");t.attr("data-command",this.params.remover),t.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catchRemover.bind(this)),this.$item.append(t)}},_catchRemover:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=this.dom(t.target).closest("."+this.prefix+"-popup-item-trash").attr("data-command"),s=e.attr("data-name");this.app.api(i,this,s),e.fadeOut(200,function(t){t.remove()})},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=e.attr("data-name"),s=e.attr("data-command");this.popup.$items.find("."+this.prefix+"-popup-stack-item").removeClass("active"),e.addClass("active"),this.app.api(s,this.getParams(),this,i,t)}}),RedactorX.add("class","popup.button",{init:function(t,e,i){this.name=t,this.obj=i,this.popup=e,this.$button=this.dom("<button>").addClass(this.prefix+"-form-button"),this.$button.attr("data-name",this.name),this.$button.html(this.lang.parse(this.obj.title)),this.$button.dataset("instance",this),this._has("type")&&this.$button.addClass(this.prefix+"-form-button-"+this.obj.type),this._has("classname")&&this.$button.addClass(this.obj.classname),this._has("fullwidth")&&this.$button.addClass(this.prefix+"-form-button-fullwidth"),this.$button.on("click."+this.prefix+"-popup-button"+this.uuid,this._catch.bind(this))},getName:function(){return this.name},getElement:function(){return this.$button},_has:function(t){return this.obj.hasOwnProperty(t)},_catch:function(t){t.preventDefault(),t.stopPropagation(),this._has("command")?this.app.api(this.obj.command,this.popup,this.name,t):this._has("close")&&this.app.popup.close()}}),RedactorX.add("class","tool.checkbox",{mixins:["tool"],type:"checkbox",input:{tag:"input",type:"checkbox",classname:"-form-checkbox"},getValue:function(){return this.$input.val()},_buildInput:function(){if(this.$box=this.dom("<label>").addClass(this.prefix+"-form-checkbox-item"),this.$box.append(this.$input),this._has("text")){var t=this.dom("<span>").html(this.lang.parse(this.obj.text));this.$box.append(t)}this.$tool.append(this.$box)}}),RedactorX.add("class","tool.input",{mixins:["tool"],type:"input",input:{tag:"input",type:"text",classname:"-form-input"},_buildInput:function(){this.$tool.append(this.$input)}}),RedactorX.add("class","tool.number",{mixins:["tool"],type:"number",input:{tag:"input",type:"number",classname:"-form-input"},_buildInput:function(){this.$input.attr("min",0).css("max-width","65px"),this.$tool.append(this.$input)}}),RedactorX.add("class","tool.segment",{mixins:["tool"],type:"segment",input:{tag:"input",type:"hidden",classname:"-form-input"},setValue:function(t){this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),this.$segment.find("[data-segment="+t+"]").addClass("active"),this.$input.val(t)},_buildInput:function(){this.$segment=this.dom("<div>").addClass(this.prefix+"-form-segment").css("max-width","200px");var t=this.obj.segments;for(var e in t){var i=this.dom("<span>").addClass(this.prefix+"-form-segment-item");i.attr("data-segment",e).on("click",this._catchSegment.bind(this)),t[e].hasOwnProperty("icon")?i.html(t[e].icon):i.addClass(this.prefix+"-icon-"+t[e].prefix+"-"+e),this.$segment.append(i)}this.$segment.append(this.$input),this.$tool.append(this.$segment)},_catchSegment:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-form-segment-item"),i=e.attr("data-segment");this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),e.addClass("active"),this.$input.val(i),this.app.api(this.setter,this.popup)}}),RedactorX.add("class","tool.select",{mixins:["tool"],type:"select",input:{tag:"select",classname:"-form-select"},_buildInput:function(){for(var t in this.obj.options){var e=this.dom("<option>");e.val(t),e.html(this.lang.parse(this.obj.options[t])),this.$input.append(e)}this.$tool.append(this.$input)}}),RedactorX.add("class","tool.textarea",{mixins:["tool"],type:"textarea",input:{tag:"textarea",classname:"-form-textarea"},setFocus:function(){this.$input.focus(),this.$input.get().setSelectionRange(0,0),this.$input.scrollTop(0)},_buildInput:function(){this._has("rows")&&this.$input.attr("rows",this._get("rows")),this.$input.attr("data-gramm_editor",!1),this.$tool.append(this.$input)}}),RedactorX.add("block","block.address",{mixins:["block"],type:"address",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},format:{command:"format.popup",icon:!0,title:"## buttons.format ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<address>")},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var s=this.getBlock(),n=s.children(),a=n.length,o=n.eq(a-1),r=n.eq(a-2),p=s.html().trim();if(-1!==(p=this.app.utils.removeInvisibleChars(p)).search(/<br\s?\/?><br\s?\/?>$/))return r.remove(),o.remove(),void this.addEmpty({position:"after",caret:"start"})}return this.app.insertion.insertBreakline(),!0}}),RedactorX.add("block","block.cell",{mixins:["block"],type:"cell",editable:!0,create:function(){return this.dom("<td>")},getTable:function(){return this.getParent("table")},getRow:function(){return this.getParent("row")},getNextCell:function(){var t=this.getNext();if(!t){var e=this.getParent("row");if(e){var i=e.getNextRow();i&&(t=i.getChildFirst("cell"))}}return t},getPrevCell:function(){var t=this.getPrev();if(!t){var e=this.getParent("row");if(e){var i=e.getPrevRow();i&&(t=i.getChildLast("cell"))}}return t},getWidth:function(){var t=this.$block.attr("width");return t||""},getNowrap:function(){return this.$block.hasClass(this.prefix+"-nowrap")},setWidth:function(e){this._eachCell(function(t){""===e?t.removeAttr("width"):t.attr("width",e)})},setNowrap:function(i){this._eachCell(function(t){var e=this.opts.table.nowrap+" "+this.prefix+"-nowrap";i?t.addClass(e):t.removeClass(e)}.bind(this))},handleArrow:function(t,e,i){var s,n,a=this.getTable(),o=a.getBlock(),r=this.app.caret.is(o,"start"),p=this.app.caret.is(o,"end");return i.is("up-left")&&r?(t.preventDefault(),(s=a.getPrev())?this.app.block.set(s,"end"):this.app.insertion.insertEmptyBlock({current:a,position:"before",caret:"start"}),!0):i.is("down-right")&&p?(t.preventDefault(),(n=a.getNext())?this.app.block.set(n,"start"):this.app.insertion.insertEmptyBlock({current:a,position:"after",caret:"start"}),!0):i.is("up-left")&&this.isCaretStart()?(t.preventDefault(),(s=this.getPrevCell())?this.app.block.set(s,"end"):(s=this.getFirstLevel().getPrev())&&this.app.block.set(s,"end"),!0):i.is("down-right")&&this.isCaretEnd()?(t.preventDefault(),(n=this.getNextCell())?this.app.block.set(n,"start"):(n=this.getFirstLevel().getNext())&&this.app.block.set(n,"start"),!0):void 0},handleTab:function(t,e,i){t.preventDefault();var s=this.getNextCell();return s?this.app.block.set(s,"start"):(s=this.getFirstLevel().getNext())&&this.app.block.set(s,"start"),!0},handleEnter:function(t,e,i){return t.preventDefault(),this.app.insertion.insertBreakline(),!0},_eachCell:function(s){var n=0,t=this.$block.closest("table");this.$block.closest("tr").find("td, th").each(function(t,e){t.get()===this.$block.get()&&(n=e)}.bind(this)),t.find("tr").each(function(t){var e=t.find("td, th").get(n),i=this.dom(e);s(i)}.bind(this))}}),RedactorX.add("block","block.pre",{mixins:["block"],type:"pre",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom(this.opts.pre.template)},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption")},handleTab:function(t,e,i){t.preventDefault();var s=this.opts.pre.spaces,n=document.createTextNode(Array(s+1).join(" "));return this.app.insertion.insertNode(n,"end"),!0},handleEnter:function(t,e,i){t.preventDefault();var s=this.$block.html().search(/\n$/);return this.isCaretEnd()&&-1===s?this.app.insertion.insertNewline("after",!0):this.app.insertion.insertNewline(),!0}}),RedactorX.add("block","block.embed",{mixins:["block"],type:"embed",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},embed:{command:"embed.edit",icon:!0,title:"## buttons.embed ##"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},embed:{command:"embed.edit",icon:!0,title:"## buttons.embed ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<figure>")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this._buildEmbedCode()},addResponsive:function(){var t=this.dom("<div>").addClass(this.opts.embed.responsive),e=this.$block.find("figcaption"),i=e.clone(),s=this.getEmbedCode();e.remove(),t.html(s),this.$block.html("").append(t),0!==i.length&&(this.app.create("block.figcaption",i),this.$block.append(i))},removeResponsive:function(){this.$block.find("."+this.opts.embed.responsive).unwrap()},getEmbedCode:function(){return decodeURI(this.$block.attr("data-embed-code"))},isResponsive:function(){return 0!==this.$block.find("."+this.opts.embed.responsive).length},_buildEmbedCode:function(){var t=this.$block.clone();t.find("."+this.opts.embed.responsive).unwrap(),t.find("figcaption").remove();var e=t.html().trim();this.$block.attr("data-embed-code",encodeURI(e))}}),RedactorX.add("block","block.figcaption",{mixins:["block"],type:"figcaption",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},create:function(){return this.dom("<figcaption>")},getFigure:function(){return this.$block.closest("figure").dataget("instance")},handleArrow:function(t,e,i){if(i.is("up-left")&&this.isCaretStart()||i.is("down-right")&&this.isCaretEnd()){t.preventDefault();var s=this.getFigure();return this.app.block.set(s),!0}},handleTab:function(t,e,i){t.preventDefault();var s=this.getFigure();return this.app.block.set(s),!0},handleEnter:function(t,e,i){return t.preventDefault(),this.isEmpty()||this.isCaretEnd()||this.isCaretStart()||this.app.insertion.insertBreakline(),!0}}),RedactorX.add("block","block.heading",{mixins:["block"],type:"heading",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add-after ## ...",divider:"bottom"},format:{command:"format.popup",icon:!0,title:"## buttons.format ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<h2>")},getTitle:function(){var t=this.lang.get("headings"),e=this.getTag(),i=this.$block.attr("data-title");return void 0!==t[e]?t[e]:i},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd())this.addEmpty({position:"after",caret:"start"});else if(this.isCaretStart())this.add({instance:this.duplicateEmpty(),position:"before"});else{var s=this.getBlock(),n=this.app.element.split(s);this.app.block.set(n,"start")}return!0}}),RedactorX.add("block","block.image",{mixins:["block"],type:"image",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},image:{command:"image.edit",icon:!0,title:"## buttons.image-settings ##"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},image:{command:"image.edit",icon:!0,title:"## buttons.image-settings ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<"+this.opts.image.tag+">")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this.data={alt:{getter:"getAlt",setter:"setAlt"},link:{getter:"getLinkUrl",setter:"setLinkUrl"},target:{getter:"getTarget",setter:"setTarget"},caption:{getter:"getCaption",setter:"setCaption"}}},getImage:function(){return this.$block.find("img").eq(0)},getSrc:function(){return this.getImage().attr("src")},getLink:function(){var t=this.getImage().parent();return t="A"===t.get().tagName&&t},getAlt:function(){var t=this.getImage().attr("alt");return t||""},getLinkUrl:function(){var t=this.getLink();return t?t.attr("href"):""},getTarget:function(){var t=this.getLink();return t?t.attr("target"):this.opts.image.newtab},setAlt:function(t){this.getImage().attr("alt",t)},setTarget:function(t){var e=this.getLink();e&&(t?e.attr("target","_blank"):e.removeAttr("target"))},setLinkUrl:function(t){var e=this.getLink();if(""===t&&e)this.removeLink();else{if(!e){var i=this.getImage();e=this.dom("<a>"),i.wrap(e)}e.attr("href",t)}},setImage:function(t){var e=this.getImage();e.attr("src",t.url),t.hasOwnProperty("id")&&e.attr("data-image",t.id),t.hasOwnProperty("2x")&&e.attr("srcset",t["2x"]+" 2x")},removeLink:function(){var t=this.getLink();t&&t.unwrap()}}),RedactorX.add("block","block.line",{mixins:["block"],type:"line",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<hr>")}}),RedactorX.add("block","block.list",{mixins:["block"],type:"list",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"},indent:{title:"## buttons.indent ##",command:"list.indent"},outdent:{title:"## buttons.outdent ##",command:"list.outdent"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},format:{command:"format.popup",icon:!0,title:"## buttons.format ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<ul>")},setCaret:function(t){var e=this.$block;"start"===t?e=this.$block.find("li").first():"end"===t&&(e=this.$block.find("li").last()),this.app.caret.set(e,t)},setEmpty:function(){this.$block.html("");var t=this.dom("<li>");this.$block.append(t),this.app.caret.set(t,"start")},isEmpty:function(){var t=this.$block.html();t=this._cleanEmpty(t);var e=this.$block.find("li");return 0===e.length?""===(t=t.trim()):1===e.length&&(t=e.eq(0).html(),""===(t=this._cleanEmpty(t)))},handleTab:function(t,e,i){var s=this.app.selection.getBlock(),n=this.app.caret.is(s,"start");if(this.app.element.isEmpty(s)&&(t.preventDefault(),this.app.list.indent()))return!0;if(!this.isCaretStart()&&!this.isCaretEnd()){if(this.opts.tab.spaces&&!n)return;return t.preventDefault(),this.app.list.indent(),!0}var a=this.getNext();if(a)return t.preventDefault(),this.app.block.set(a,"start"),!0},handleEnter:function(t,e,i){var s,n,a,o;if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){if(a=this.app.selection.getBlock(),n=this.dom(a),o=this.app.content.isEmptyHtml(a.innerHTML))return n.remove(),this.addEmpty({position:"after",caret:"start"}),!0;s=this.dom("<li>"),this.app.element.cloneAttrs(a,s),this.dom(a).after(s),this.app.caret.set(s,"start")}else if(this.isCaretStart())s=this.dom("<li>"),a=this.app.selection.getBlock(),this.app.element.cloneAttrs(a,s),this.dom(a).before(s);else{a=this.app.selection.getBlock(),n=this.dom(a),o=this.app.content.isEmptyHtml(a.innerHTML);var r=this.app.caret.is(a,"start"),p=this.app.caret.is(a,"end",["ul","ol"]);if(s=this.dom("<li>"),this.app.element.cloneAttrs(a,s),o)n.after(s),this.app.caret.set(s,"start");else if(r)n.before(s);else if(p){var l=n.find("ul, ol").first();0!==l.length&&(s.append(this.app.utils.createInvisibleChar()),s.append(l)),n.after(s),this.app.caret.set(s,"start")}else{var h=this.app.element.split(a);this.app.caret.set(h,"start")}}return!0}}),RedactorX.add("block","block.paragraph",{mixins:["block"],type:"paragraph",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},format:{command:"format.popup",icon:!0,title:"## buttons.format ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom("<p>")},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var s=this.app.block.create();if(this.opts.clean.enter||(s=this.duplicateEmpty()),!this.opts.clean.enterinline){var n=this.app.selection.getInline();if(n){for(var a,o=this.app.element.getAllInlines(n),r=0;r<o.length;r++)if(0===r)(a=o[r].cloneNode()).innerHTML="";else{var p=o[r].cloneNode();p.innerHTML="",a.appendChild(p)}s=this.app.block.create(a.outerHTML)}}this.add({instance:s,position:"after",caret:"start"})}else if(this.isCaretStart()){(s=this.duplicate()).getBlock().html(""),this.add({instance:s,position:"before"})}else{var l=this.getBlock(),h=this.app.element.split(l);this.app.block.set(h,"start")}return!0}}),RedactorX.add("block","block.quote",{mixins:["block"],type:"quote",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom(this.opts.quote.template)},build:function(){this._buildCaption(),this._buildItems("p","quoteitem"),this._buildItems("figcaption","figcaption")},getLast:function(){return this._getLast()},getFirst:function(){return this._getFirst()},getFirstElement:function(){return this._getFirst().getBlock()},_getFirst:function(){return this.$block.find("p").first().dataget("instance")},_getLast:function(){return this.$block.find("p").last().dataget("instance")}}),RedactorX.add("block","block.quoteitem",{mixins:["block"],type:"quoteitem",editable:!0,create:function(){return this.dom("<p>")},getBlockquote:function(){return this.$block.closest("blockquote").dataget("instance")},handleArrow:function(t,e,i){var s=this.getBlockquote(),n=s.getBlock();if(0!==n.length){var a=this.app.caret.is(n,"start"),o=this.app.caret.is(n,"end");if(i.is("up-left")&&a){t.preventDefault();var r=this.getFirstLevel().getPrev();return r?this.app.block.set(r,"end"):this.app.insertion.insertEmptyBlock({current:s,position:"before",caret:"start"}),!0}if(i.is("down-right")&&o){t.preventDefault();var p=this.getFirstLevel().getNext();return p?this.app.block.set(p,"start"):this.app.insertion.insertEmptyBlock({current:s,position:"after",caret:"start"}),!0}}},handleTab:function(t,e,i){t.preventDefault();var s=this.getNext();return s?this.app.block.set(s,"start"):(s=this.getFirstLevel().getNext())&&this.app.block.set(s,"start"),!0},handleEnter:function(t,e,i){t.preventDefault();var s=this.app.create("block.quoteitem");if(this.isEmpty()||this.isCaretEnd())this.add({instance:s,position:"after",caret:"start"});else if(this.isCaretStart())this.add({instance:s,position:"before"});else{var n=this.getBlock(),a=this.app.element.split(n);this.app.block.set(a,"start")}return!0}}),RedactorX.add("block","block.row",{mixins:["block"],type:"row",create:function(){return this.dom("<tr>")},getNextRow:function(){var t=this.getNext(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.nextElement().find("tr").first().dataget("instance")),t},getPrevRow:function(){var t=this.getPrev(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.prevElement().find("tr").last().dataget("instance")),t}}),RedactorX.add("block","block.table",{mixins:["block"],type:"table",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"},format:{title:"## buttons.format ##",command:"format.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"},table:{command:"table.popup",title:"## buttons.table ##"},tune:{command:"table.cellSetting",title:"## buttons.column-settings ##"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add ## ...",divider:"bottom"},table:{command:"table.popup",icon:!0,title:"## buttons.table ##"},tune:{command:"table.cellSetting",icon:!0,title:"## buttons.column-settings ##"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}},create:function(){return this.dom(this.opts.table.template)},build:function(){this._buildItems("tr","row"),this._buildItems("td, th","cell"),this._buildNowrap()},getLast:function(){return this.getLastCell()},getFirst:function(){return this.getFirstCell()},getFirstElement:function(){return this.getFirstCell().getBlock()},getFirstCell:function(){var t=this.$block.find("th, td").first();if(0!==t.length)return t.dataget("instance")},getLastCell:function(){var t=this.$block.find("th, td").last();if(0!==t.length)return t.dataget("instance")},_buildNowrap:function(){this.$block.find("th, td").each(function(t){t.hasClass(this.opts.table.nowrap)&&t.addClass(this.prefix+"-nowrap")}.bind(this))}}),RedactorX.add("block","block.layer",{mixins:["block"],type:"layer",editable:!1,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},html:{title:"## buttons.html ##",command:"source.toggle"}},control:{add:{command:"addbar.popup",icon:!0,title:"## buttons.add-after ## ...",divider:"bottom"},duplicate:{command:"block.duplicate",icon:!0,title:"## buttons.duplicate ##",divider:"bottom"},trash:{command:"block.remove",icon:!0,title:"## buttons.delete ##"}}}),window.RedactorX=RedactorX,window.addEventListener("load",function(){RedactorX("[data-redactorx]")}),"object"==typeof module&&module.exports&&(module.exports=RedactorX,module.exports.RedactorX=RedactorX)}();RedactorX.add("plugin","inlineformat",{translations:{en:{inlineformat:{"inline-format":"Inline Format",underline:"Underline",superscript:"Superscript",subscript:"Subscript",mark:"Mark",code:"Code",shortcut:"Shortcut","remove-format":"Remove Format"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m7.39849577 1.20113038c-3.5610278 2.68125517-5.39849577 5.14152807-5.39849577 7.49360646 0 3.50902886 2.59345039 6.30526316 6 6.30526316 3.4065496 0 6-2.7962343 6-6.30526316 0-2.35207839-1.837468-4.81235129-5.39849577-7.49360646-.35616697-.26817384-.84684149-.26817384-1.20300846 0zm.60150423 2.06186962.28200813.22720401c2.50634097 2.04313256 3.71799187 3.80538426 3.71799187 5.20453283 0 2.43669386-1.73306 4.30526316-4 4.30526316-2.26694005 0-4-1.8685693-4-4.30526316 0-1.39914857 1.21165095-3.16140027 3.71799187-5.20453283z"/></svg>',items:["u","sup","sub","mark","code","kbd"],itemsObj:{u:{title:'<span style="text-decoration: underline;">## inlineformat.underline ##</span>',params:{tag:"u"},shortcut:"Ctrl+u"},sup:{title:"## inlineformat.superscript ##<sup>x</sup>",params:{tag:"sup"},shortcut:"Ctrl+h"},sub:{title:"## inlineformat.subscript ##<sub>x</sub>",params:{tag:"sub"},shortcut:"Ctrl+l"},mark:{title:'<span style="background: yellow;">## inlineformat.mark ##</span>',params:{tag:"mark"}},code:{title:'<span style="font-family: monospace; background: #f0f1f2; padding: 4px;">## inlineformat.code ##</span>',params:{tag:"code"}},kbd:{title:"## inlineformat.shortcut ##",params:{tag:"kbd"}}}},start:function(){this.app.toolbar.add("inlineformat",{title:"## inlineformat.inline-format ##",icon:this.opts.inlineformat.icon,command:"inlineformat.popup",position:{after:"deleted"},blocks:{all:"editable"}})},popup:function(t,i){for(var e=this.opts.inlineformat.items,n=this.app.selection.getNodes({type:"inline"}),a={},o=0;o<e.length;o++){var r=e[o];a[r]=this.opts.inlineformat.itemsObj[r],a[r].command="inline.set"}0!==n.length&&(a.remove={title:"## inlineformat.remove-format ##",divider:"top",command:"inline.removeFormat"}),this.app.popup.create("inlineformat",{width:"300px",items:a}),this.app.popup.open({button:i})}});RedactorX.add("plugin","alignment",{translations:{en:{alignment:{alignment:"Alignment"}}},defaults:{align:{left:"align-left",center:"align-center",right:"align-right",justify:"align-justify"}},start:function(){this.app.toolbar.add("alignment",{title:"## alignment.alignment ##",command:"alignment.popup",blocks:{all:"editable"}})},popup:function(t,n){var a={},i=this.opts.alignment.align;for(var e in i)i[e]&&(a[e]={name:i[e],prefix:"align"});this.app.popup.create("alignment",{setter:"alignment.setAlign",getter:"alignment.getAlign",form:{align:{type:"segment",label:"## alignment.alignment ##",segments:a}}}),this.app.popup.open({button:n})},getAlign:function(){var t=this.opts.alignment.align;if(!t)return!1;var n=this.app.block.get().getBlock(),a="left";for(var i in t)n.hasClass(t[i])&&(a=i);return{align:a}},setAlign:function(t){this.app.popup.close();var n=t.getData();this.app.block.get().setClassFromObj(this.opts.alignment.align,n.align)}});RedactorX.add("plugin","blockcode",{translations:{en:{blockcode:{save:"Save",cancel:"Cancel","edit-code":"Edit Code"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10.6128994 3.20970461.0942074.08318861 4 4c.3604839.36048396.3882135.92771502.0831886 1.32000622l-.0831886.09420734-4 4.00000002c-.3905243.3905243-1.02368929.3905243-1.41421358 0-.36048396-.360484-.3882135-.927715-.08318861-1.3200062l.08318861-.0942074 3.29210678-3.2928932-3.29210678-3.29289322c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734c.36048396-.36048396.92771498-.3882135 1.32000618-.08318861zm-3.90579262.08318861c.36048396.36048396.3882135.92771502.08318861 1.32000622l-.08318861.09420734-3.29210678 3.29289322 3.29210678 3.2928932c.36048396.360484.3882135.927715.08318861 1.3200062l-.08318861.0942074c-.36048396.3604839-.92771502.3882135-1.32000622.0831886l-.09420734-.0831886-4-4.00000002c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734 4-4c.39052429-.39052429 1.02368927-.39052429 1.41421356 0z"/></svg>',popup:{width:"100%",title:"## blockcode.edit-code ##",form:{code:{type:"textarea",rows:"8"}},footer:{save:{title:"## blockcode.save ##",command:"blockcode.save",type:"primary"},cancel:{title:"## blockcode.cancel ##",close:!0}}}},init:function(){this.offset=!1},start:function(){this.app.control.add("blockcode",{icon:this.opts.blockcode.icon,command:"blockcode.edit",title:"## blockcode.edit-code ##",position:{before:"duplicate"}})},edit:function(){var t=this._getCurrent(),e=t.getOuterHtml();e=this.app.parser.unparse(e),t.isEditable()&&(this.offset=this.app.offset.get(t.getBlock())),this.app.popup.create("code",this.opts.blockcode.popup),this.app.popup.setData({code:e}),this.app.popup.open({focus:"code"}),this._buildInputHandle(),this._buildCodemirror()},save:function(){this.app.popup.close();var t=this._getCurrent(),e=this._getCode();if(""!==e){e=this.app.parser.parse(e,!1);var o=this.dom(e),p=this.app.create("block."+t.getType(),o);t.change(p),this.offset&&p.isEditable()&&this.app.offset.set(p.getBlock(),this.offset),this.offset=!1}},_getCurrent:function(){var t=this.app.block.get();return t.isSecondLevel()&&(t=t.getFirstLevel()),t},_getCode:function(){var t=this.app.popup.getData().code.trim();return t=this.app.codemirror.val(t)},_buildInputHandle:function(){this.app.popup.getInput("code").on("keydown",this.app.input.handleTextareaTab.bind(this))},_buildCodemirror:function(){var t=this.app.popup.getInput("code");this.app.codemirror.create({el:t,height:"200px",focus:!0}),this.app.popup.updatePosition()}});RedactorX.add("plugin","imageposition",{translations:{en:{imageposition:{"image-position":"Image position"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m15 13c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-13c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm-5-12c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .44771525 1 1 0 .5522847-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1 0-.55228475.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z"/></svg>',items:{none:"none",left:"float-left",center:"align-center",right:"float-right"},icons:{none:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-5 7-1 1h2zm4-5h-6v5l2-2 3 3h1zm-2 1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z"/></svg>',left:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1s.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z"/></svg>',center:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm3 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1-1-.4477153-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1-1-.4477153-1-1 .44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm4 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm6-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z"/></svg>',right:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m14 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-11 8c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm-10 2c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1zm8-1c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-8-3c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z"/></svg>'}},start:function(){this.app.toolbar.add("imageposition",{title:"## imageposition.image-position ##",command:"imageposition.popup",icon:this.opts.imageposition.icon,position:{after:"image"},blocks:{types:["image"]}})},popup:function(t,i){var s={},o=this.opts.imageposition.items;for(var e in o)o[e]&&(s[e]={name:o[e],icon:this.opts.imageposition.icons[e]});this.app.popup.create("imageposition",{setter:"imageposition.setFloat",getter:"imageposition.getFloat",form:{ifloat:{type:"segment",label:"## imageposition.image-position ##",segments:s}}}),this.app.popup.open({button:i})},getFloat:function(){var t=this.opts.imageposition.items;if(!t)return!1;var i=this.app.block.get().getBlock(),s="none";for(var o in t)i.hasClass(t[o])&&(s=o);return{ifloat:s}},setFloat:function(t){this.app.popup.close();var i=t.getData();this.app.block.get().setClassFromObj(this.opts.imageposition.items,i.ifloat)}});RedactorX.add("plugin","removeformat",{translations:{en:{removeformat:{removeformat:"Remove Format"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 11c.51283584 0 .93550716.3860402.99327227.8833789l.00672773.1166211v1c0 .5522847-.44771525 1-1 1-.51283584 0-.93550716-.3860402-.99327227-.8833789l-.00672773-.1166211v-1c0-.5522847.44771525-1 1-1zm-4.60436072-5.91850958.10436072.05248418 9.5262794 5.5c.4782927.2761424.6421678.8877328.3660254 1.3660254-.2564179.4441289-.8020741.6171529-1.2616646.4185096l-.1043608-.0524842-9.5262794-5.5c-.47829262-.27614237-.64216778-.88773278-.3660254-1.3660254.25641792-.44412886.80207419-.61715287 1.26166468-.41850958zm9.60436072-3.08149042c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4.00016698l.00016698 2c0 .55228475-.44771525 1-1 1-.51283584 0-.93550716-.38604019-.99327227-.88337887l-.00672773-.11662113-.00016698-2h-3.99983302c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z"/></svg>'},start:function(){var o={title:"## removeformat.removeformat ##",icon:this.opts.removeformat.icon,command:"inline.removeFormat",position:{after:["deleted","italic"]},blocks:{all:"editable"}};this.app.toolbar.add("removeformat",o),this.app.context.add("removeformat",o)}});RedactorX.add("plugin","specialchars",{translations:{en:{specialchars:{"special-chars":"Special Characters"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m2 14v-1.8348348h2.38016529v-.0780781c-.99173554-.975976-2.10247934-2.67417419-2.10247934-4.99699701 0-3.57207207 2.28099174-6.09009009 5.73223141-6.09009009 3.43140494 0 5.71239664 2.51801802 5.71239664 6.09009009 0 2.32282282-1.1107438 4.02102101-2.1024793 4.99699701v.0780781h2.3801653v1.8348348h-4.95867769v-1.6396396c1.40826449-1.1906907 2.32066119-2.75225229 2.32066119-5.07507511 0-2.4984985-1.2495868-4.31381382-3.35206614-4.31381382s-3.37190083 1.81531532-3.37190083 4.31381382c0 2.32282282.91239669 3.88438441 2.32066116 5.07507511v1.6396396z"/></svg>',items:["&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&divide;","&hellip;","&trade;","&bull;","&rarr;","&asymp;","$","&euro;","&cent;","&pound;","&yen;","&iexcl;","&curren;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&raquo;","&not;","&reg;","&macr;","&deg;","&sup1;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&ordm;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;"]},start:function(){var a={title:"## specialchars.special-chars ##",icon:this.opts.specialchars.icon,command:"specialchars.popup",blocks:{all:"editable"}};this.app.toolbar.add("specialchars",a)},popup:function(a,e){for(var c={},i=this.opts.specialchars.items,r=0;r<i.length;r++)c[r]={html:this.dom("<div>").addClass(this.prefix+"-popup-item").html(i[r]),command:"specialchars.insert",params:{character:i[r]}};this.app.popup.create("specialchars",{type:"grid",width:"352px",items:c}),this.app.popup.open({button:e})},insert:function(a){this.app.popup.close(),this.app.insertion.insertHtml(a.character,"after")}});RedactorX.add("plugin","textdirection",{translations:{en:{textdirection:{title:"RTL-LTR",ltr:"Left to Right",rtl:"Right to Left"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m3.8 8.10002943c.12590292.09442719.2.24262134.2.4v1.49999997h9c.5522847 0 1 .4477153 1 1 0 .5128359-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-9v1.5c0 .2761424-.22385763.5-.5.5-.15737865 0-.30557281-.0740971-.4-.2l-1.875-2.5c-.13333333-.1777778-.13333333-.4222222 0-.6l1.875-2.49999997c.16568542-.2209139.4790861-.26568543.7-.1zm7.4-6c.2209139-.16568543.5343146-.1209139.7.1l1.875 2.5c.1333333.17777777.1333333.42222222 0 .6l-1.875 2.5c-.0944272.12590292-.2426213.2-.4.2-.2761424 0-.5-.22385763-.5-.5v-1.5h-9c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 8.999-.00002943.001-1.49997057c0-.12590293.0474221-.24592777.1308533-.33724831z"/></svg>'},start:function(){this.app.toolbar.add("textdirection",{title:"## textdirection.title ##",icon:this.opts.textdirection.icon,command:"textdirection.toggle",blocks:{all:"editable",types:["pre"]}})},toggle:function(t,i){var e=this.app.block.get().getBlock().attr("dir"),o={ltr:{title:"## textdirection.ltr ##",command:"textdirection.set"},rtl:{title:"## textdirection.rtl ##",command:"textdirection.set"}};o[e||this.opts.editor.direction].active=!0,this.app.popup.create("textdirection",{items:o}),this.app.popup.open({button:i})},set:function(t,i,e){this.app.popup.close();var o=this.app.block.get().getBlock();this.opts.editor.direction===e?o.removeAttr("dir"):o.attr("dir",e)}});!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(i),i}:t(jQuery)}(function(t){function e(){var t,e=document.createElement("fakeelement"),i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in i)if(void 0!==e.style[t])return i[t]}function i(t){return 9===t?navigator.appVersion.indexOf("MSIE 9.")!==-1:(userAgent=navigator.userAgent,userAgent.indexOf("MSIE ")>-1||userAgent.indexOf("Trident/")>-1)}function n(t){var e=/%|px|em|cm|vh|vw/;return parseInt(String(t).split(e)[0])}function o(e){var i=e.replace(/^.*#/,""),n=t(e);n.attr("id",i+"-tmp"),window.location.hash=e,n.attr("id",i)}var s=t(window),a=t(document),r="iziModal",l={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened",DESTROYED:"destroyed"},d=e(),h=!!/Mobi/.test(navigator.userAgent);window.$iziModal={},window.$iziModal.autoOpen=0,window.$iziModal.history=!1;var c=function(t,e){this.init(t,e)};return c.prototype={constructor:c,init:function(e,i){var n=this;this.$element=t(e),void 0!==this.$element[0].id&&""!==this.$element[0].id?this.id=this.$element[0].id:(this.id=r+Math.floor(1e7*Math.random()+1),this.$element.attr("id",this.id)),this.classes=void 0!==this.$element.attr("class")?this.$element.attr("class"):"",this.content=this.$element.html(),this.state=l.CLOSED,this.options=i,this.width=0,this.timer=null,this.timerTimeout=null,this.progressBar=null,this.isPaused=!1,this.isFullscreen=!1,this.headerHeight=0,this.modalHeight=0,this.$overlay=t('<div class="'+r+'-overlay" style="background-color:'+i.overlayColor+'"></div>'),this.$navigate=t('<div class="'+r+'-navigate"><div class="'+r+'-navigate-caption">Use</div><button class="'+r+'-navigate-prev"></button><button class="'+r+'-navigate-next"></button></div>'),this.group={name:this.$element.attr("data-"+r+"-group"),index:null,ids:[]},this.$element.attr("aria-hidden","true"),this.$element.attr("aria-labelledby",this.id),this.$element.attr("role","dialog"),this.$element.hasClass("iziModal")||this.$element.addClass("iziModal"),void 0===this.group.name&&""!==i.group&&(this.group.name=i.group,this.$element.attr("data-"+r+"-group",i.group)),this.options.loop===!0&&this.$element.attr("data-"+r+"-loop",!0),t.each(this.options,function(t,e){var o=n.$element.attr("data-"+r+"-"+t);try{"undefined"!=typeof o&&(""===o||"true"==o?i[t]=!0:"false"==o?i[t]=!1:"function"==typeof e?i[t]=new Function(o):i[t]=o)}catch(s){}}),i.appendTo!==!1&&this.$element.appendTo(i.appendTo),i.iframe===!0?(this.$element.html('<div class="'+r+'-wrap"><div class="'+r+'-content"><iframe class="'+r+'-iframe"></iframe>'+this.content+"</div></div>"),null!==i.iframeHeight&&this.$element.find("."+r+"-iframe").css("height",i.iframeHeight)):this.$element.html('<div class="'+r+'-wrap"><div class="'+r+'-content">'+this.content+"</div></div>"),null!==this.options.background&&this.$element.css("background",this.options.background),this.$wrap=this.$element.find("."+r+"-wrap"),null===i.zindex||isNaN(parseInt(i.zindex))||(this.$element.css("z-index",i.zindex),this.$navigate.css("z-index",i.zindex-1),this.$overlay.css("z-index",i.zindex-2)),""!==i.radius&&this.$element.css("border-radius",i.radius),""!==i.padding&&this.$element.find("."+r+"-content").css("padding",i.padding),""!==i.theme&&("light"===i.theme?this.$element.addClass(r+"-light"):this.$element.addClass(i.theme)),i.rtl===!0&&this.$element.addClass(r+"-rtl"),i.openFullscreen===!0&&(this.isFullscreen=!0,this.$element.addClass("isFullscreen")),this.createHeader(),this.recalcWidth(),this.recalcVerticalPos(),!n.options.afterRender||"function"!=typeof n.options.afterRender&&"object"!=typeof n.options.afterRender||n.options.afterRender(n)},createHeader:function(){this.$header=t('<div class="'+r+'-header"><h2 class="'+r+'-header-title">'+this.options.title+'</h2><p class="'+r+'-header-subtitle">'+this.options.subtitle+'</p><div class="'+r+'-header-buttons"></div></div>'),this.options.closeButton===!0&&this.$header.find("."+r+"-header-buttons").append('<a href="javascript:void(0)" class="'+r+"-button "+r+'-button-close" data-'+r+"-close></a>"),this.options.fullscreen===!0&&this.$header.find("."+r+"-header-buttons").append('<a href="javascript:void(0)" class="'+r+"-button "+r+'-button-fullscreen" data-'+r+"-fullscreen></a>"),this.options.timeoutProgressbar===!0&&this.$header.prepend('<div class="'+r+'-progressbar"><div style="background-color:'+this.options.timeoutProgressbarColor+'"></div></div>'),""===this.options.subtitle&&this.$header.addClass(r+"-noSubtitle"),""!==this.options.title&&(null!==this.options.headerColor&&(this.options.borderBottom===!0&&this.$element.css("border-bottom","3px solid "+this.options.headerColor),this.$header.css("background",this.options.headerColor)),null===this.options.icon&&null===this.options.iconText||(this.$header.prepend('<i class="'+r+'-header-icon"></i>'),null!==this.options.icon&&this.$header.find("."+r+"-header-icon").addClass(this.options.icon).css("color",this.options.iconColor),null!==this.options.iconText&&this.$header.find("."+r+"-header-icon").html(this.options.iconText)),this.$element.css("overflow","hidden").prepend(this.$header))},setGroup:function(e){var i=this,n=this.group.name||e;if(this.group.ids=[],void 0!==e&&e!==this.group.name&&(n=e,this.group.name=n,this.$element.attr("data-"+r+"-group",n)),void 0!==n&&""!==n){var o=0;t.each(t("."+r+"[data-"+r+"-group="+n+"]"),function(e,n){i.group.ids.push(t(this)[0].id),i.id==t(this)[0].id&&(i.group.index=o),o++})}},toggle:function(){this.state==l.OPENED&&this.close(),this.state==l.CLOSED&&this.open()},startProgress:function(t){var e=this;this.isPaused=!1,clearTimeout(this.timerTimeout),this.options.timeoutProgressbar===!0?(this.progressBar={hideEta:null,maxHideTime:null,currentTime:(new Date).getTime(),el:this.$element.find("."+r+"-progressbar > div"),updateProgress:function(){if(!e.isPaused){e.progressBar.currentTime=e.progressBar.currentTime+10;var t=(e.progressBar.hideEta-e.progressBar.currentTime)/e.progressBar.maxHideTime*100;e.progressBar.el.width(t+"%"),t<0&&e.close()}}},t>0&&(this.progressBar.maxHideTime=parseFloat(t),this.progressBar.hideEta=(new Date).getTime()+this.progressBar.maxHideTime,this.timerTimeout=setInterval(this.progressBar.updateProgress,10))):this.timerTimeout=setTimeout(function(){e.close()},e.options.timeout)},pauseProgress:function(){this.isPaused=!0},resumeProgress:function(){this.isPaused=!1},resetProgress:function(t){clearTimeout(this.timerTimeout),this.progressBar={},this.$element.find("."+r+"-progressbar > div").width("100%")},open:function(e){function i(){s.state=l.OPENED,s.$element.trigger(l.OPENED),!s.options.onOpened||"function"!=typeof s.options.onOpened&&"object"!=typeof s.options.onOpened||s.options.onOpened(s)}function n(){s.$element.off("click","[data-"+r+"-close]").on("click","[data-"+r+"-close]",function(e){e.preventDefault();var i=t(e.currentTarget).attr("data-"+r+"-transitionOut");void 0!==i?s.close({transition:i}):s.close()}),s.$element.off("click","[data-"+r+"-fullscreen]").on("click","[data-"+r+"-fullscreen]",function(t){t.preventDefault(),s.isFullscreen===!0?(s.isFullscreen=!1,s.$element.removeClass("isFullscreen")):(s.isFullscreen=!0,s.$element.addClass("isFullscreen")),s.options.onFullscreen&&"function"==typeof s.options.onFullscreen&&s.options.onFullscreen(s),s.$element.trigger("fullscreen",s)}),s.$navigate.off("click","."+r+"-navigate-next").on("click","."+r+"-navigate-next",function(t){s.next(t)}),s.$element.off("click","[data-"+r+"-next]").on("click","[data-"+r+"-next]",function(t){s.next(t)}),s.$navigate.off("click","."+r+"-navigate-prev").on("click","."+r+"-navigate-prev",function(t){s.prev(t)}),s.$element.off("click","[data-"+r+"-prev]").on("click","[data-"+r+"-prev]",function(t){s.prev(t)})}var s=this;try{void 0!==e&&e.preventClose===!1&&t.each(t("."+r),function(e,i){if(void 0!==t(i).data().iziModal){var n=t(i).iziModal("getState");"opened"!=n&&"opening"!=n||t(i).iziModal("close")}})}catch(c){}if(function(){if(s.options.history){var t=document.title;document.title=t+" - "+s.options.title,o("#"+s.id),document.title=t,window.$iziModal.history=!0}else window.$iziModal.history=!1}(),this.state==l.CLOSED){if(n(),this.setGroup(),this.state=l.OPENING,this.$element.trigger(l.OPENING),this.$element.attr("aria-hidden","false"),this.options.timeoutProgressbar===!0&&this.$element.find("."+r+"-progressbar > div").width("100%"),this.options.iframe===!0){this.$element.find("."+r+"-content").addClass(r+"-content-loader"),this.$element.find("."+r+"-iframe").on("load",function(){t(this).parent().removeClass(r+"-content-loader")});var u=null;try{u=""!==t(e.currentTarget).attr("href")?t(e.currentTarget).attr("href"):null}catch(c){}if(null===this.options.iframeURL||null!==u&&void 0!==u||(u=this.options.iframeURL),null===u||void 0===u)throw new Error("Failed to find iframe URL");this.$element.find("."+r+"-iframe").attr("src",u)}(this.options.bodyOverflow||h)&&(t("html").addClass(r+"-isOverflow"),h&&t("body").css("overflow","hidden")),this.options.onOpening&&"function"==typeof this.options.onOpening&&this.options.onOpening(this),function(){if(s.group.ids.length>1){s.$navigate.appendTo("body"),s.$navigate.addClass("fadeIn"),s.options.navigateCaption===!0&&s.$navigate.find("."+r+"-navigate-caption").show();var n=s.$element.outerWidth();s.options.navigateArrows!==!1?"closeScreenEdge"===s.options.navigateArrows?(s.$navigate.find("."+r+"-navigate-prev").css("left",0).show(),s.$navigate.find("."+r+"-navigate-next").css("right",0).show()):(s.$navigate.find("."+r+"-navigate-prev").css("margin-left",-(n/2+84)).show(),s.$navigate.find("."+r+"-navigate-next").css("margin-right",-(n/2+84)).show()):(s.$navigate.find("."+r+"-navigate-prev").hide(),s.$navigate.find("."+r+"-navigate-next").hide());var o;0===s.group.index&&(o=t("."+r+"[data-"+r+'-group="'+s.group.name+'"][data-'+r+"-loop]").length,0===o&&s.options.loop===!1&&s.$navigate.find("."+r+"-navigate-prev").hide()),s.group.index+1===s.group.ids.length&&(o=t("."+r+"[data-"+r+'-group="'+s.group.name+'"][data-'+r+"-loop]").length,0===o&&s.options.loop===!1&&s.$navigate.find("."+r+"-navigate-next").hide())}s.options.overlay===!0&&(s.options.appendToOverlay===!1?s.$overlay.appendTo("body"):s.$overlay.appendTo(s.options.appendToOverlay)),s.options.transitionInOverlay&&s.$overlay.addClass(s.options.transitionInOverlay);var a=s.options.transitionIn;"object"==typeof e&&(void 0===e.transition&&void 0===e.transitionIn||(a=e.transition||e.transitionIn),void 0!==e.zindex&&s.setZindex(e.zindex)),""!==a&&void 0!==d?(s.$element.addClass("transitionIn "+a).show(),s.$wrap.one(d,function(){s.$element.removeClass(a+" transitionIn"),s.$overlay.removeClass(s.options.transitionInOverlay),s.$navigate.removeClass("fadeIn"),i()})):(s.$element.show(),i()),s.options.pauseOnHover!==!0||s.options.pauseOnHover!==!0||s.options.timeout===!1||isNaN(parseInt(s.options.timeout))||s.options.timeout===!1||0===s.options.timeout||(s.$element.off("mouseenter").on("mouseenter",function(t){t.preventDefault(),s.isPaused=!0}),s.$element.off("mouseleave").on("mouseleave",function(t){t.preventDefault(),s.isPaused=!1}))}(),this.options.timeout===!1||isNaN(parseInt(this.options.timeout))||this.options.timeout===!1||0===this.options.timeout||s.startProgress(this.options.timeout),this.options.overlayClose&&!this.$element.hasClass(this.options.transitionOut)&&this.$overlay.click(function(){s.close()}),this.options.focusInput&&this.$element.find(":input:not(button):enabled:visible:first").focus(),function p(){s.recalcLayout(),s.timer=setTimeout(p,300)}(),a.on("keydown."+r,function(t){s.options.closeOnEscape&&27===t.keyCode&&s.close()})}},close:function(e){function i(){n.state=l.CLOSED,n.$element.trigger(l.CLOSED),n.options.iframe===!0&&n.$element.find("."+r+"-iframe").attr("src",""),(n.options.bodyOverflow||h)&&(t("html").removeClass(r+"-isOverflow"),h&&t("body").css("overflow","auto")),n.options.onClosed&&"function"==typeof n.options.onClosed&&n.options.onClosed(n),n.options.restoreDefaultContent===!0&&n.$element.find("."+r+"-content").html(n.content),0===t("."+r+":visible").length&&t("html").removeClass(r+"-isAttached")}var n=this;if(this.state==l.OPENED||this.state==l.OPENING){a.off("keydown."+r),this.state=l.CLOSING,this.$element.trigger(l.CLOSING),this.$element.attr("aria-hidden","true"),clearTimeout(this.timer),clearTimeout(this.timerTimeout),n.options.onClosing&&"function"==typeof n.options.onClosing&&n.options.onClosing(this);var o=this.options.transitionOut;"object"==typeof e&&(void 0===e.transition&&void 0===e.transitionOut||(o=e.transition||e.transitionOut)),o===!1||""===o||void 0===d?(this.$element.hide(),this.$overlay.remove(),this.$navigate.remove(),i()):(this.$element.attr("class",[this.classes,r,o,"light"==this.options.theme?r+"-light":this.options.theme,this.isFullscreen===!0?"isFullscreen":"",this.options.rtl?r+"-rtl":""].join(" ")),this.$overlay.attr("class",r+"-overlay "+this.options.transitionOutOverlay),n.options.navigateArrows===!1||h||this.$navigate.attr("class",r+"-navigate fadeOut"),this.$element.one(d,function(){n.$element.hasClass(o)&&n.$element.removeClass(o+" transitionOut").hide(),n.$overlay.removeClass(n.options.transitionOutOverlay).remove(),n.$navigate.removeClass("fadeOut").remove(),i()}))}},next:function(e){var i=this,n="fadeInRight",o="fadeOutLeft",s=t("."+r+":visible"),a={};a.out=this,void 0!==e&&"object"!=typeof e?(e.preventDefault(),s=t(e.currentTarget),n=s.attr("data-"+r+"-transitionIn"),o=s.attr("data-"+r+"-transitionOut")):void 0!==e&&(void 0!==e.transitionIn&&(n=e.transitionIn),void 0!==e.transitionOut&&(o=e.transitionOut)),this.close({transition:o}),setTimeout(function(){for(var e=t("."+r+"[data-"+r+'-group="'+i.group.name+'"][data-'+r+"-loop]").length,o=i.group.index+1;o<=i.group.ids.length;o++){try{a["in"]=t("#"+i.group.ids[o]).data().iziModal}catch(s){}if("undefined"!=typeof a["in"]){t("#"+i.group.ids[o]).iziModal("open",{transition:n});break}if(o==i.group.ids.length&&e>0||i.options.loop===!0)for(var l=0;l<=i.group.ids.length;l++)if(a["in"]=t("#"+i.group.ids[l]).data().iziModal,"undefined"!=typeof a["in"]){t("#"+i.group.ids[l]).iziModal("open",{transition:n});break}}},200),t(document).trigger(r+"-group-change",a)},prev:function(e){var i=this,n="fadeInLeft",o="fadeOutRight",s=t("."+r+":visible"),a={};a.out=this,void 0!==e&&"object"!=typeof e?(e.preventDefault(),s=t(e.currentTarget),n=s.attr("data-"+r+"-transitionIn"),o=s.attr("data-"+r+"-transitionOut")):void 0!==e&&(void 0!==e.transitionIn&&(n=e.transitionIn),void 0!==e.transitionOut&&(o=e.transitionOut)),this.close({transition:o}),setTimeout(function(){for(var e=t("."+r+"[data-"+r+'-group="'+i.group.name+'"][data-'+r+"-loop]").length,o=i.group.index;o>=0;o--){try{a["in"]=t("#"+i.group.ids[o-1]).data().iziModal}catch(s){}if("undefined"!=typeof a["in"]){t("#"+i.group.ids[o-1]).iziModal("open",{transition:n});break}if(0===o&&e>0||i.options.loop===!0)for(var l=i.group.ids.length-1;l>=0;l--)if(a["in"]=t("#"+i.group.ids[l]).data().iziModal,"undefined"!=typeof a["in"]){t("#"+i.group.ids[l]).iziModal("open",{transition:n});break}}},200),t(document).trigger(r+"-group-change",a)},destroy:function(){var e=t.Event("destroy");this.$element.trigger(e),a.off("keydown."+r),clearTimeout(this.timer),clearTimeout(this.timerTimeout),this.options.iframe===!0&&this.$element.find("."+r+"-iframe").remove(),this.$element.html(this.$element.find("."+r+"-content").html()),this.$element.off("click","[data-"+r+"-close]"),this.$element.off("click","[data-"+r+"-fullscreen]"),this.$element.off("."+r).removeData(r).attr("style",""),this.$overlay.remove(),this.$navigate.remove(),this.$element.trigger(l.DESTROYED),this.$element=null},getState:function(){return this.state},getGroup:function(){return this.group},setWidth:function(t){this.options.width=t,this.recalcWidth();var e=this.$element.outerWidth();this.options.navigateArrows!==!0&&"closeToModal"!=this.options.navigateArrows||(this.$navigate.find("."+r+"-navigate-prev").css("margin-left",-(e/2+84)).show(),this.$navigate.find("."+r+"-navigate-next").css("margin-right",-(e/2+84)).show())},setTop:function(t){this.options.top=t,this.recalcVerticalPos(!1)},setBottom:function(t){this.options.bottom=t,this.recalcVerticalPos(!1)},setHeader:function(t){t?this.$element.find("."+r+"-header").show():(this.headerHeight=0,this.$element.find("."+r+"-header").hide())},setTitle:function(t){this.options.title=t,0===this.headerHeight&&this.createHeader(),0===this.$header.find("."+r+"-header-title").length&&this.$header.append('<h2 class="'+r+'-header-title"></h2>'),this.$header.find("."+r+"-header-title").html(t)},setSubtitle:function(t){""===t?(this.$header.find("."+r+"-header-subtitle").remove(),this.$header.addClass(r+"-noSubtitle")):(0===this.$header.find("."+r+"-header-subtitle").length&&this.$header.append('<p class="'+r+'-header-subtitle"></p>'),this.$header.removeClass(r+"-noSubtitle")),this.$header.find("."+r+"-header-subtitle").html(t),this.options.subtitle=t},setIcon:function(t){0===this.$header.find("."+r+"-header-icon").length&&this.$header.prepend('<i class="'+r+'-header-icon"></i>'),this.$header.find("."+r+"-header-icon").attr("class",r+"-header-icon "+t),this.options.icon=t},setIconText:function(t){this.$header.find("."+r+"-header-icon").html(t),this.options.iconText=t},setHeaderColor:function(t){this.options.borderBottom===!0&&this.$element.css("border-bottom","3px solid "+t),this.$header.css("background",t),this.options.headerColor=t},setBackground:function(t){t===!1?(this.options.background=null,this.$element.css("background","")):(this.$element.css("background",t),this.options.background=t)},setZindex:function(t){isNaN(parseInt(this.options.zindex))||(this.options.zindex=t,this.$element.css("z-index",t),this.$navigate.css("z-index",t-1),this.$overlay.css("z-index",t-2))},setFullscreen:function(t){t?(this.isFullscreen=!0,this.$element.addClass("isFullscreen")):(this.isFullscreen=!1,this.$element.removeClass("isFullscreen"))},setContent:function(t){if("object"==typeof t){var e=t["default"]||!1;e===!0&&(this.content=t.content),t=t.content}this.options.iframe===!1&&this.$element.find("."+r+"-content").html(t)},setTransitionIn:function(t){this.options.transitionIn=t},setTransitionOut:function(t){this.options.transitionOut=t},setTimeout:function(t){this.options.timeout=t},resetContent:function(){this.$element.find("."+r+"-content").html(this.content)},startLoading:function(){this.$element.find("."+r+"-loader").length||this.$element.append('<div class="'+r+'-loader fadeIn"></div>'),this.$element.find("."+r+"-loader").css({top:this.headerHeight,borderRadius:this.options.radius})},stopLoading:function(){var t=this.$element.find("."+r+"-loader");t.length||(this.$element.prepend('<div class="'+r+'-loader fadeIn"></div>'),t=this.$element.find("."+r+"-loader").css("border-radius",this.options.radius)),t.removeClass("fadeIn").addClass("fadeOut"),setTimeout(function(){t.remove()},600)},recalcWidth:function(){var t=this;if(this.$element.css("max-width",this.options.width),i()){var e=t.options.width;e.toString().split("%").length>1&&(e=t.$element.outerWidth()),t.$element.css({left:"50%",marginLeft:-(e/2)})}},recalcVerticalPos:function(t){null!==this.options.top&&this.options.top!==!1?(this.$element.css("margin-top",this.options.top),0===this.options.top&&this.$element.css({borderTopRightRadius:0,borderTopLeftRadius:0})):t===!1&&this.$element.css({marginTop:"",borderRadius:this.options.radius}),null!==this.options.bottom&&this.options.bottom!==!1?(this.$element.css("margin-bottom",this.options.bottom),0===this.options.bottom&&this.$element.css({borderBottomRightRadius:0,borderBottomLeftRadius:0})):t===!1&&this.$element.css({marginBottom:"",borderRadius:this.options.radius})},recalcLayout:function(){var e=this,o=s.height(),a=this.$element.outerHeight(),d=this.$element.outerWidth(),h=this.$element.find("."+r+"-content")[0].scrollHeight,c=h+this.headerHeight,u=this.$element.innerHeight()-this.headerHeight,p=(parseInt(-((this.$element.innerHeight()+1)/2))+"px",this.$wrap.scrollTop()),f=0;i()&&(d>=s.width()||this.isFullscreen===!0?this.$element.css({left:"0",marginLeft:""}):this.$element.css({left:"50%",marginLeft:-(d/2)})),this.options.borderBottom===!0&&""!==this.options.title&&(f=3),this.$element.find("."+r+"-header").length&&this.$element.find("."+r+"-header").is(":visible")?(this.headerHeight=parseInt(this.$element.find("."+r+"-header").innerHeight()),this.$element.css("overflow","hidden")):(this.headerHeight=0,this.$element.css("overflow","")),this.$element.find("."+r+"-loader").length&&this.$element.find("."+r+"-loader").css("top",this.headerHeight),a!==this.modalHeight&&(this.modalHeight=a,this.options.onResize&&"function"==typeof this.options.onResize&&this.options.onResize(this)),this.state!=l.OPENED&&this.state!=l.OPENING||(this.options.iframe===!0&&(o<this.options.iframeHeight+this.headerHeight+f||this.isFullscreen===!0?this.$element.find("."+r+"-iframe").css("height",o-(this.headerHeight+f)):this.$element.find("."+r+"-iframe").css("height",this.options.iframeHeight)),a==o?this.$element.addClass("isAttached"):this.$element.removeClass("isAttached"),this.isFullscreen===!1&&this.$element.width()>=s.width()?this.$element.find("."+r+"-button-fullscreen").hide():this.$element.find("."+r+"-button-fullscreen").show(),this.recalcButtons(),this.isFullscreen===!1&&(o=o-(n(this.options.top)||0)-(n(this.options.bottom)||0)),c>o?(this.options.top>0&&null===this.options.bottom&&h<s.height()&&this.$element.addClass("isAttachedBottom"),this.options.bottom>0&&null===this.options.top&&h<s.height()&&this.$element.addClass("isAttachedTop"),1===t("."+r+":visible").length&&t("html").addClass(r+"-isAttached"),this.$element.css("height",o)):(this.$element.css("height",h+(this.headerHeight+f)),this.$element.removeClass("isAttachedTop isAttachedBottom"),1===t("."+r+":visible").length&&t("html").removeClass(r+"-isAttached")),function(){h>u&&c>o?(e.$element.addClass("hasScroll"),e.$wrap.css("height",a-(e.headerHeight+f))):(e.$element.removeClass("hasScroll"),e.$wrap.css("height","auto"))}(),function(){u+p<h-30?e.$element.addClass("hasShadow"):e.$element.removeClass("hasShadow")}())},recalcButtons:function(){var t=this.$header.find("."+r+"-header-buttons").innerWidth()+10;this.options.rtl===!0?this.$header.css("padding-left",t):this.$header.css("padding-right",t)}},s.off("load."+r).on("load."+r,function(e){var i=document.location.hash;if(0===window.$iziModal.autoOpen&&!t("."+r).is(":visible"))try{var n=t(i).data();"undefined"!=typeof n&&n.iziModal.options.autoOpen!==!1&&t(i).iziModal("open")}catch(o){}}),s.off("hashchange."+r).on("hashchange."+r,function(e){var i=document.location.hash;if(""!==i)try{var n=t(i).data();"undefined"!=typeof n&&"opening"!==t(i).iziModal("getState")&&setTimeout(function(){t(i).iziModal("open",{preventClose:!1})},200)}catch(o){}else window.$iziModal.history&&t.each(t("."+r),function(e,i){if(void 0!==t(i).data().iziModal){var n=t(i).iziModal("getState");"opened"!=n&&"opening"!=n||t(i).iziModal("close")}})}),a.off("click","[data-"+r+"-open]").on("click","[data-"+r+"-open]",function(e){e.preventDefault();var i=t("."+r+":visible"),n=t(e.currentTarget).attr("data-"+r+"-open"),o=t(e.currentTarget).attr("data-"+r+"-preventClose"),s=t(e.currentTarget).attr("data-"+r+"-transitionIn"),a=t(e.currentTarget).attr("data-"+r+"-transitionOut"),l=t(e.currentTarget).attr("data-"+r+"-zindex");void 0!==l&&t(n).iziModal("setZindex",l),void 0===o&&(void 0!==a?i.iziModal("close",{transition:a}):i.iziModal("close")),setTimeout(function(){void 0!==s?t(n).iziModal("open",{transition:s}):t(n).iziModal("open")},200)}),a.off("keyup."+r).on("keyup."+r,function(e){if(t("."+r+":visible").length){var i=t("."+r+":visible")[0].id,n=t("#"+i).data().iziModal.options.arrowKeys,o=t("#"+i).iziModal("getGroup"),s=e||window.event,a=s.target||s.srcElement;void 0===i||!n||void 0===o.name||s.ctrlKey||s.metaKey||s.altKey||"INPUT"===a.tagName.toUpperCase()||"TEXTAREA"==a.tagName.toUpperCase()||(37===s.keyCode?t("#"+i).iziModal("prev",s):39===s.keyCode&&t("#"+i).iziModal("next",s))}}),t.fn[r]=function(e,i){if(!t(this).length&&"object"==typeof e){var n={$el:document.createElement("div"),id:this.selector.split("#"),"class":this.selector.split(".")};if(n.id.length>1){try{n.$el=document.createElement(id[0])}catch(o){}n.$el.id=this.selector.split("#")[1].trim()}else if(n["class"].length>1){try{n.$el=document.createElement(n["class"][0])}catch(o){}for(var s=1;s<n["class"].length;s++)n.$el.classList.add(n["class"][s].trim())}document.body.appendChild(n.$el),this.push(t(this.selector))}for(var a=this,l=0;l<a.length;l++){var d=t(a[l]),h=d.data(r),u=t.extend({},t.fn[r].defaults,d.data(),"object"==typeof e&&e);if(h||e&&"object"!=typeof e){if("string"==typeof e&&"undefined"!=typeof h)return h[e].apply(h,[].concat(i))}else d.data(r,h=new c(d,u));u.autoOpen&&(isNaN(parseInt(u.autoOpen))?u.autoOpen===!0&&h.open():setTimeout(function(){h.open()},u.autoOpen),window.$iziModal.autoOpen++)}return this},t.fn[r].defaults={title:"",subtitle:"",headerColor:"#88A0B9",background:null,theme:"",icon:null,iconText:null,iconColor:"",rtl:!1,width:600,top:null,bottom:null,borderBottom:!0,padding:0,radius:3,zindex:999,iframe:!1,iframeHeight:400,iframeURL:null,focusInput:!0,group:"",loop:!1,arrowKeys:!0,navigateCaption:!0,navigateArrows:!0,history:!1,restoreDefaultContent:!1,autoOpen:0,bodyOverflow:!1,fullscreen:!1,openFullscreen:!1,closeOnEscape:!0,closeButton:!0,appendTo:"body",appendToOverlay:"body",overlay:!0,overlayClose:!0,overlayColor:"rgba(0, 0, 0, 0.4)",timeout:!1,timeoutProgressbar:!1,pauseOnHover:!1,timeoutProgressbarColor:"rgba(255,255,255,0.5)",transitionIn:"comingIn",transitionOut:"comingOut",transitionInOverlay:"fadeIn",transitionOutOverlay:"fadeOut",onFullscreen:function(){},onResize:function(){},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){},afterRender:function(){}},t.fn[r].Constructor=c,t.fn.iziModal});(function(){function n(n,t){if(n!==t){var r=n==n,e=t==t;if(n>t||!r||n===m&&e)return 1;if(n<t||!e||t===m&&r)return-1}return 0}function t(n,t,r){for(var e=n.length,u=r?e:-1;r?u--:++u<e;)if(t(n[u],u,n))return u;return-1}function r(n,t,r){if(t!=t)return p(n,r);r-=1;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function e(n){return"function"==typeof n||!1}function u(n){return"string"==typeof n?n:null==n?"":n+""}function o(n){return n.charCodeAt(0)}function i(n,t){for(var r=-1,e=n.length;++r<e&&-1<t.indexOf(n.charAt(r)););return r}function f(n,t){for(var r=n.length;r--&&-1<t.indexOf(n.charAt(r)););return r}function a(t,r){return n(t.a,r.a)||t.b-r.b}function c(n){return $n[n]}function l(n){return Ln[n]}function s(n){return"\\"+Bn[n]}function p(n,t,r){var e=n.length;for(t+=r?0:-1;r?t--:++t<e;){var u=n[t];if(u!=u)return t}return-1}function h(n){return!!n&&"object"==typeof n}function _(n){return 160>=n&&9<=n&&13>=n||32==n||160==n||5760==n||6158==n||8192<=n&&(8202>=n||8232==n||8233==n||8239==n||8287==n||12288==n||65279==n)}function v(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;)n[r]===t&&(n[r]=L,o[++u]=r);return o}function g(n){for(var t=-1,r=n.length;++t<r&&_(n.charCodeAt(t)););return t}function y(n){for(var t=n.length;t--&&_(n.charCodeAt(t)););return t}function d(n){return Pn[n]}var m,w="3.8.0",b=1,x=2,A=4,j=8,O=16,E=32,k=64,I=128,R=256,S=30,C="...",T=150,U=16,W=0,F=1,N=2,$="Expected a function",L="__lodash_placeholder__",P="[object Arguments]",z="[object Array]",B="[object Boolean]",M="[object Date]",D="[object Error]",q="[object Function]",K="[object Number]",V="[object Object]",Y="[object RegExp]",Z="[object String]",G="[object ArrayBuffer]",J="[object Float32Array]",X="[object Float64Array]",H="[object Int8Array]",Q="[object Int16Array]",nn="[object Int32Array]",tn="[object Uint8Array]",rn="[object Uint8ClampedArray]",en="[object Uint16Array]",un="[object Uint32Array]",on=/\b__p\+='';/g,fn=/\b(__p\+=)''\+/g,an=/(__e\(.*?\)|\b__t\))\+'';/g,cn=/&(?:amp|lt|gt|quot|#39|#96);/g,ln=/[&<>"'`]/g,sn=RegExp(cn.source),pn=RegExp(ln.source),hn=/<%-([\s\S]+?)%>/g,_n=/<%([\s\S]+?)%>/g,vn=/<%=([\s\S]+?)%>/g,gn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,yn=/^\w*$/,dn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,mn=/[.*+?^${}()|[\]\/\\]/g,wn=RegExp(mn.source),bn=/[\u0300-\u036f\ufe20-\ufe23]/g,xn=/\\(\\)?/g,An=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jn=/\w*$/,On=/^0[xX]/,En=/^\[object .+?Constructor\]$/,kn=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,In=/($^)/,Rn=/['\n\r\u2028\u2029\\]/g,Sn=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Cn=" \t\v\f\ufeff\n\r\u2028\u2029",Tn="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Un="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Wn={};Wn[J]=Wn[X]=Wn[H]=Wn[Q]=Wn[nn]=Wn[tn]=Wn[rn]=Wn[en]=Wn[un]=!0,Wn[P]=Wn[z]=Wn[G]=Wn[B]=Wn[M]=Wn[D]=Wn[q]=Wn["[object Map]"]=Wn[K]=Wn[V]=Wn[Y]=Wn["[object Set]"]=Wn[Z]=Wn["[object WeakMap]"]=!1;var Fn={};Fn[P]=Fn[z]=Fn[G]=Fn[B]=Fn[M]=Fn[J]=Fn[X]=Fn[H]=Fn[Q]=Fn[nn]=Fn[K]=Fn[V]=Fn[Y]=Fn[Z]=Fn[tn]=Fn[rn]=Fn[en]=Fn[un]=!0,Fn[D]=Fn[q]=Fn["[object Map]"]=Fn["[object Set]"]=Fn["[object WeakMap]"]=!1;var Nn={leading:!1,maxWait:0,trailing:!1},$n={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},Ln={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Pn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},zn={function:!0,object:!0},Bn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Mn=zn[typeof exports]&&exports&&!exports.nodeType&&exports,Dn=zn[typeof module]&&module&&!module.nodeType&&module,qn=zn[typeof self]&&self&&self.Object&&self,Kn=zn[typeof window]&&window&&window.Object&&window,Vn=Dn&&Dn.exports===Mn&&Mn,Yn=Mn&&Dn&&"object"==typeof global&&global&&global.Object&&global||Kn!==(this&&this.window)&&Kn||qn||this,Zn=function(){try{Object({toString:0}+"")}catch(n){return function(){return!1}}return function(n){return"function"!=typeof n.toString&&"string"==typeof(n+"")}}(),Gn=function _($n){function Ln(n){if(h(n)&&!(Oo(n)||n instanceof Bn)){if(n instanceof zn)return n;if(Pe.call(n,"__chain__")&&Pe.call(n,"__wrapped__"))return kr(n)}return new zn(n)}function Pn(){}function zn(n,t,r){this.__wrapped__=n,this.__actions__=r||[],this.__chain__=!!t}function Bn(n){this.__wrapped__=n,this.__actions__=null,this.__dir__=1,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=du,this.__views__=null}function Mn(){this.__data__={}}function Dn(n){var t=n?n.length:0;for(this.data={hash:au(null),set:new nu};t--;)this.push(n[t])}function qn(n,t){var r=n.data;return("string"==typeof t||ne(t)?r.set.has(t):r.hash[t])?0:-1}function Kn(n,t){var r=-1,e=n.length;for(t||(t=Ae(e));++r<e;)t[r]=n[r];return t}function Vn(n,t){for(var r=-1,e=n.length;++r<e&&!1!==t(n[r],r,n););return n}function Jn(n,t){for(var r=-1,e=n.length;++r<e;)if(!t(n[r],r,n))return!1;return!0}function Xn(n,t){for(var r=-1,e=n.length,u=-1,o=[];++r<e;){var i=n[r];t(i,r,n)&&(o[++u]=i)}return o}function Hn(n,t){for(var r=-1,e=n.length,u=Ae(e);++r<e;)u[r]=t(n[r],r,n);return u}function Qn(n,t,r,e){var u=-1,o=n.length;for(e&&o&&(r=n[++u]);++u<o;)r=t(r,n[u],u,n);return r}function nt(n,t){for(var r=-1,e=n.length;++r<e;)if(t(n[r],r,n))return!0;return!1}function tt(n,t){return n===m?t:n}function rt(n,t,r,e){return n!==m&&Pe.call(e,r)?n:t}function et(n,t,r){var e=$o(t);Xe.apply(e,zu(t));for(var u=-1,o=e.length;++u<o;){var i=e[u],f=n[i],a=r(f,t[i],i,n,t);(a==a?a===f:f!=f)&&(f!==m||i in n)||(n[i]=a)}return n}function ut(n,t){for(var r=-1,e=null==n,u=!e&&hr(n),o=u&&n.length,i=t.length,f=Ae(i);++r<i;){var a=t[r];f[r]=u?_r(a,o)?n[a]:m:e?m:n[a]}return f}function ot(n,t,r){r||(r={});for(var e=-1,u=t.length;++e<u;){var o=t[e];r[o]=n[o]}return r}function it(n,t,r){var e=typeof n;return"function"==e?t===m?n:$t(n,t,r):null==n?de:"object"==e?xt(n):t===m?xe(n):At(n,t)}function ft(n,t,r,e,u,o,i){var f;if(r&&(f=u?r(n,e,u):r(n)),f!==m)return f;if(!ne(n))return n;if(e=Oo(n)){if(f=function(n){var t=n.length,r=new n.constructor(t);return t&&"string"==typeof n[0]&&Pe.call(n,"index")&&(r.index=n.index,r.input=n.input),r}(n),!t)return Kn(n,f)}else{var a=Be.call(n),c=a==q;if(a!=V&&a!=P&&(!c||u))return Fn[a]?function(n,t,r){var e=n.constructor;switch(t){case G:return Lt(n);case B:case M:return new e(+n);case J:case X:case H:case Q:case nn:case tn:case rn:case en:case un:return e instanceof e&&(e=Eu[t]),t=n.buffer,new e(r?Lt(t):t,n.byteOffset,n.length);case K:case Z:return new e(n);case Y:var u=new e(n.source,jn.exec(n));u.lastIndex=n.lastIndex}return u}(n,a,t):u?n:{};if(Zn(n))return u?n:{};if(f=function(n){return"function"==typeof(n=n.constructor)&&n instanceof n||(n=Re),new n}(c?{}:n),!t)return Ru(f,n)}for(o||(o=[]),i||(i=[]),u=o.length;u--;)if(o[u]==n)return i[u];return o.push(n),i.push(f),(e?Vn:vt)(n,function(e,u){f[u]=ft(e,t,r,u,n,o,i)}),f}function at(n,t,r){if("function"!=typeof n)throw new Te($);return tu(function(){n.apply(m,r)},t)}function ct(n,t){var e=n?n.length:0,u=[];if(!e)return u;var o=-1,i=sr(),f=i==r,a=f&&200<=t.length?Nu(t):null,c=t.length;a&&(i=qn,f=!1,t=a);n:for(;++o<e;)if(a=n[o],f&&a==a){for(var l=c;l--;)if(t[l]===a)continue n;u.push(a)}else 0>i(t,a,0)&&u.push(a);return u}function lt(n,t){var r=!0;return Cu(n,function(n,e,u){return r=!!t(n,e,u)}),r}function st(n,t){var r=[];return Cu(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function pt(n,t,r,e){var u;return r(n,function(n,r,o){return t(n,r,o)?(u=e?r:n,!1):void 0}),u}function ht(n,t,r){for(var e=-1,u=n.length,o=-1,i=[];++e<u;){var f=n[e];if(h(f)&&hr(f)&&(r||Oo(f)||Xr(f))){t&&(f=ht(f,t,r));for(var a=-1,c=f.length;++a<c;)i[++o]=f[a]}else r||(i[++o]=f)}return i}function _t(n,t){Uu(n,t,ae)}function vt(n,t){return Uu(n,t,$o)}function gt(n,t){return Wu(n,t,$o)}function yt(n,t){for(var r=-1,e=t.length,u=-1,o=[];++r<e;){var i=t[r];ko(n[i])&&(o[++u]=i)}return o}function dt(n,t,r){if(null!=n){n=Or(n),r!==m&&r in n&&(t=[r]),r=-1;for(var e=t.length;null!=n&&++r<e;)n=Or(n)[t[r]];return r&&r==e?n:m}}function mt(n,t,r,e,u,o){if(n===t)return!0;var i=typeof t;if("function"!=(f=typeof n)&&"object"!=f&&"function"!=i&&"object"!=i||null==n||null==t)n=n!=n&&t!=t;else n:{var f=mt,a=(i=Oo(n),Oo(t)),c=z,l=z;i||((c=Be.call(n))==P?c=V:c!=V&&(i=oe(n))),a||((l=Be.call(t))==P?l=V:l!=V&&oe(t));var s=c==V&&!Zn(n);if(a=l==V&&!Zn(t),!(l=c==l)||i||s){if(!e&&(c=s&&Pe.call(n,"__wrapped__"),a=a&&Pe.call(t,"__wrapped__"),c||a)){n=f(c?n.value():n,a?t.value():t,r,e,u,o);break n}if(l){for(u||(u=[]),o||(o=[]),c=u.length;c--;)if(u[c]==n){n=o[c]==t;break n}u.push(n),o.push(t),n=(i?function(n,t,r,e,u,o,i){var f=-1,a=n.length,c=t.length,l=!0;if(a!=c&&(!u||c<=a))return!1;for(;l&&++f<a;){var s=n[f],p=t[f],l=m;if(e&&(l=u?e(p,s,f):e(s,p,f)),l===m)if(u)for(var h=c;h--&&(p=t[h],!(l=s&&s===p||r(s,p,e,u,o,i))););else l=s&&s===p||r(s,p,e,u,o,i)}return!!l}:function(n,t,r,e,u,o,i){var f=$o(n),a=f.length,c=$o(t).length;if(a!=c&&!u)return!1;for(var c=u,l=-1;++l<a;){var s=f[l],p=u?s in t:Pe.call(t,s);if(p){var h=n[s],_=t[s],p=m;e&&(p=u?e(_,h,s):e(h,_,s)),p===m&&(p=h&&h===_||r(h,_,e,u,o,i))}if(!p)return!1;c||(c="constructor"==s)}return!(!c&&(r=n.constructor,e=t.constructor,r!=e&&"constructor"in n&&"constructor"in t&&!("function"==typeof r&&r instanceof r&&"function"==typeof e&&e instanceof e)))})(n,t,f,r,e,u,o),u.pop(),o.pop()}else n=!1}else n=function(n,t,r){switch(r){case B:case M:return+n==+t;case D:return n.name==t.name&&n.message==t.message;case K:return n!=+n?t!=+t:n==+t;case Y:case Z:return n==t+""}return!1}(n,t,c)}return n}function wt(n,t,r,e,u){for(var o=-1,i=t.length,f=!u;++o<i;)if(f&&e[o]?r[o]!==n[t[o]]:!(t[o]in n))return!1;for(o=-1;++o<i;){var a=t[o],c=n[a],l=r[o];if(f&&e[o]?a=c!==m||a in n:(a=u?u(c,l,a):m)===m&&(a=mt(l,c,u,!0)),!a)return!1}return!0}function bt(n,t){var r=-1,e=hr(n)?Ae(n.length):[];return Cu(n,function(n,u,o){e[++r]=t(n,u,o)}),e}function xt(n){var t=$o(n),r=t.length;if(!r)return ye(!0);if(1==r){var e=t[0],u=n[e];if(mr(u))return function(n){return null!=n&&(n=Or(n))[e]===u&&(u!==m||e in n)}}for(var o=Ae(r),i=Ae(r);r--;)u=n[t[r]],o[r]=u,i[r]=mr(u);return function(n){return null!=n&&wt(Or(n),t,o,i)}}function At(n,t){var r=Oo(n),e=gr(n)&&mr(t),u=n+"";return n=Er(n),function(o){if(null==o)return!1;var i=u;if(o=Or(o),!(!r&&e||i in o)){if(null==(o=1==n.length?o:dt(o,kt(n,0,-1))))return!1;i=Tr(n),o=Or(o)}return o[i]===t?t!==m||i in o:mt(t,o[i],null,!0)}}function jt(n){return function(t){return null==t?m:Or(t)[n]}}function Ot(n,t){for(var r=n?t.length:0;r--;){var e=parseFloat(t[r]);if(e!=u&&_r(e)){var u=e;ru.call(n,e,1)}}}function Et(n,t){return n+Ze(gu()*(t-n+1))}function kt(n,t,r){var e=-1,u=n.length;for(0>(t=null==t?0:+t||0)&&(t=-t>u?0:u+t),0>(r=r===m||r>u?u:+r||0)&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Ae(u);++e<u;)r[e]=n[e+t];return r}function It(n,t){var r;return Cu(n,function(n,e,u){return!(r=t(n,e,u))}),!!r}function Rt(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function St(t,r,e){var u=lr(),o=-1;return r=Hn(r,function(n){return u(n)}),Rt(t=bt(t,function(n){return{a:Hn(r,function(t){return t(n)}),b:++o,c:n}}),function(t,r){var u;n:{u=-1;for(var o=t.a,i=r.a,f=o.length,a=e.length;++u<f;){var c=n(o[u],i[u]);if(c){u=u<a?c*(e[u]?1:-1):c;break n}}u=t.b-r.b}return u})}function Ct(n,t){var e=-1,u=sr(),o=n.length,i=u==r,f=i&&200<=o,a=f?Nu():null,c=[];a?(u=qn,i=!1):(f=!1,a=t?[]:c);n:for(;++e<o;){var l=n[e],s=t?t(l,e,n):l;if(i&&l==l){for(var p=a.length;p--;)if(a[p]===s)continue n;t&&a.push(s),c.push(l)}else 0>u(a,s,0)&&((t||f)&&a.push(s),c.push(l))}return c}function Tt(n,t){for(var r=-1,e=t.length,u=Ae(e);++r<e;)u[r]=n[t[r]];return u}function Ut(n,t,r,e){for(var u=n.length,o=e?u:-1;(e?o--:++o<u)&&t(n[o],o,n););return r?kt(n,e?0:o,e?o+1:u):kt(n,e?o+1:0,e?u:o)}function Wt(n,t){(u=n)instanceof Bn&&(u=u.value());for(var r=-1,e=t.length;++r<e;){var u=[u],o=t[r];Xe.apply(u,o.args),u=o.func.apply(o.thisArg,u)}return u}function Ft(n,t,r){var e=0,u=n?n.length:e;if("number"==typeof t&&t==t&&u<=bu){for(;e<u;){var o=e+u>>>1,i=n[o];(r?i<=t:i<t)?e=o+1:u=o}return u}return Nt(n,t,de,r)}function Nt(n,t,r,e){t=r(t);for(var u=0,o=n?n.length:0,i=t!=t,f=t===m;u<o;){var a=Ze((u+o)/2),c=r(n[a]),l=c==c;(i?l||e:f?l&&(e||c!==m):e?c<=t:c<t)?u=a+1:o=a}return pu(o,wu)}function $t(n,t,r){if("function"!=typeof n)return de;if(t===m)return n;switch(r){case 1:return function(r){return n.call(t,r)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,o){return n.call(t,r,e,u,o)};case 5:return function(r,e,u,o,i){return n.call(t,r,e,u,o,i)}}return function(){return n.apply(t,arguments)}}function Lt(n){return Ke.call(n,0)}function Pt(n,t,r){for(var e=r.length,u=-1,o=su(n.length-e,0),i=-1,f=t.length,a=Ae(o+f);++i<f;)a[i]=t[i];for(;++u<e;)a[r[u]]=n[u];for(;o--;)a[i++]=n[u++];return a}function zt(n,t,r){for(var e=-1,u=r.length,o=-1,i=su(n.length-u,0),f=-1,a=t.length,c=Ae(i+a);++o<i;)c[o]=n[o];for(i=o;++f<a;)c[i+f]=t[f];for(;++e<u;)c[i+r[e]]=n[o++];return c}function Bt(n,t){return function(r,e,u){var o=t?t():{};if(e=lr(e,u,3),Oo(r)){u=-1;for(var i=r.length;++u<i;){var f=r[u];n(o,f,e(f,u,r),r)}}else Cu(r,function(t,r,u){n(o,t,e(t,r,u),u)});return o}}function Mt(n){return Jr(function(t,r){var e=-1,u=null==t?0:r.length,o=2<u&&r[u-2],i=2<u&&r[2],f=1<u&&r[u-1];for("function"==typeof o?(o=$t(o,f,5),u-=2):u-=(o="function"==typeof f?f:null)?1:0,i&&vr(r[0],r[1],i)&&(o=3>u?null:o,u=1);++e<u;)(i=r[e])&&n(t,i,o);return t})}function Dt(n,t){return function(r,e){var u=r?Pu(r):0;if(!dr(u))return n(r,e);for(var o=t?u:-1,i=Or(r);(t?o--:++o<u)&&!1!==e(i[o],o,i););return r}}function qt(n){return function(t,r,e){for(var u=Or(t),o=(e=e(t)).length,i=n?o:-1;n?i--:++i<o;){var f=e[i];if(!1===r(u[f],f,u))break}return t}}function Kt(n){return function(t){for(var r=-1,e=(t=ve(le(t))).length,u="";++r<e;)u=n(u,t[r],r);return u}}function Vt(n){return function(){var t=Su(n.prototype),r=n.apply(t,arguments);return ne(r)?r:t}}function Yt(n){return function t(r,e,u){return u&&vr(r,e,u)&&(e=null),(r=cr(r,n,null,null,null,null,null,e)).placeholder=t.placeholder,r}}function Zt(n,t){return function(r,e,u){u&&vr(r,e,u)&&(e=null);var i=lr(),f=null==e;if(i===it&&f||(f=!1,e=i(e,u,3)),f){if((e=Oo(r))||!ue(r))return n(e?r:jr(r));e=o}return function(n,t,r){var e=r?du:yu,u=e,o=u;return Cu(n,function(n,i,f){i=t(n,i,f),((r?i<u:i>u)||i===e&&i===o)&&(u=i,o=n)}),o}(r,e,t)}}function Gt(n,r){return function(e,u,o){return u=lr(u,o,3),Oo(e)?-1<(u=t(e,u,r))?e[u]:m:pt(e,u,n)}}function Jt(n){return function(r,e,u){return r&&r.length?t(r,e=lr(e,u,3),n):-1}}function Xt(n){return function(t,r,e){return pt(t,r=lr(r,e,3),n,!0)}}function Ht(n){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var r,e=n?t:-1,u=0,o=Ae(t);n?e--:++e<t;){var i=o[u++]=arguments[e];if("function"!=typeof i)throw new Te($);var f=r?"":Lu(i);r="wrapper"==f?new zn([]):r}for(e=r?-1:t;++e<t;)i=o[e],f=Lu(i),r=(u="wrapper"==f?$u(i):null)&&yr(u[0])&&u[1]==(I|j|E|R)&&!u[4].length&&1==u[9]?r[Lu(u[0])].apply(r,u[3]):1==i.length&&yr(i)?r[f]():r.thru(i);return function(){var n=arguments;if(r&&1==n.length&&Oo(n[0]))return r.plant(n[0]).value();var e=0;for(n=o[e].apply(this,n);++e<t;)n=o[e].call(this,n);return n}}}function Qt(n,t){return function(r,e,u){return"function"==typeof e&&u===m&&Oo(r)?n(r,e):t(r,$t(e,u,3))}}function nr(n){return function(t,r,e){return("function"!=typeof r||e!==m)&&(r=$t(r,e,3)),n(t,r,ae)}}function tr(n){return function(t,r,e){return("function"!=typeof r||e!==m)&&(r=$t(r,e,3)),n(t,r)}}function rr(n){return function(t,r,e){var u={};return r=lr(r,e,3),vt(t,function(t,e,o){o=r(t,e,o),t=n?t:o,u[e=n?o:e]=t}),u}}function er(n){return function(t,r,e){return t=u(t),(n?t:"")+fr(t,r,e)+(n?"":t)}}function ur(n){var t=Jr(function(r,e){var u=v(e,t.placeholder);return cr(r,n,null,e,u)});return t}function or(n,t){return function(r,e,u,o){var i=3>arguments.length;return"function"==typeof e&&o===m&&Oo(r)?n(r,e,u,i):function(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=!1,n):t(r,n,u,o)}),r}(r,lr(e,o,4),u,i,t)}}function ir(n,t,r,e,u,o,i,f,a,c){var l=t&I,s=t&b,p=t&x,h=t&j,_=t&A,g=t&O,y=!p&&Vt(n),d=n;return function w(){for(var A=R=arguments.length,j=Ae(R);A--;)j[A]=arguments[A];if(e&&(j=Pt(j,e,u)),o&&(j=zt(j,o,i)),(h||g)&&(R-=(O=v(j,A=w.placeholder)).length)<c){var O,I=f?Kn(f):null,R=su(c-R,0),S=h?O:null;return t|=h?E:k,t&=~(h?k:E),_||(t&=~(b|x)),j=[n,t,r,h?j:null,S,j=h?null:j,O=h?null:O,I,a,R],I=ir.apply(m,j),yr(n)&&Bu(I,j),I.placeholder=A,I}if(A=s?r:this,p&&(n=A[d]),f)for(I=j.length,R=pu(f.length,I),S=Kn(j);R--;)O=f[R],j[R]=_r(O,I)?S[O]:m;return l&&a<j.length&&(j.length=a),(this&&this!==Yn&&this instanceof w?y||Vt(n):n).apply(A,j)}}function fr(n,t,r){return(n=n.length)<(t=+t)&&cu(t)?he(r=null==r?" ":r+"",Ve((t-=n)/r.length)).slice(0,t):""}function ar(n){return function(t,r,e,u){var o=lr(e);return o===it&&null==e?Ft(t,r,n):Nt(t,r,o(e,u,1),n)}}function cr(n,t,r,e,u,o,i,f){var a=t&x;if(!a&&"function"!=typeof n)throw new Te($);var c=e?e.length:0;if(c||(t&=~(E|k),e=u=null),c-=u?u.length:0,t&k){var l=e,s=u;e=u=null}var p=a?null:$u(n);return r=[n,t,r,e,u,l,s,o,i,f],p&&(f=(e=r[1])|(t=p[1]),u=t==I&&e==j||t==I&&e==R&&r[7].length<=p[8]||t==(I|R)&&e==j,(f<I||u)&&(t&b&&(r[2]=p[2],f|=e&b?0:A),(e=p[3])&&(u=r[3],r[3]=u?Pt(u,e,p[4]):Kn(e),r[4]=u?v(r[3],L):Kn(p[4])),(e=p[5])&&(u=r[5],r[5]=u?zt(u,e,p[6]):Kn(e),r[6]=u?v(r[5],L):Kn(p[6])),(e=p[7])&&(r[7]=Kn(e)),t&I&&(r[8]=null==r[8]?p[8]:pu(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=f),t=r[1],f=r[9]),r[9]=null==f?a?0:n.length:su(f-c,0)||0,(p?Fu:Bu)(t==b?function(n,t){var r=Vt(n);return function e(){return(this&&this!==Yn&&this instanceof e?r:n).apply(t,arguments)}}(r[0],r[2]):t!=E&&t!=(b|E)||r[4].length?ir.apply(m,r):function(n,t,r,e){var u=t&b,o=Vt(n);return function t(){for(var i=-1,f=arguments.length,a=-1,c=e.length,l=Ae(f+c);++a<c;)l[a]=e[a];for(;f--;)l[a++]=arguments[++i];return(this&&this!==Yn&&this instanceof t?o:n).apply(u?r:this,l)}}.apply(m,r),r)}function lr(n,t,r){var e=(e=Ln.callback||ge)===ge?it:e;return r?e(n,t,r):e}function sr(n,t,e){var u=(u=Ln.indexOf||Cr)===Cr?r:u;return n?u(n,t,e):u}function pr(n,t,r){return null==n||gr(t,n)||(n=1==(t=Er(t)).length?n:dt(n,kt(t,0,-1)),t=Tr(t)),null==(t=null==n?n:n[t])?m:t.apply(n,r)}function hr(n){return null!=n&&dr(Pu(n))}function _r(n,t){return t=null==t?Au:t,-1<(n=+n)&&0==n%1&&n<t}function vr(n,t,r){if(!ne(r))return!1;var e=typeof t;return!!("number"==e?hr(r)&&_r(t,r.length):"string"==e&&t in r)&&(t=r[t],n==n?n===t:t!=t)}function gr(n,t){var r=typeof n;return!!("string"==r&&yn.test(n)||"number"==r)||!Oo(n)&&(!gn.test(n)||null!=t&&n in Or(t))}function yr(n){var t=Lu(n);return!!t&&n===Ln[t]&&t in Bn.prototype}function dr(n){return"number"==typeof n&&-1<n&&0==n%1&&n<=Au}function mr(n){return n==n&&!ne(n)}function wr(n,t){n=Or(n);for(var r=-1,e=t.length,u={};++r<e;){var o=t[r];o in n&&(u[o]=n[o])}return u}function br(n,t){var r={};return _t(n,function(n,e,u){t(n,e,u)&&(r[e]=n)}),r}function xr(n){var t,r,e=Ln.support;return!(!h(n)||Be.call(n)!=V||Zn(n)||!(Pe.call(n,"constructor")||(t=n.constructor,"function"!=typeof t||t instanceof t))||!e.argsTag&&Xr(n))&&(e.ownLast?(_t(n,function(n,t,e){return r=Pe.call(e,t),!1}),!1!==r):(_t(n,function(n,t){r=t}),r===m||Pe.call(n,r)))}function Ar(n){for(var t=ae(n),r=t.length,e=r&&n.length,u=Ln.support,o=(u=e&&dr(e)&&(Oo(n)||u.nonEnumStrings&&ue(n)||u.nonEnumArgs&&Xr(n)),-1),i=[];++o<r;){var f=t[o];(u&&_r(f,e)||Pe.call(n,f))&&i.push(f)}return i}function jr(n){return null==n?[]:hr(n)?Ln.support.unindexedChars&&ue(n)?n.split(""):ne(n)?n:Re(n):ce(n)}function Or(n){if(Ln.support.unindexedChars&&ue(n)){for(var t=-1,r=n.length,e=Re(n);++t<r;)e[t]=n.charAt(t);return e}return ne(n)?n:Re(n)}function Er(n){if(Oo(n))return n;var t=[];return u(n).replace(dn,function(n,r,e,u){t.push(e?u.replace(xn,"$1"):r||n)}),t}function kr(n){return n instanceof Bn?n.clone():new zn(n.__wrapped__,n.__chain__,Kn(n.__actions__))}function Ir(n,t,r){return n&&n.length?((r?vr(n,t,r):null==t)&&(t=1),kt(n,0>t?0:t)):[]}function Rr(n,t,r){var e=n?n.length:0;return e?((r?vr(n,t,r):null==t)&&(t=1),kt(n,0,0>(t=e-(+t||0))?0:t)):[]}function Sr(n){return n?n[0]:m}function Cr(n,t,e){var u=n?n.length:0;if(!u)return-1;if("number"==typeof e)e=0>e?su(u+e,0):e;else if(e)return n=n[e=Ft(n,t)],(t==t?t===n:n!=n)?e:-1;return r(n,t,e||0)}function Tr(n){var t=n?n.length:0;return t?n[t-1]:m}function Ur(n){return Ir(n,1)}function Wr(n,t,e,u){if(!n||!n.length)return[];if(null!=t&&"boolean"!=typeof t&&(e=vr(n,t,u=e)?null:t,t=!1),((i=lr())!==it||null!=e)&&(e=i(e,u,3)),t&&sr()==r){var o;t=e,e=-1,u=n.length;for(var i=-1,f=[];++e<u;){var a=n[e],c=t?t(a,e,n):a;e&&o===c||(o=c,f[++i]=a)}n=f}else n=Ct(n,e);return n}function Fr(n){if(!n||!n.length)return[];var t=-1,r=0;n=Xn(n,function(n){return hr(n)?(r=su(n.length,r),!0):void 0});for(var e=Ae(r);++t<r;)e[t]=Hn(n,jt(t));return e}function Nr(n,t,r){return n&&n.length?(n=Fr(n),null==t?n:(t=$t(t,r,4),Hn(n,function(n){return Qn(n,t,m,!0)}))):[]}function $r(n,t){var r=-1,e=n?n.length:0,u={};for(!e||t||Oo(n[0])||(t=[]);++r<e;){var o=n[r];t?u[o]=t[r]:o&&(u[o[0]]=o[1])}return u}function Lr(n){return(n=Ln(n)).__chain__=!0,n}function Pr(n,t,r){return t.call(r,n)}function zr(n,t,r){var e=Oo(n)?Jn:lt;return r&&vr(n,t,r)&&(t=null),("function"!=typeof t||r!==m)&&(t=lr(t,r,3)),e(n,t)}function Br(n,t,r){return(Oo(n)?Xn:st)(n,t=lr(t,r,3))}function Mr(n,t,r,e){var u=n?Pu(n):0;return dr(u)||(u=(n=ce(n)).length),!!u&&(r="number"!=typeof r||e&&vr(t,r,e)?0:0>r?su(u+r,0):r||0,"string"==typeof n||!Oo(n)&&ue(n)?r<u&&-1<n.indexOf(t,r):-1<sr(n,t,r))}function Dr(n,t,r){return(Oo(n)?Hn:bt)(n,t=lr(t,r,3))}function qr(n,t,r){return(r?vr(n,t,r):null==t)?0<(t=(n=jr(n)).length)?n[Et(0,t-1)]:m:((n=Kr(n)).length=pu(0>t?0:+t||0,n.length),n)}function Kr(n){for(var t=-1,r=(n=jr(n)).length,e=Ae(r);++t<r;){var u=Et(0,t);t!=u&&(e[t]=e[u]),e[u]=n[t]}return e}function Vr(n,t,r){var e=Oo(n)?nt:It;return r&&vr(n,t,r)&&(t=null),("function"!=typeof t||r!==m)&&(t=lr(t,r,3)),e(n,t)}function Yr(n,t){var r;if("function"!=typeof t){if("function"!=typeof n)throw new Te($);var e=n;n=t,t=e}return function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}}function Zr(n,t,r){function e(){var r=t-(so()-c);0>=r||r>t?(f&&Ye(f),r=p,f=s=p=m,r&&(h=so(),a=n.apply(l,i),s||f||(i=l=null))):s=tu(e,r)}function u(){s&&Ye(s),f=s=p=m,(v||_!==t)&&(h=so(),a=n.apply(l,i),s||f||(i=l=null))}function o(){if(i=arguments,c=so(),l=this,p=v&&(s||!g),!1===_)var r=g&&!s;else{f||g||(h=c);var o=_-(c-h),y=0>=o||o>_;y?(f&&(f=Ye(f)),h=c,a=n.apply(l,i)):f||(f=tu(u,o))}return y&&s?s=Ye(s):s||t===_||(s=tu(e,t)),r&&(y=!0,a=n.apply(l,i)),!y||s||f||(i=l=null),a}var i,f,a,c,l,s,p,h=0,_=!1,v=!0;if("function"!=typeof n)throw new Te($);if(t=0>t?0:+t||0,!0===r){var g=!0;v=!1}else ne(r)&&(g=r.leading,_="maxWait"in r&&su(+r.maxWait||0,t),v="trailing"in r?r.trailing:v);return o.cancel=function(){s&&Ye(s),f&&Ye(f),f=s=p=m},o}function Gr(n,t){function r(){var e=arguments,u=r.cache,o=t?t.apply(this,e):e[0];return u.has(o)?u.get(o):(e=n.apply(this,e),u.set(o,e),e)}if("function"!=typeof n||t&&"function"!=typeof t)throw new Te($);return r.cache=new Gr.Cache,r}function Jr(n,t){if("function"!=typeof n)throw new Te($);return t=su(t===m?n.length-1:+t||0,0),function(){for(var r=arguments,e=-1,u=su(r.length-t,0),o=Ae(u);++e<u;)o[e]=r[t+e];switch(t){case 0:return n.call(this,o);case 1:return n.call(this,r[0],o);case 2:return n.call(this,r[0],r[1],o)}for(u=Ae(t+1),e=-1;++e<t;)u[e]=r[e];return u[t]=o,n.apply(this,u)}}function Xr(n){return h(n)&&hr(n)&&Be.call(n)==P}function Hr(n){return!!n&&1===n.nodeType&&h(n)&&(Ln.support.nodeTag?-1<Be.call(n).indexOf("Element"):Zn(n))}function Qr(n){return h(n)&&"string"==typeof n.message&&Be.call(n)==D}function ne(n){var t=typeof n;return"function"==t||!!n&&"object"==t}function te(n){return null!=n&&(Be.call(n)==q?De.test(Le.call(n)):h(n)&&(Zn(n)?De:En).test(n))}function re(n){return"number"==typeof n||h(n)&&Be.call(n)==K}function ee(n){return ne(n)&&Be.call(n)==Y}function ue(n){return"string"==typeof n||h(n)&&Be.call(n)==Z}function oe(n){return h(n)&&dr(n.length)&&!!Wn[Be.call(n)]}function ie(n){return ot(n,ae(n))}function fe(n){return yt(n,ae(n))}function ae(n){if(null==n)return[];ne(n)||(n=Re(n));for(var t=n.length,r=Ln.support,e=(t=t&&dr(t)&&(Oo(n)||r.nonEnumStrings&&ue(n)||r.nonEnumArgs&&Xr(n))&&t||0,n.constructor),u=-1,o=(e=ko(e)&&e.prototype||Fe)===n,i=Ae(t),f=0<t,a=r.enumErrorProps&&(n===We||n instanceof Oe),c=r.enumPrototypes&&ko(n);++u<t;)i[u]=u+"";for(var l in n)c&&"prototype"==l||a&&("message"==l||"name"==l)||f&&_r(l,t)||"constructor"==l&&(o||!Pe.call(n,l))||i.push(l);if(r.nonEnumShadows&&n!==Fe)for(t=n===Ne?Z:n===We?D:Be.call(n),r=ku[t]||ku[V],t==V&&(e=Fe),t=Un.length;t--;)u=r[l=Un[t]],o&&u||(u?!Pe.call(n,l):n[l]===e[l])||i.push(l);return i}function ce(n){return Tt(n,$o(n))}function le(n){return(n=u(n))&&n.replace(kn,c).replace(bn,"")}function se(n){return(n=u(n))&&wn.test(n)?n.replace(mn,"\\$&"):n}function pe(n,t,r){return r&&vr(n,t,r)&&(t=0),vu(n,t)}function he(n,t){var r="";if(n=u(n),1>(t=+t)||!n||!cu(t))return r;do{t%2&&(r+=n),t=Ze(t/2),n+=n}while(t);return r}function _e(n,t,r){var e=n;return(n=u(n))?(r?vr(e,t,r):null==t)?n.slice(g(n),y(n)+1):(t+="",n.slice(i(n,t),f(n,t)+1)):n}function ve(n,t,r){return r&&vr(n,t,r)&&(t=null),(n=u(n)).match(t||Sn)||[]}function ge(n,t,r){return r&&vr(n,t,r)&&(t=null),h(n)?me(n):it(n,t)}function ye(n){return function(){return n}}function de(n){return n}function me(n){return xt(ft(n,!0))}function we(n,t,r){if(null==r){var e=(o=ne(t))&&$o(t);((e=e&&e.length&&yt(t,e))?e.length:o)||(e=!1,r=t,t=n,n=this)}e||(e=yt(t,$o(t)));var u=!0,o=-1,i=ko(n),f=e.length;!1===r?u=!1:ne(r)&&"chain"in r&&(u=r.chain);for(;++o<f;){var a=t[r=e[o]];n[r]=a,i&&(n.prototype[r]=function(t){return function(){var r=this.__chain__;if(u||r){var e=n(this.__wrapped__);return(e.__actions__=Kn(this.__actions__)).push({func:t,args:arguments,thisArg:n}),e.__chain__=r,e}return r=[this.value()],Xe.apply(r,arguments),t.apply(n,r)}}(a))}return n}function be(){}function xe(n){return gr(n)?jt(n):function(n){var t=n+"";return n=Er(n),function(r){return dt(r,n,t)}}(n)}var Ae=($n=$n?Gn.defaults(Yn.Object(),$n,Gn.pick(Yn,Tn)):Yn).Array,je=$n.Date,Oe=$n.Error,Ee=$n.Function,ke=$n.Math,Ie=$n.Number,Re=$n.Object,Se=$n.RegExp,Ce=$n.String,Te=$n.TypeError,Ue=Ae.prototype,We=Oe.prototype,Fe=Re.prototype,Ne=Ce.prototype,$e=($e=$n.window)&&$e.document,Le=Ee.prototype.toString,Pe=Fe.hasOwnProperty,ze=0,Be=Fe.toString,Me=$n._,De=Se("^"+se(Be).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qe=te(qe=$n.ArrayBuffer)&&qe,Ke=te(Ke=qe&&new qe(0).slice)&&Ke,Ve=ke.ceil,Ye=$n.clearTimeout,Ze=ke.floor,Ge=te(Ge=Re.getOwnPropertySymbols)&&Ge,Je=te(Je=Re.getPrototypeOf)&&Je,Xe=Ue.push,He=te(He=Re.preventExtensions)&&He,Qe=Fe.propertyIsEnumerable,nu=te(nu=$n.Set)&&nu,tu=$n.setTimeout,ru=Ue.splice,eu=te(eu=$n.Uint8Array)&&eu,uu=te(uu=$n.WeakMap)&&uu,ou=function(){try{var n=te(n=$n.Float64Array)&&n,t=new n(new qe(10),0,1)&&n}catch(n){}return t}(),iu=function(){var n=He&&te(n=Re.assign)&&n;try{if(n){var t=He({1:0});t[0]=1}}catch(r){try{n(t,"xo")}catch(n){}return!t[1]&&n}return!1}(),fu=te(fu=Ae.isArray)&&fu,au=te(au=Re.create)&&au,cu=$n.isFinite,lu=te(lu=Re.keys)&&lu,su=ke.max,pu=ke.min,hu=te(hu=je.now)&&hu,_u=te(_u=Ie.isFinite)&&_u,vu=$n.parseInt,gu=ke.random,yu=Ie.NEGATIVE_INFINITY,du=Ie.POSITIVE_INFINITY,mu=ke.pow(2,32)-1,wu=mu-1,bu=mu>>>1,xu=ou?ou.BYTES_PER_ELEMENT:0,Au=ke.pow(2,53)-1,ju=uu&&new uu,Ou={},Eu={};Eu[J]=$n.Float32Array,Eu[X]=$n.Float64Array,Eu[H]=$n.Int8Array,Eu[Q]=$n.Int16Array,Eu[nn]=$n.Int32Array,Eu[tn]=$n.Uint8Array,Eu[rn]=$n.Uint8ClampedArray,Eu[en]=$n.Uint16Array,Eu[un]=$n.Uint32Array;var ku={};ku[z]=ku[M]=ku[K]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ku[B]=ku[Z]={constructor:!0,toString:!0,valueOf:!0},ku[D]=ku[q]=ku[Y]={constructor:!0,toString:!0},ku[V]={constructor:!0},Vn(Un,function(n){for(var t in ku)if(Pe.call(ku,t)){var r=ku[t];r[n]=Pe.call(r,n)}});var Iu=Ln.support={};!function(n){function t(){this.x=n}var r=arguments,e={0:n,length:n},u=[];for(var o in t.prototype={valueOf:n,y:n},new t)u.push(o);Iu.argsTag=Be.call(r)==P,Iu.enumErrorProps=Qe.call(We,"message")||Qe.call(We,"name"),Iu.enumPrototypes=Qe.call(t,"prototype"),Iu.funcDecomp=/\bthis\b/.test(function(){return this}),Iu.funcNames="string"==typeof Ee.name,Iu.nodeTag=Be.call($e)!=V,Iu.nonEnumStrings=!Qe.call("x",0),Iu.nonEnumShadows=!/valueOf/.test(u),Iu.ownLast="x"!=u[0],Iu.spliceObjects=(ru.call(e,0,1),!e[0]),Iu.unindexedChars="xx"!="x"[0]+Re("x")[0];try{Iu.dom=11===$e.createDocumentFragment().nodeType}catch(n){Iu.dom=!1}try{Iu.nonEnumArgs=!Qe.call(r,1)}catch(n){Iu.nonEnumArgs=!0}}(1,0),Ln.templateSettings={escape:hn,evaluate:_n,interpolate:vn,variable:"",imports:{_:Ln}};var Ru=iu||function(n,t){return null==t?n:ot(t,zu(t),ot(t,$o(t),n))},Su=function(){function n(){}return function(t){if(ne(t)){n.prototype=t;var r=new n;n.prototype=null}return r||$n.Object()}}(),Cu=Dt(vt),Tu=Dt(gt,!0),Uu=qt(),Wu=qt(!0),Fu=ju?function(n,t){return ju.set(n,t),n}:de;Ke||(Lt=qe&&eu?function(n){var t=n.byteLength,r=ou?Ze(t/xu):0,e=r*xu,u=new qe(t);if(r){var o=new ou(u,0,r);o.set(new ou(n,0,r))}return t!=e&&(o=new eu(u,e)).set(new eu(n,e)),u}:ye(null));var Nu=au&&nu?function(n){return new Dn(n)}:ye(null),$u=ju?function(n){return ju.get(n)}:be,Lu=Iu.funcNames?"constant"==ye.name?jt("name"):function(n){for(var t=n.name,r=Ou[t],e=r?r.length:0;e--;){var u=r[e],o=u.func;if(null==o||o==n)return u.name}return t}:ye(""),Pu=jt("length"),zu=Ge?function(n){return Ge(Or(n))}:ye([]),Bu=function(){var n=0,t=0;return function(r,e){var u=so(),o=U-(u-t);if(t=u,0<o){if(++n>=T)return r}else n=0;return Fu(r,e)}}(),Mu=Jr(function(n,t){return hr(n)?ct(n,ht(t,!1,!0)):[]}),Du=Jt(),qu=Jt(!0),Ku=Jr(function(t,r){var e=ut(t,r=ht(r));return Ot(t,r.sort(n)),e}),Vu=ar(),Yu=ar(!0),Zu=Jr(function(n){return Ct(ht(n,!1,!0))}),Gu=Jr(function(n,t){return hr(n)?ct(n,t):[]}),Ju=Jr(Fr),Xu=Jr(function(n){var t=n.length,r=n[t-2],e=n[t-1];return 2<t&&"function"==typeof r?t-=2:(r=1<t&&"function"==typeof e?(--t,e):m,e=m),n.length=t,Nr(n,r,e)}),Hu=Jr(function(n,t){return hr(n)&&(n=jr(n)),ut(n,ht(t))}),Qu=Bt(function(n,t,r){Pe.call(n,r)?++n[r]:n[r]=1}),no=Gt(Cu),to=Gt(Tu,!0),ro=Qt(Vn,Cu),eo=Qt(function(n,t){for(var r=n.length;r--&&!1!==t(n[r],r,n););return n},Tu),uo=Bt(function(n,t,r){Pe.call(n,r)?n[r].push(t):n[r]=[t]}),oo=Bt(function(n,t,r){n[r]=t}),io=Jr(function(n,t,r){var e=-1,u="function"==typeof t,o=gr(t),i=hr(n)?Ae(n.length):[];return Cu(n,function(n){var f=u?t:o&&null!=n&&n[t];i[++e]=f?f.apply(n,r):pr(n,t,r)}),i}),fo=Bt(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),ao=or(Qn,Cu),co=or(function(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r},Tu),lo=Jr(function(n,t){if(null==n)return[];var r=t[2];return r&&vr(t[0],t[1],r)&&(t.length=1),St(n,ht(t),[])}),so=hu||function(){return(new je).getTime()},po=Jr(function(n,t,r){var e=b;if(r.length){var u=v(r,po.placeholder);e|=E}return cr(n,e,t,r,u)}),ho=Jr(function(n,t){for(var r=-1,e=(t=t.length?ht(t):fe(n)).length;++r<e;){var u=t[r];n[u]=cr(n[u],b,n)}return n}),_o=Jr(function(n,t,r){var e=b|x;if(r.length){var u=v(r,_o.placeholder);e|=E}return cr(t,e,n,r,u)}),vo=Yt(j),go=Yt(O),yo=Jr(function(n,t){return at(n,1,t)}),mo=Jr(function(n,t,r){return at(n,t,r)}),wo=Ht(),bo=Ht(!0),xo=ur(E),Ao=ur(k),jo=Jr(function(n,t){return cr(n,R,null,null,null,ht(t))});Iu.argsTag||(Xr=function(n){return h(n)&&hr(n)&&Pe.call(n,"callee")&&!Qe.call(n,"callee")});var Oo=fu||function(n){return h(n)&&dr(n.length)&&Be.call(n)==z};Iu.dom||(Hr=function(n){return!!n&&1===n.nodeType&&h(n)&&!Io(n)});var Eo=_u||function(n){return"number"==typeof n&&cu(n)},ko=e(/x/)||eu&&!e(eu)?function(n){return Be.call(n)==q}:e,Io=Je?function(n){if(!n||Be.call(n)!=V||!Ln.support.argsTag&&Xr(n))return!1;var t=n.valueOf,r=te(t)&&(r=Je(t))&&Je(r);return r?n==r||Je(n)==r:xr(n)}:xr,Ro=Mt(function(n,t,r){return r?et(n,t,r):Ru(n,t)}),So=Jr(function(n){var t=n[0];return null==t?t:(n.push(tt),Ro.apply(m,n))}),Co=Xt(vt),To=Xt(gt),Uo=nr(Uu),Wo=nr(Wu),Fo=tr(vt),No=tr(gt),$o=lu?function(n){var t=null!=n&&n.constructor;return"function"==typeof t&&t.prototype===n||("function"==typeof n?Ln.support.enumPrototypes:hr(n))?Ar(n):ne(n)?lu(n):[]}:Ar,Lo=rr(!0),Po=rr(),zo=Mt(function n(t,r,e,u,o){if(!ne(t))return t;var i=hr(r)&&(Oo(r)||oe(r));if(!i){var f=$o(r);Xe.apply(f,zu(r))}return Vn(f||r,function(a,c){if(f&&(a=r[c=a]),h(a)){u||(u=[]),o||(o=[]);n:{for(var l=c,s=u,p=o,_=s.length,v=r[l];_--;)if(s[_]==v){t[l]=p[_];break n}_=t[l];var g=e?e(_,v,l,t,r):m,y=g===m;y&&(g=v,hr(v)&&(Oo(v)||oe(v))?g=Oo(_)?_:hr(_)?Kn(_):[]:Io(v)||Xr(v)?g=Xr(_)?ie(_):Io(_)?_:{}:y=!1),s.push(v),p.push(g),y?t[l]=n(g,v,e,s,p):(g==g?g!==_:_==_)&&(t[l]=g)}}else l=t[c],(p=(s=e?e(l,a,c,t,r):m)===m)&&(s=a),!i&&s===m||!p&&(s==s?s===l:l!=l)||(t[c]=s)}),t}),Bo=Jr(function(n,t){if(null==n)return{};if("function"!=typeof t[0])return t=Hn(ht(t),Ce),wr(n,ct(ae(n),t));var r=$t(t[0],t[1],3);return br(n,function(n,t,e){return!r(n,t,e)})}),Mo=Jr(function(n,t){return null==n?{}:"function"==typeof t[0]?br(n,$t(t[0],t[1],3)):wr(n,ht(t))}),Do=Kt(function(n,t,r){return t=t.toLowerCase(),n+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),qo=Kt(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),Ko=er(),Vo=er(!0);8!=vu(Cn+"08")&&(pe=function(n,t,r){return(r?vr(n,t,r):null==t)?t=0:t&&(t=+t),n=_e(n),vu(n,t||(On.test(n)?16:10))});var Yo=Kt(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),Zo=Kt(function(n,t,r){return n+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Go=Jr(function(n,t){try{return n.apply(m,t)}catch(n){return Qr(n)?n:new Oe(n)}}),Jo=Jr(function(n,t){return function(r){return pr(r,n,t)}}),Xo=Jr(function(n,t){return function(r){return pr(n,r,t)}}),Ho=Zt(function(n){for(var t=-1,r=n.length,e=yu;++t<r;){var u=n[t];u>e&&(e=u)}return e}),Qo=Zt(function(n){for(var t=-1,r=n.length,e=du;++t<r;){var u=n[t];u<e&&(e=u)}return e},!0);return Ln.prototype=Pn.prototype,zn.prototype=Su(Pn.prototype),zn.prototype.constructor=zn,Bn.prototype=Su(Pn.prototype),Bn.prototype.constructor=Bn,Mn.prototype.delete=function(n){return this.has(n)&&delete this.__data__[n]},Mn.prototype.get=function(n){return"__proto__"==n?m:this.__data__[n]},Mn.prototype.has=function(n){return"__proto__"!=n&&Pe.call(this.__data__,n)},Mn.prototype.set=function(n,t){return"__proto__"!=n&&(this.__data__[n]=t),this},Dn.prototype.push=function(n){var t=this.data;"string"==typeof n||ne(n)?t.set.add(n):t.hash[n]=!0},Gr.Cache=Mn,Ln.after=function(n,t){if("function"!=typeof t){if("function"!=typeof n)throw new Te($);var r=n;n=t,t=r}return n=cu(n=+n)?n:0,function(){return 1>--n?t.apply(this,arguments):void 0}},Ln.ary=function(n,t,r){return r&&vr(n,t,r)&&(t=null),t=n&&null==t?n.length:su(+t||0,0),cr(n,I,null,null,null,null,t)},Ln.assign=Ro,Ln.at=Hu,Ln.before=Yr,Ln.bind=po,Ln.bindAll=ho,Ln.bindKey=_o,Ln.callback=ge,Ln.chain=Lr,Ln.chunk=function(n,t,r){t=(r?vr(n,t,r):null==t)?1:su(+t||1,1),r=0;for(var e=n?n.length:0,u=-1,o=Ae(Ve(e/t));r<e;)o[++u]=kt(n,r,r+=t);return o},Ln.compact=function(n){for(var t=-1,r=n?n.length:0,e=-1,u=[];++t<r;){var o=n[t];o&&(u[++e]=o)}return u},Ln.constant=ye,Ln.countBy=Qu,Ln.create=function(n,t,r){var e=Su(n);return r&&vr(n,t,r)&&(t=null),t?Ru(e,t):e},Ln.curry=vo,Ln.curryRight=go,Ln.debounce=Zr,Ln.defaults=So,Ln.defer=yo,Ln.delay=mo,Ln.difference=Mu,Ln.drop=Ir,Ln.dropRight=Rr,Ln.dropRightWhile=function(n,t,r){return n&&n.length?Ut(n,lr(t,r,3),!0,!0):[]},Ln.dropWhile=function(n,t,r){return n&&n.length?Ut(n,lr(t,r,3),!0):[]},Ln.fill=function(n,t,r,e){var u=n?n.length:0;if(!u)return[];for(r&&"number"!=typeof r&&vr(n,t,r)&&(r=0,e=u),u=n.length,0>(r=null==r?0:+r||0)&&(r=-r>u?0:u+r),0>(e=e===m||e>u?u:+e||0)&&(e+=u),u=r>e?0:e>>>0,r>>>=0;r<u;)n[r++]=t;return n},Ln.filter=Br,Ln.flatten=function(n,t,r){var e=n?n.length:0;return r&&vr(n,t,r)&&(t=!1),e?ht(n,t):[]},Ln.flattenDeep=function(n){return n&&n.length?ht(n,!0):[]},Ln.flow=wo,Ln.flowRight=bo,Ln.forEach=ro,Ln.forEachRight=eo,Ln.forIn=Uo,Ln.forInRight=Wo,Ln.forOwn=Fo,Ln.forOwnRight=No,Ln.functions=fe,Ln.groupBy=uo,Ln.indexBy=oo,Ln.initial=function(n){return Rr(n,1)},Ln.intersection=function(){for(var n=[],t=-1,e=arguments.length,u=[],o=sr(),i=o==r,f=[];++t<e;){var a=arguments[t];hr(a)&&(n.push(a),u.push(i&&120<=a.length?Nu(t&&a):null))}if(2>(e=n.length))return f;var c=-1,l=(i=n[0])?i.length:0,s=u[0];n:for(;++c<l;)if(a=i[c],0>(s?qn(s,a):o(f,a,0))){for(t=e;--t;){var p=u[t];if(0>(p?qn(p,a):o(n[t],a,0)))continue n}s&&s.push(a),f.push(a)}return f},Ln.invert=function(n,t,r){r&&vr(n,t,r)&&(t=null),r=-1;for(var e=$o(n),u=e.length,o={};++r<u;){var i=e[r],f=n[i];t?Pe.call(o,f)?o[f].push(i):o[f]=[i]:o[f]=i}return o},Ln.invoke=io,Ln.keys=$o,Ln.keysIn=ae,Ln.map=Dr,Ln.mapKeys=Lo,Ln.mapValues=Po,Ln.matches=me,Ln.matchesProperty=function(n,t){return At(n,ft(t,!0))},Ln.memoize=Gr,Ln.merge=zo,Ln.method=Jo,Ln.methodOf=Xo,Ln.mixin=we,Ln.negate=function(n){if("function"!=typeof n)throw new Te($);return function(){return!n.apply(this,arguments)}},Ln.omit=Bo,Ln.once=function(n){return Yr(2,n)},Ln.pairs=function(n){for(var t=-1,r=$o(n),e=r.length,u=Ae(e);++t<e;){var o=r[t];u[t]=[o,n[o]]}return u},Ln.partial=xo,Ln.partialRight=Ao,Ln.partition=fo,Ln.pick=Mo,Ln.pluck=function(n,t){return Dr(n,xe(t))},Ln.property=xe,Ln.propertyOf=function(n){return function(t){return dt(n,Er(t),t+"")}},Ln.pull=function(){var n=arguments,t=n[0];if(!t||!t.length)return t;for(var r=0,e=sr(),u=n.length;++r<u;)for(var o=0,i=n[r];-1<(o=e(t,i,o));)ru.call(t,o,1);return t},Ln.pullAt=Ku,Ln.range=function(n,t,r){r&&vr(n,t,r)&&(t=r=null),n=+n||0,null==t?(t=n,n=0):t=+t||0;var e=-1;t=su(Ve((t-n)/((r=null==r?1:+r||0)||1)),0);for(var u=Ae(t);++e<t;)u[e]=n,n+=r;return u},Ln.rearg=jo,Ln.reject=function(n,t,r){var e=Oo(n)?Xn:st;return t=lr(t,r,3),e(n,function(n,r,e){return!t(n,r,e)})},Ln.remove=function(n,t,r){var e=[];if(!n||!n.length)return e;var u=-1,o=[],i=n.length;for(t=lr(t,r,3);++u<i;)t(r=n[u],u,n)&&(e.push(r),o.push(u));return Ot(n,o),e},Ln.rest=Ur,Ln.restParam=Jr,Ln.set=function(n,t,r){if(null==n)return n;t=null!=n[e=t+""]||gr(t,n)?[e]:Er(t);for(var e=-1,u=t.length,o=u-1,i=n;null!=i&&++e<u;){var f=t[e];ne(i)&&(e==o?i[f]=r:null==i[f]&&(i[f]=_r(t[e+1])?[]:{})),i=i[f]}return n},Ln.shuffle=Kr,Ln.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&"number"!=typeof r&&vr(n,t,r)&&(t=0,r=e),kt(n,t,r)):[]},Ln.sortBy=function(n,t,r){if(null==n)return[];r&&vr(n,t,r)&&(t=null);var e=-1;return t=lr(t,r,3),Rt(n=bt(n,function(n,r,u){return{a:t(n,r,u),b:++e,c:n}}),a)},Ln.sortByAll=lo,Ln.sortByOrder=function(n,t,r,e){return null==n?[]:(e&&vr(t,r,e)&&(r=null),Oo(t)||(t=null==t?[]:[t]),Oo(r)||(r=null==r?[]:[r]),St(n,t,r))},Ln.spread=function(n){if("function"!=typeof n)throw new Te($);return function(t){return n.apply(this,t)}},Ln.take=function(n,t,r){return n&&n.length?((r?vr(n,t,r):null==t)&&(t=1),kt(n,0,0>t?0:t)):[]},Ln.takeRight=function(n,t,r){var e=n?n.length:0;return e?((r?vr(n,t,r):null==t)&&(t=1),kt(n,0>(t=e-(+t||0))?0:t)):[]},Ln.takeRightWhile=function(n,t,r){return n&&n.length?Ut(n,lr(t,r,3),!1,!0):[]},Ln.takeWhile=function(n,t,r){return n&&n.length?Ut(n,lr(t,r,3)):[]},Ln.tap=function(n,t,r){return t.call(r,n),n},Ln.throttle=function(n,t,r){var e=!0,u=!0;if("function"!=typeof n)throw new Te($);return!1===r?e=!1:ne(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),Nn.leading=e,Nn.maxWait=+t,Nn.trailing=u,Zr(n,t,Nn)},Ln.thru=Pr,Ln.times=function(n,t,r){if(1>(n=Ze(n))||!cu(n))return[];var e=-1,u=Ae(pu(n,mu));for(t=$t(t,r,1);++e<n;)e<mu?u[e]=t(e):t(e);return u},Ln.toArray=function(n){var t=n?Pu(n):0;return dr(t)?t?Ln.support.unindexedChars&&ue(n)?n.split(""):Kn(n):[]:ce(n)},Ln.toPlainObject=ie,Ln.transform=function(n,t,r,e){var u=Oo(n)||oe(n);return t=lr(t,e,4),null==r&&(u||ne(n)?(e=n.constructor,r=u?Oo(n)?new e:[]:Su(ko(e)&&e.prototype)):r={}),(u?Vn:vt)(n,function(n,e,u){return t(r,n,e,u)}),r},Ln.union=Zu,Ln.uniq=Wr,Ln.unzip=Fr,Ln.unzipWith=Nr,Ln.values=ce,Ln.valuesIn=function(n){return Tt(n,ae(n))},Ln.where=function(n,t){return Br(n,xt(t))},Ln.without=Gu,Ln.wrap=function(n,t){return cr(t=null==t?de:t,E,null,[n],[])},Ln.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var r=arguments[n];if(hr(r))var e=e?ct(e,r).concat(ct(r,e)):r}return e?Ct(e):[]},Ln.zip=Ju,Ln.zipObject=$r,Ln.zipWith=Xu,Ln.backflow=bo,Ln.collect=Dr,Ln.compose=bo,Ln.each=ro,Ln.eachRight=eo,Ln.extend=Ro,Ln.iteratee=ge,Ln.methods=fe,Ln.object=$r,Ln.select=Br,Ln.tail=Ur,Ln.unique=Wr,we(Ln,Ln),Ln.add=function(n,t){return(+n||0)+(+t||0)},Ln.attempt=Go,Ln.camelCase=Do,Ln.capitalize=function(n){return(n=u(n))&&n.charAt(0).toUpperCase()+n.slice(1)},Ln.clone=function(n,t,r,e){return t&&"boolean"!=typeof t&&vr(n,t,r)?t=!1:"function"==typeof t&&(e=r,r=t,t=!1),ft(n,t,r="function"==typeof r&&$t(r,e,1))},Ln.cloneDeep=function(n,t,r){return ft(n,!0,t="function"==typeof t&&$t(t,r,1))},Ln.deburr=le,Ln.endsWith=function(n,t,r){t+="";var e=(n=u(n)).length;return r=r===m?e:pu(0>r?0:+r||0,e),0<=(r-=t.length)&&n.indexOf(t,r)==r},Ln.escape=function(n){return(n=u(n))&&pn.test(n)?n.replace(ln,l):n},Ln.escapeRegExp=se,Ln.every=zr,Ln.find=no,Ln.findIndex=Du,Ln.findKey=Co,Ln.findLast=to,Ln.findLastIndex=qu,Ln.findLastKey=To,Ln.findWhere=function(n,t){return no(n,xt(t))},Ln.first=Sr,Ln.get=function(n,t,r){return(n=null==n?m:dt(n,Er(t),t+""))===m?r:n},Ln.has=function(n,t){if(null==n)return!1;var r=Pe.call(n,t);return r||gr(t)||(n=1==(t=Er(t)).length?n:dt(n,kt(t,0,-1)),t=Tr(t),r=null!=n&&Pe.call(n,t)),r||Ln.support.nonEnumStrings&&ue(n)&&_r(t,n.length)},Ln.identity=de,Ln.includes=Mr,Ln.indexOf=Cr,Ln.inRange=function(n,t,r){return t=+t||0,void 0===r?(r=t,t=0):r=+r||0,n>=pu(t,r)&&n<su(t,r)},Ln.isArguments=Xr,Ln.isArray=Oo,Ln.isBoolean=function(n){return!0===n||!1===n||h(n)&&Be.call(n)==B},Ln.isDate=function(n){return h(n)&&Be.call(n)==M},Ln.isElement=Hr,Ln.isEmpty=function(n){return null==n||(hr(n)&&(Oo(n)||ue(n)||Xr(n)||h(n)&&ko(n.splice))?!n.length:!$o(n).length)},Ln.isEqual=function(n,t,r,e){return!(r="function"==typeof r&&$t(r,e,3))&&mr(n)&&mr(t)?n===t:(e=r?r(n,t):m)===m?mt(n,t,r):!!e},Ln.isError=Qr,Ln.isFinite=Eo,Ln.isFunction=ko,Ln.isMatch=function(n,t,r,e){var u=$o(t),o=u.length;if(!o)return!0;if(null==n)return!1;if(r="function"==typeof r&&$t(r,e,3),n=Or(n),!r&&1==o&&mr(e=t[i=u[0]]))return e===n[i]&&(e!==m||i in n);for(var i=Ae(o),f=Ae(o);o--;)e=i[o]=t[u[o]],f[o]=mr(e);return wt(n,u,i,f,r)},Ln.isNaN=function(n){return re(n)&&n!=+n},Ln.isNative=te,Ln.isNull=function(n){return null===n},Ln.isNumber=re,Ln.isObject=ne,Ln.isPlainObject=Io,Ln.isRegExp=ee,Ln.isString=ue,Ln.isTypedArray=oe,Ln.isUndefined=function(n){return n===m},Ln.kebabCase=qo,Ln.last=Tr,Ln.lastIndexOf=function(n,t,r){var e=n?n.length:0;if(!e)return-1;var u=e;if("number"==typeof r)u=(0>r?su(e+r,0):pu(r||0,e-1))+1;else if(r)return n=n[u=Ft(n,t,!0)-1],(t==t?t===n:n!=n)?u:-1;if(t!=t)return p(n,u,!0);for(;u--;)if(n[u]===t)return u;return-1},Ln.max=Ho,Ln.min=Qo,Ln.noConflict=function(){return $n._=Me,this},Ln.noop=be,Ln.now=so,Ln.pad=function(n,t,r){t=+t;var e=(n=u(n)).length;return e<t&&cu(t)?(t=Ze(e=(t-e)/2),(r=fr("",e=Ve(e),r)).slice(0,t)+n+r):n},Ln.padLeft=Ko,Ln.padRight=Vo,Ln.parseInt=pe,Ln.random=function(n,t,r){r&&vr(n,t,r)&&(t=r=null);var e=null==n,u=null==t;return null==r&&(u&&"boolean"==typeof n?(r=n,n=1):"boolean"==typeof t&&(r=t,u=!0)),e&&u&&(t=1,u=!1),n=+n||0,u?(t=n,n=0):t=+t||0,r||n%1||t%1?(r=gu(),pu(n+r*(t-n+parseFloat("1e-"+((r+"").length-1))),t)):Et(n,t)},Ln.reduce=ao,Ln.reduceRight=co,Ln.repeat=he,Ln.result=function(n,t,r){var e=null==n?m:Or(n)[t];return e===m&&(null==n||gr(t,n)||(e=null==(n=1==(t=Er(t)).length?n:dt(n,kt(t,0,-1)))?m:Or(n)[Tr(t)]),e=e===m?r:e),ko(e)?e.call(n):e},Ln.runInContext=_,Ln.size=function(n){var t=n?Pu(n):0;return dr(t)?t:$o(n).length},Ln.snakeCase=Yo,Ln.some=Vr,Ln.sortedIndex=Vu,Ln.sortedLastIndex=Yu,Ln.startCase=Zo,Ln.startsWith=function(n,t,r){return n=u(n),r=null==r?0:pu(0>r?0:+r||0,n.length),n.lastIndexOf(t,r)==r},Ln.sum=function(n,t,r){r&&vr(n,t,r)&&(t=null);var e=lr(),u=null==t;if(e===it&&u||(u=!1,t=e(t,r,3)),u){for(t=(n=Oo(n)?n:jr(n)).length,r=0;t--;)r+=+n[t]||0;n=r}else n=function(n,t){var r=0;return Cu(n,function(n,e,u){r+=+t(n,e,u)||0}),r}(n,t);return n},Ln.template=function(n,t,r){var e=Ln.templateSettings;r&&vr(n,t,r)&&(t=r=null),n=u(n),t=et(Ru({},r||t),e,rt),r=et(Ru({},t.imports),e.imports,rt);var o,i,f=$o(r),a=Tt(r,f),c=0;r=t.interpolate||In;var l="__p+='";r=Se((t.escape||In).source+"|"+r.source+"|"+(r===vn?An:In).source+"|"+(t.evaluate||In).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(n.replace(r,function(t,r,e,u,f,a){return e||(e=u),l+=n.slice(c,a).replace(Rn,s),r&&(o=!0,l+="'+__e("+r+")+'"),f&&(i=!0,l+="';"+f+";\n__p+='"),e&&(l+="'+((__t=("+e+"))==null?'':__t)+'"),c=a+t.length,t}),l+="';",(t=t.variable)||(l="with(obj){"+l+"}"),l=(i?l.replace(on,""):l).replace(fn,"$1").replace(an,"$1;"),l="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(o?",__e=_.escape":"")+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",(t=Go(function(){return Ee(f,p+"return "+l).apply(m,a)})).source=l,Qr(t))throw t;return t},Ln.trim=_e,Ln.trimLeft=function(n,t,r){var e=n;return(n=u(n))?n.slice((r?vr(e,t,r):null==t)?g(n):i(n,t+"")):n},Ln.trimRight=function(n,t,r){var e=n;return(n=u(n))?(r?vr(e,t,r):null==t)?n.slice(0,y(n)+1):n.slice(0,f(n,t+"")+1):n},Ln.trunc=function(n,t,r){r&&vr(n,t,r)&&(t=null);var e=S;if(r=C,null!=t)if(ne(t)){var o="separator"in t?t.separator:o;e="length"in t?+t.length||0:e,r="omission"in t?u(t.omission):r}else e=+t||0;if(e>=(n=u(n)).length)return n;if(1>(e-=r.length))return r;if(t=n.slice(0,e),null==o)return t+r;if(ee(o)){if(n.slice(e).search(o)){var i,f=n.slice(0,e);for(o.global||(o=Se(o.source,(jn.exec(o)||"")+"g")),o.lastIndex=0;n=o.exec(f);)i=n.index;t=t.slice(0,null==i?e:i)}}else n.indexOf(o,e)!=e&&-1<(o=t.lastIndexOf(o))&&(t=t.slice(0,o));return t+r},Ln.unescape=function(n){return(n=u(n))&&sn.test(n)?n.replace(cn,d):n},Ln.uniqueId=function(n){var t=++ze;return u(n)+t},Ln.words=ve,Ln.all=zr,Ln.any=Vr,Ln.contains=Mr,Ln.detect=no,Ln.foldl=ao,Ln.foldr=co,Ln.head=Sr,Ln.include=Mr,Ln.inject=ao,we(Ln,function(){var n={};return vt(Ln,function(t,r){Ln.prototype[r]||(n[r]=t)}),n}(),!1),Ln.sample=qr,Ln.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(t){return qr(t,n)}):qr(this.value())},Ln.VERSION=w,Vn("bind bindKey curry curryRight partial partialRight".split(" "),function(n){Ln[n].placeholder=Ln}),Vn(["dropWhile","filter","map","takeWhile"],function(n,t){var r=t!=N,e=t==W;Bn.prototype[n]=function(n,u){var o=this.__filtered__,i=o&&e?new Bn(this):this.clone();return(i.__iteratees__||(i.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:lr(n,u,1),limit:-1,type:t}),i.__filtered__=o||r,i}}),Vn(["drop","take"],function(n,t){var r=n+"While";Bn.prototype[n]=function(r){var e=this.__filtered__,u=e&&!t?this.dropWhile():this.clone();return r=null==r?1:su(Ze(r)||0,0),e?t?u.__takeCount__=pu(u.__takeCount__,r):Tr(u.__iteratees__).limit=r:(u.__views__||(u.__views__=[])).push({size:r,type:n+(0>u.__dir__?"Right":"")}),u},Bn.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()},Bn.prototype[n+"RightWhile"]=function(n,t){return this.reverse()[r](n,t).reverse()}}),Vn(["first","last"],function(n,t){var r="take"+(t?"Right":"");Bn.prototype[n]=function(){return this[r](1).value()[0]}}),Vn(["initial","rest"],function(n,t){var r="drop"+(t?"":"Right");Bn.prototype[n]=function(){return this[r](1)}}),Vn(["pluck","where"],function(n,t){var r=t?"filter":"map",e=t?xt:xe;Bn.prototype[n]=function(n){return this[r](e(n))}}),Bn.prototype.compact=function(){return this.filter(de)},Bn.prototype.reject=function(n,t){return n=lr(n,t,1),this.filter(function(t){return!n(t)})},Bn.prototype.slice=function(n,t){var r=this;return 0>(n=null==n?0:+n||0)?r=this.takeRight(-n):n&&(r=this.drop(n)),t!==m&&(r=0>(t=+t||0)?r.dropRight(-t):r.take(t-n)),r},Bn.prototype.toArray=function(){return this.drop(0)},vt(Bn.prototype,function(n,t){var r=Ln[t];if(r){var e=/^(?:filter|map|reject)|While$/.test(t),u=/^(?:first|last)$/.test(t);Ln.prototype[t]=function(){function t(n){return n=[n],Xe.apply(n,o),r.apply(Ln,n)}var o=arguments,i=this.__chain__,f=this.__wrapped__,a=!!this.__actions__.length,c=f instanceof Bn,l=o[0],s=c||Oo(f);return s&&e&&"function"==typeof l&&1!=l.length&&(c=s=!1),c=c&&!a,u&&!i?c?n.call(f):r.call(Ln,this.value()):s?(f=n.apply(c?f:new Bn(this),o),u||!a&&!f.__actions__||(f.__actions__||(f.__actions__=[])).push({func:Pr,args:[t],thisArg:Ln}),new zn(f,i)):this.thru(t)}}}),Vn("concat join pop push replace shift sort splice split unshift".split(" "),function(n){var t=(/^(?:replace|split)$/.test(n)?Ne:Ue)[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:join|pop|replace|shift)$/.test(n),u=Iu.spliceObjects||!/^(?:pop|shift|splice)$/.test(n)?t:function(){var n=t.apply(this,arguments);return 0===this.length&&delete this[0],n};Ln.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?u.apply(this.value(),n):this[r](function(t){return u.apply(t,n)})}}),vt(Bn.prototype,function(n,t){var r=Ln[t];if(r){var e=r.name;(Ou[e]||(Ou[e]=[])).push({name:t,func:r})}}),Ou[ir(null,x).name]=[{name:"wrapper",func:null}],Bn.prototype.clone=function(){var n=this.__actions__,t=this.__iteratees__,r=this.__views__,e=new Bn(this.__wrapped__);return e.__actions__=n?Kn(n):null,e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=t?Kn(t):null,e.__takeCount__=this.__takeCount__,e.__views__=r?Kn(r):null,e},Bn.prototype.reverse=function(){if(this.__filtered__){var n=new Bn(this);n.__dir__=-1,n.__filtered__=!0}else(n=this.clone()).__dir__*=-1;return n},Bn.prototype.value=function(){var n=this.__wrapped__.value();if(!Oo(n))return Wt(n,this.__actions__);var t,r=this.__dir__,e=0>r;t=n.length;for(var u=0,o=-1,i=(c=this.__views__)?c.length:0;++o<i;){var f=c[o],a=f.size;switch(f.type){case"drop":u+=a;break;case"dropRight":t-=a;break;case"take":t=pu(t,u+a);break;case"takeRight":u=su(u,t-a)}}c=(t={start:u,end:t}).start,t=(u=t.end)-c,c=e?u:c-1,u=pu(t,this.__takeCount__),i=(o=this.__iteratees__)?o.length:0,f=0,a=[];n:for(;t--&&f<u;){for(var c,l=-1,s=n[c+=r];++l<i;){var p=o[l],h=p.iteratee,_=p.type;if(_==W){if(p.done&&(e?c>p.index:c<p.index)&&(p.count=0,p.done=!1),p.index=c,!(p.done||(_=p.limit,p.done=-1<_?p.count++>=_:!h(s))))continue n}else if(p=h(s),_==N)s=p;else if(!p){if(_==F)continue n;break n}}a[f++]=s}return a},Ln.prototype.chain=function(){return Lr(this)},Ln.prototype.commit=function(){return new zn(this.value(),this.__chain__)},Ln.prototype.plant=function(n){for(var t,r=this;r instanceof Pn;){var e=kr(r);t?u.__wrapped__=e:t=e;var u=e;r=r.__wrapped__}return u.__wrapped__=n,t},Ln.prototype.reverse=function(){var n=this.__wrapped__;return n instanceof Bn?(this.__actions__.length&&(n=new Bn(this)),new zn(n.reverse(),this.__chain__)):this.thru(function(n){return n.reverse()})},Ln.prototype.toString=function(){return this.value()+""},Ln.prototype.run=Ln.prototype.toJSON=Ln.prototype.valueOf=Ln.prototype.value=function(){return Wt(this.__wrapped__,this.__actions__)},Ln.prototype.collect=Ln.prototype.map,Ln.prototype.head=Ln.prototype.first,Ln.prototype.select=Ln.prototype.filter,Ln.prototype.tail=Ln.prototype.rest,Ln}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Yn._=Gn,define(function(){return Gn})):Mn&&Dn?Vn?(Dn.exports=Gn)._=Gn:Mn._=Gn:Yn._=Gn}).call(this);!function(t){"function"==typeof define&&define.amd?define(["jquery","lodash"],t):t(jQuery,_)}(function(t,i){var e=window,n={is_intercepted:function(t,i){return!(t.x+t.width<=i.x||i.x+i.width<=t.x||t.y+t.height<=i.y||i.y+i.height<=t.y)},sort:function(t,e,n){return n=n||i.chain(t).map(function(t){return t.x+t.width}).max().value(),e=-1!=e?1:-1,i.sortBy(t,function(t){return e*(t.x+t.y*n)})},create_stylesheet:function(t){var i=document.createElement("style");return i.setAttribute("type","text/css"),i.setAttribute("data-gs-id",t),i.styleSheet?i.styleSheet.cssText="":i.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(i),i.sheet},insert_css_rule:function(t,i,e,n){"function"==typeof t.insertRule?t.insertRule(i+"{"+e+"}",n):"function"==typeof t.addRule&&t.addRule(i,e,n)},toBool:function(t){return"boolean"==typeof t?t:"string"==typeof t?!(""==(t=t.toLowerCase())||"no"==t||"false"==t||"0"==t):Boolean(t)}},s=0,o=function(t,i,e,n,s){this.width=t,this.float=e||!1,this.height=n||0,this.nodes=s||[],this.onchange=i||function(){},this._update_counter=0,this._float=this.float};o.prototype.batch_update=function(){this._update_counter=1,this.float=!0},o.prototype.commit=function(){this._update_counter=0,0==this._update_counter&&(this.float=this._float,this._pack_nodes(),this._notify())},o.prototype._fix_collisions=function(t){this._sort_nodes(-1);var e=t,s=Boolean(i.find(this.nodes,function(t){return t.locked}));for(this.float||s||(e={x:0,y:t.y,width:this.width,height:t.height});;){var o=i.find(this.nodes,function(i){return i!=t&&n.is_intercepted(i,e)},this);if(void 0===o)return;this.move_node(o,o.x,t.y+t.height,o.width,o.height,!0)}},o.prototype.is_area_empty=function(t,e,s,o){var a={x:t||0,y:e||0,width:s||1,height:o||1};return null==i.find(this.nodes,function(t){return n.is_intercepted(t,a)},this)},o.prototype._sort_nodes=function(t){this.nodes=n.sort(this.nodes,t,this.width)},o.prototype._pack_nodes=function(){this._sort_nodes(),this.float?i.each(this.nodes,function(t,e){if(!t._updating&&void 0!==t._orig_y&&t.y!=t._orig_y)for(var s=t.y;s>=t._orig_y;){i.chain(this.nodes).find(function(i){return t!=i&&n.is_intercepted({x:t.x,y:s,width:t.width,height:t.height},i)}).value()||(t._dirty=!0,t.y=s),--s}},this):i.each(this.nodes,function(t,e){if(!t.locked)for(;t.y>0;){var s=t.y-1,o=0==e;if(e>0)o=void 0===i.chain(this.nodes).take(e).find(function(i){return n.is_intercepted({x:t.x,y:s,width:t.width,height:t.height},i)}).value();if(!o)break;t._dirty=t.y!=s,t.y=s}},this)},o.prototype._prepare_node=function(t,e){return(t=i.defaults(t||{},{width:1,height:1,x:0,y:0})).x=parseInt(""+t.x),t.y=parseInt(""+t.y),t.width=parseInt(""+t.width),t.height=parseInt(""+t.height),t.auto_position=t.auto_position||!1,t.no_resize=t.no_resize||!1,t.no_move=t.no_move||!1,t.width>this.width?t.width=this.width:t.width<1&&(t.width=1),t.height<1&&(t.height=1),t.x<0&&(t.x=0),t.x+t.width>this.width&&(e?t.width=this.width-t.x:t.x=this.width-t.width),t.y<0&&(t.y=0),t},o.prototype._notify=function(){if(!this._update_counter){var t=Array.prototype.slice.call(arguments,1).concat(this.get_dirty_nodes());t=t.concat(this.get_dirty_nodes()),this.onchange(t)}},o.prototype.clean_nodes=function(){i.each(this.nodes,function(t){t._dirty=!1})},o.prototype.get_dirty_nodes=function(){return i.filter(this.nodes,function(t){return t._dirty})},o.prototype.add_node=function(t){if(void 0!==(t=this._prepare_node(t)).max_width&&(t.width=Math.min(t.width,t.max_width)),void 0!==t.max_height&&(t.height=Math.min(t.height,t.max_height)),void 0!==t.min_width&&(t.width=Math.max(t.width,t.min_width)),void 0!==t.min_height&&(t.height=Math.max(t.height,t.min_height)),t._id=++s,t._dirty=!0,t.auto_position){this._sort_nodes();for(var e=0;;++e){var o=e%this.width,a=Math.floor(e/this.width);if(!(o+t.width>this.width)&&!i.find(this.nodes,function(i){return n.is_intercepted({x:o,y:a,width:t.width,height:t.height},i)})){t.x=o,t.y=a;break}}}return this.nodes.push(t),this._fix_collisions(t),this._pack_nodes(),this._notify(),t},o.prototype.remove_node=function(t){t._id=null,this.nodes=i.without(this.nodes,t),this._pack_nodes(),this._notify(t)},o.prototype.can_move_node=function(e,n,s,a,h){var r,d=Boolean(i.find(this.nodes,function(t){return t.locked}));if(!this.height&&!d)return!0;var _=new o(this.width,null,this.float,0,i.map(this.nodes,function(i){return i==e?r=t.extend({},i):t.extend({},i)}));_.move_node(r,n,s,a,h);var l=!0;return d&&(l&=!Boolean(i.find(_.nodes,function(t){return t!=r&&Boolean(t.locked)&&Boolean(t._dirty)}))),this.height&&(l&=_.get_grid_height()<=this.height),l},o.prototype.can_be_placed_with_respect_to_height=function(e){if(!this.height)return!0;var n=new o(this.width,null,this.float,0,i.map(this.nodes,function(i){return t.extend({},i)}));return n.add_node(e),n.get_grid_height()<=this.height},o.prototype.move_node=function(t,i,e,n,s,o){if("number"!=typeof i&&(i=t.x),"number"!=typeof e&&(e=t.y),"number"!=typeof n&&(n=t.width),"number"!=typeof s&&(s=t.height),void 0!==t.max_width&&(n=Math.min(n,t.max_width)),void 0!==t.max_height&&(s=Math.min(s,t.max_height)),void 0!==t.min_width&&(n=Math.max(n,t.min_width)),void 0!==t.min_height&&(s=Math.max(s,t.min_height)),t.x==i&&t.y==e&&t.width==n&&t.height==s)return t;var a=t.width!=n;return t._dirty=!0,t.x=i,t.y=e,t.width=n,t.height=s,t=this._prepare_node(t,a),this._fix_collisions(t),o||(this._pack_nodes(),this._notify()),t},o.prototype.get_grid_height=function(){return i.reduce(this.nodes,function(t,i){return Math.max(t,i.y+i.height)},0)},o.prototype.begin_update=function(t){i.each(this.nodes,function(t){t._orig_y=t.y}),t._updating=!0},o.prototype.end_update=function(){i.each(this.nodes,function(t){t._orig_y=t.y});var t=i.find(this.nodes,function(t){return t._updating});t&&(t._updating=!1)};var a=function(e,n){var s,a=this;this.container=t(e),n.item_class=n.item_class||"grid-stack-item";var h=this.container.closest("."+n.item_class).size()>0;if(this.opts=i.defaults(n||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,item_class:"grid-stack-item",placeholder_class:"grid-stack-placeholder",handle:".grid-stack-item-content",cell_height:60,vertical_margin:20,auto:!0,min_width:768,float:!1,_class:n.grid_class||"grid-stack-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,always_show_resize_handle:n.always_show_resize_handle||!1,resizable:i.defaults(n.resizable||{},{autoHide:!n.always_show_resize_handle,handles:"se"}),draggable:i.defaults(n.draggable||{},{handle:".grid-stack-item-content",scroll:!1,appendTo:"body"})}),this.opts.is_nested=h,this.container.addClass(this.opts._class),h&&this.container.addClass("grid-stack-nested"),this._init_styles(),this.grid=new o(this.opts.width,function(t){var e=0;i.each(t,function(t){null==t._id?t.el.remove():(t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height),e=Math.max(e,t.y+t.height))}),a._update_styles(e+10)},this.opts.float,this.opts.height),this.opts.auto){var r=[],d=this;this.container.children("."+this.opts.item_class).each(function(i,e){e=t(e),r.push({el:e,i:parseInt(e.attr("data-gs-x"))+parseInt(e.attr("data-gs-y"))*d.opts.width})}),i.chain(r).sortBy(function(t){return t.i}).each(function(t){a._prepare_element(t.el)}).value()}this.set_animation(this.opts.animate),this.placeholder=t('<div class="'+this.opts.placeholder_class+" "+this.opts.item_class+'"><div class="placeholder-content" /></div>').hide(),this.container.append(this.placeholder),this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin);var _=function(){if(a._is_one_column_mode()){if(s)return;s=!0,a.grid._sort_nodes(),i.each(a.grid.nodes,function(t){a.container.append(t.el),t.no_move||t.el.draggable("disable"),t.no_resize||t.el.resizable("disable")})}else{if(!s)return;s=!1,i.each(a.grid.nodes,function(t){t.no_move||t.el.draggable("enable"),t.no_resize||t.el.resizable("enable")})}};t(window).resize(_),_()};return a.prototype._init_styles=function(){this._styles_id&&t('[data-gs-id="'+this._styles_id+'"]').remove(),this._styles_id="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=n.create_stylesheet(this._styles_id),null!=this._styles&&(this._styles._max=0)},a.prototype._update_styles=function(t){if(null!=this._styles){var i="."+this.opts._class+" ."+this.opts.item_class;if(void 0===t&&(t=this._styles._max,this._init_styles(),this._update_container_height()),0==this._styles._max&&n.insert_css_rule(this._styles,i,"min-height: "+this.opts.cell_height+"px;",0),t>this._styles._max){for(var e=this._styles._max;e<t;++e)n.insert_css_rule(this._styles,i+'[data-gs-height="'+(e+1)+'"]',"height: "+(this.opts.cell_height*(e+1)+this.opts.vertical_margin*e)+"px;",e),n.insert_css_rule(this._styles,i+'[data-gs-min-height="'+(e+1)+'"]',"min-height: "+(this.opts.cell_height*(e+1)+this.opts.vertical_margin*e)+"px;",e),n.insert_css_rule(this._styles,i+'[data-gs-max-height="'+(e+1)+'"]',"max-height: "+(this.opts.cell_height*(e+1)+this.opts.vertical_margin*e)+"px;",e),n.insert_css_rule(this._styles,i+'[data-gs-y="'+e+'"]',"top: "+(this.opts.cell_height*e+this.opts.vertical_margin*e)+"px;",e);this._styles._max=t}}},a.prototype._update_container_height=function(){this.grid._update_counter||this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin)},a.prototype._is_one_column_mode=function(){return t(window).width()<=this.opts.min_width},a.prototype._prepare_element=function(e){var s=this;(e=t(e)).addClass(this.opts.item_class);var o,a,h=s.grid.add_node({x:e.attr("data-gs-x"),y:e.attr("data-gs-y"),width:e.attr("data-gs-width"),height:e.attr("data-gs-height"),max_width:e.attr("data-gs-max-width"),min_width:e.attr("data-gs-min-width"),max_height:e.attr("data-gs-max-height"),min_height:e.attr("data-gs-min-height"),auto_position:n.toBool(e.attr("data-gs-auto-position")),no_resize:n.toBool(e.attr("data-gs-no-resize")),no_move:n.toBool(e.attr("data-gs-no-move")),locked:n.toBool(e.attr("data-gs-locked")),el:e});e.data("_gridstack_node",h);var r=function(i,n){var r=t(this);s.grid.clean_nodes(),s.grid.begin_update(h),o=Math.ceil(r.outerWidth()/r.attr("data-gs-width")),a=s.opts.cell_height+s.opts.vertical_margin,s.placeholder.attr("data-gs-x",r.attr("data-gs-x")).attr("data-gs-y",r.attr("data-gs-y")).attr("data-gs-width",r.attr("data-gs-width")).attr("data-gs-height",r.attr("data-gs-height")).show(),h.el=s.placeholder,e.resizable("option","minWidth",o*(h.min_width||1)),e.resizable("option","minHeight",s.opts.cell_height*(h.min_height||1))},d=function(i,e){var n=t(this);h.el=n,s.placeholder.hide(),n.attr("data-gs-x",h.x).attr("data-gs-y",h.y).attr("data-gs-width",h.width).attr("data-gs-height",h.height).removeAttr("style"),s._update_container_height(),s.container.trigger("change",[s.grid.get_dirty_nodes()]),s.grid.end_update()};e.draggable(i.extend(this.opts.draggable,{start:r,stop:d,drag:function(t,i){var e=Math.round(i.position.left/o),n=Math.floor((i.position.top+a/2)/a);s.grid.can_move_node(h,e,n,h.width,h.height)&&(s.grid.move_node(h,e,n),s._update_container_height())},containment:this.opts.is_nested?this.container.parent():null})).resizable(i.extend(this.opts.resizable,{start:r,stop:d,resize:function(t,i){var e=Math.round(i.position.left/o),n=Math.floor((i.position.top+a/2)/a),r=Math.round(i.size.width/o),d=Math.round(i.size.height/a);s.grid.can_move_node(h,e,n,r,d)&&(s.grid.move_node(h,e,n,r,d),s._update_container_height())}})),(h.no_move||this._is_one_column_mode())&&e.draggable("disable"),(h.no_resize||this._is_one_column_mode())&&e.resizable("disable"),e.attr("data-gs-locked",h.locked?"yes":null)},a.prototype.set_animation=function(t){t?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},a.prototype.add_widget=function(i,e,n,s,o,a){return i=t(i),void 0!==e&&i.attr("data-gs-x",e),void 0!==n&&i.attr("data-gs-y",n),void 0!==s&&i.attr("data-gs-width",s),void 0!==o&&i.attr("data-gs-height",o),void 0!==a&&i.attr("data-gs-auto-position",a?"yes":null),this.container.append(i),this._prepare_element(i),this._update_container_height(),i},a.prototype.will_it_fit=function(t,i,e,n,s){var o={x:t,y:i,width:e,height:n,auto_position:s};return this.grid.can_be_placed_with_respect_to_height(o)},a.prototype.remove_widget=function(i,e){e=void 0===e||e;var n=(i=t(i)).data("_gridstack_node");this.grid.remove_node(n),i.removeData("_gridstack_node"),this._update_container_height(),e&&i.remove()},a.prototype.remove_all=function(t){i.each(this.grid.nodes,function(i){this.remove_widget(i.el,t)},this),this.grid.nodes=[],this._update_container_height()},a.prototype.resizable=function(i,e){return(i=t(i)).each(function(i,n){var s=(n=t(n)).data("_gridstack_node");void 0!==s&&null!=s&&(s.no_resize=!e,s.no_resize?n.resizable("disable"):n.resizable("enable"))}),this},a.prototype.movable=function(i,e){return(i=t(i)).each(function(i,n){var s=(n=t(n)).data("_gridstack_node");void 0!==s&&null!=s&&(s.no_move=!e,s.no_move?n.draggable("disable"):n.draggable("enable"))}),this},a.prototype.disable=function(){this.movable(this.container.children("."+this.opts.item_class),!1),this.resizable(this.container.children("."+this.opts.item_class),!1)},a.prototype.enable=function(){this.movable(this.container.children("."+this.opts.item_class),!0),this.resizable(this.container.children("."+this.opts.item_class),!0)},a.prototype.locked=function(i,e){return(i=t(i)).each(function(i,n){var s=(n=t(n)).data("_gridstack_node");void 0!==s&&null!=s&&(s.locked=e||!1,n.attr("data-gs-locked",s.locked?"yes":null))}),this},a.prototype._update_element=function(i,e){var n=(i=t(i).first()).data("_gridstack_node");if(void 0!==n&&null!=n){this.grid.clean_nodes(),this.grid.begin_update(n),e.call(this,i,n),this._update_container_height(),this.container.trigger("change",[this.grid.get_dirty_nodes()]),this.grid.end_update()}},a.prototype.resize=function(t,i,e){this._update_element(t,function(t,n){i=null!=i&&void 0!==i?i:n.width,e=null!=e&&void 0!==e?e:n.height,this.grid.move_node(n,n.x,n.y,i,e)})},a.prototype.move=function(t,i,e){this._update_element(t,function(t,n){i=null!=i&&void 0!==i?i:n.x,e=null!=e&&void 0!==e?e:n.y,this.grid.move_node(n,i,e,n.width,n.height)})},a.prototype.update=function(t,i,e,n,s){this._update_element(t,function(t,o){i=null!=i&&void 0!==i?i:o.x,e=null!=e&&void 0!==e?e:o.y,n=null!=n&&void 0!==n?n:o.width,s=null!=s&&void 0!==s?s:o.height,this.grid.move_node(o,i,e,n,s)})},a.prototype.cell_height=function(t){if(void 0===t)return this.opts.cell_height;(t=parseInt(t))!=this.opts.cell_height&&(this.opts.cell_height=t||this.opts.cell_height,this._update_styles())},a.prototype.cell_width=function(){var t=this.container.children("."+this.opts.item_class).first();return Math.ceil(t.outerWidth()/t.attr("data-gs-width"))},a.prototype.get_cell_from_pixel=function(t){var i=this.container.position(),e=t.left-i.left,n=t.top-i.top,s=Math.floor(this.container.width()/this.opts.width),o=this.opts.cell_height+this.opts.vertical_margin;return{x:Math.floor(e/s),y:Math.floor(n/o)}},a.prototype.batch_update=function(){this.grid.batch_update()},a.prototype.commit=function(){this.grid.commit(),this._update_container_height()},a.prototype.is_area_empty=function(t,i,e,n){return this.grid.is_area_empty(t,i,e,n)},e.GridStackUI=a,e.GridStackUI.Utils=n,t.fn.gridstack=function(i){return this.each(function(){t(this).data("gridstack")||t(this).data("gridstack",new a(this,i))})},e.GridStackUI});!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(O){O.fn.jR3DCarousel=function(t){function c(){l(),r=setInterval(d,w.animationInterval+w.animationDuration)}function l(){r&&clearInterval(r)}function d(){Z=I+1,S.run(w.animation,Z),u()}function h(t){Z=Math.floor(I/Y)*Y+t,S.run(w.animation,Z),u()}function n(){this.animations={slide:i,slide3D:e,scroll:a,scroll3D:o,fade:s}}function i(t){M.css({perspective:"",overflow:"hidden"}),P=g*t,D.css({transform:"translateZ("+-v+"px) rotateY("+-P+"deg)"})}function e(t){M.css({perspective:x,overflow:"visible"}),P=g*t,D.css({transform:"translateZ("+-v+"px) rotateY("+-P+"deg)"})}function a(t){M.css({perspective:"",overflow:"hidden"}),P=g*t,D.css({transform:"translateZ("+-v+"px) rotateX("+-P+"deg)"})}function o(t){M.css({perspective:x,overflow:"visible"}),P=g*t,D.css({transform:"translateZ("+-v+"px) rotateX("+-P+"deg)"})}function s(t){D.css({transition:"opacity "+w.animationDuration+"ms "+w.animationCurve,opacity:0}),P=g*t,D.css({transform:"translateZ("+-v+"px) rotateY("+-P+"deg)"}),D.css({opacity:1})}function u(){M.find(".nav").css({backgroundColor:"rgba(255, 255, 255, 0.77)"}).eq(Z%Y).css({backgroundColor:"rgba(0, 0, 0, 0.77)"}),I=Math.round(P/g),w.onSlideShow.call(this,D.find("."+w.slideClass).eq(I%Y))}function f(){M.width("100%"),D.hide(),y=M.width()<w.width?M.width():w.width,C=y/k,M.css({width:y+"px",height:C+"px"}),-1!=w.animation.indexOf("slide")?(v=y/2/Math.tan(Math.PI/Y),x=y/2*Math.tan(2*Math.PI/Y)+"px"):-1!=w.animation.indexOf("scroll")?(v=C/2/Math.tan(Math.PI/Y),x=C/2*Math.tan(2*Math.PI/Y)+"px"):"fade"==w.animation&&(v=y/2/Math.tan(Math.PI/Y),x=y/2*Math.tan(2*Math.PI/Y)+"px"),M.find("."+w.slideClass).each(function(t){var n=O(this);-1!=w.animation.indexOf("slide")?b="rotateY("+g*t+"deg) translateZ("+v+"px)":-1!=w.animation.indexOf("scroll")?b="rotateX("+g*t+"deg) translateZ("+v+"px)":"fade"==w.animation&&(b="rotateY("+g*t+"deg) translateZ("+v+"px)"),n.css({transform:b})}),x=w.perspective||x,D.css({transform:"translateZ("+-v+"px) rotateY("+-P+"deg)"}),D.show(),M.css({perspective:x})}var p,m,r,g,v,x,b,w=O.extend(!0,{},{width:innerWidth,height:innerHeight,slides:[],slideLayout:"fill",perspective:0,animation:"slide3D",animationCurve:"ease",animationDuration:700,animationInterval:2e3,autoplay:!0,controls:!0,slideClass:"jR3DCarouselSlide",navigation:"circles",rotationDirection:"rtl",onSlideShow:function(){}},t),M=this,y=w.width,C=w.height,k=w.width/w.height,D=O("<div class='jR3DCarousel' />").css({width:"100%",height:"100%",transition:"transform "+w.animationDuration+"ms "+w.animationCurve,transformStyle:"preserve-3d"}).appendTo(M),I=0,Z=1,S=new n,P=0,Y=w.slides.length||M.find("."+w.slideClass).length;return function(){var n,i,e,a,o,s,r;if(function(){if(-1!=w.animation.indexOf("slide")?(v=y/2/Math.tan(Math.PI/Y),x=y/2*Math.tan(2*Math.PI/Y)+"px"):-1!=w.animation.indexOf("scroll")?(v=C/2/Math.tan(Math.PI/Y),x=C/2*Math.tan(2*Math.PI/Y)+"px"):"fade"==w.animation&&(v=y/2/Math.tan(Math.PI/Y),x=y/2*Math.tan(2*Math.PI/Y)+"px"),g=360/Y,w.slides.length)for(var t=0;t<w.slides.length;t++){var n=O("<div class='jR3DCarouselSlide' data-index="+t+" />").append("<img src='"+w.slides[t].src+"' alt='"+w.slides[t].alt+"' />");-1!=w.animation.indexOf("slide")?b="rotateY("+g*t+"deg) translateZ("+v+"px)":-1!=w.animation.indexOf("scroll")?b="rotateX("+g*t+"deg) translateZ("+v+"px)":"fade"==w.animation&&(b="rotateY("+g*t+"deg) translateZ("+v+"px)"),n.css({transform:b}),D.append(n)}else M.find("."+w.slideClass).each(function(t){var n=O(this).attr("data-index",t);-1!=w.animation.indexOf("slide")?b="rotateY("+g*t+"deg) translateZ("+v+"px)":-1!=w.animation.indexOf("scroll")?b="rotateX("+g*t+"deg) translateZ("+v+"px)":"fade"==w.animation&&(b="rotateY("+g*t+"deg) translateZ("+v+"px)"),n=n.css({transform:b}).detach(),D.append(n)});D.find("."+w.slideClass).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",backfaceVisibility:"hidden"}).find("img").css({width:"100%",height:"100%",objectFit:w.slideLayout}),x=w.perspective||x,M.css({perspective:x,width:y+"px",height:C+"px",position:"relative",overflow:"visible"})}(),w.controls&&("rtl"==w.rotationDirection?(p=O("<div class='previous controls' style='left: 0.1em;'>&lang;</div>"),m=O("<div class='next controls' style='right: 0.1em;'>&rang;</div>")):(p=O("<div class='previous controls' style='right: 0.1em;'>&rang;</div>"),m=O("<div class='next controls' style='left: 0.1em;'>&lang;</div>")),p.add(m).css({position:"absolute",top:"50%",zIndex:1,transform:"translateY(-50%)",fontSize:"4em",color:"rgba(255, 255, 255, 0.97)",cursor:"pointer",userSelect:"none"}).appendTo(M).hide(),p.on("click",function(){Z=I-1,S.run(w.animation,Z),u()}),m.on("click",function(){d()}),M.on("mouseenter touchstart",function(){p.add(m).show()}).on("mouseleave touchcancel",function(){p.add(m).hide()}),p.hover(function(){p.css({color:"rgba(201, 201, 201, 0.97)"})},function(){p.css({color:"rgba(255, 255, 255, 0.97)"})}),m.hover(function(){m.css({color:"rgba(201, 201, 201, 0.97)"})},function(){m.css({color:"rgba(255, 255, 255, 0.97)"})}),O(document).on("keydown",function(t){var n=M[0].getBoundingClientRect();(n=0<n.bottom&&0<n.right&&n.left<(innerWidth||document.documentElement.clientWidth)&&n.top<(innerHeight||document.documentElement.clientHeight))&&37==t.which?(l(),"rtl"==w.rotationDirection?p.click():m.click()):n&&39==t.which&&(l(),"rtl"==w.rotationDirection?m.click():p.click())}),n=function(t){l(),"left"==t?m.click():"right"==t?p.click():-1!=w.animation.indexOf("scroll")&&("down"==t?m.click():"up"==t&&p.click())},M.on("touchstart",function(t){t=t.originalEvent.changedTouches[0],i="none",e=t.pageX,a=t.pageY,r=(new Date).getTime()}).on("touchmove",function(t){t.preventDefault()}).on("touchend",function(t){t=t.originalEvent.changedTouches[0],o=t.pageX-e,s=t.pageY-a,(new Date).getTime()-r<=700&&(20<=Math.abs(o)&&Math.abs(s)<=100?i=o<0?"left":"right":20<=Math.abs(s)&&Math.abs(o)<=100&&(i=s<0?"up":"down")),n(i)})),w.navigation&&function(){for(var t=O("<div class=navigation />").css({position:"absolute",bottom:0,right:0}),n=0;n<Y;n++)t.append("<div class=nav></div>");"circles"==w.navigation&&t.find(".nav").css({borderRadius:"12px"}),t.find(".nav").css({display:"inline-block",margin:"5px",cursor:"pointer",backgroundColor:"rgba(255, 255, 255, 0.77)",width:"12px",height:"12px",transition:"all "+w.animationDuration+"ms ease"}).first().css({backgroundColor:"rgba(0, 0, 0, 1)"}),D.after(t),M.on("click",".nav",function(){h(O(this).index())})}(),addEventListener("resize",f),f(),w.autoplay){var t=function(){document.hidden?l():c()};document.addEventListener("visibilitychange",t),addEventListener("beforeunload",function(){document.removeEventListener("visibilitychange",t)}),M.hover(function(){clearTimeout(O(this).data("timeout")),l()},function(){O(this).data("timeout",setTimeout(function(){c()},w.animationInterval+w.animationDuration))}),c()}}(),n.prototype.run=function(t,n){this.animations[t](n)},this.showSlide=function(t){h(t%Y)},this.getCurrentSlide=function(){return D.find("."+w.slideClass).eq(I%Y)},this.getSlideByIndex=function(t){return D.find("."+w.slideClass+"[data-index="+t+"]")},this.showPreviousSlide=function(){p.click()},this.showNextSlide=function(){m.click()},this.playCarousel=function(){c()},this.pauseCarousel=function(){l()},this}});!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);!function(a){a.fn.jalendar=function(e){function t(){E[1]=T(A);var e=new Date;e.setFullYear(D,M,0);var t=e.getDay()+C;m.find(".header h1").html(o[l.lang][M]+" "+D+'<div class="total-bar"></div>'),m.find(".day").html("&nbsp;").removeAttr("data-date").removeClass("this-month have-event disable-selecting");for(var r=0;r<42-(t+E[M]);r++)m.find(".day").eq(t+E[M]+r).html("<span>"+(r+1)+"</span>");for(var r=0;t>r;r++){var d=void 0==E[M-1]?E[11]:E[M-1];m.find(".day").eq(r).html("<span>"+(d-t+(r+1))+"</span>")}for(var r=1;r<=E[M];r++){t++;var i;if("dd-mm-yyyy"==l.dateType?i=r+"-"+(M+1)+"-"+D:"mm-dd-yyyy"==l.dateType?i=M+1+"-"+r+"-"+D:"yyyy-mm-dd"==l.dateType?i=D+"-"+(M+1)+"-"+r:"yyyy-dd-mm"==l.dateType&&(i=D+"-"+r+"-"+(M+1)),"linker"==l.type?m.find(".day").eq(t-1).addClass("this-month").attr("data-date",i).html('<span><a href="'+l.customUrl+i+'">'+r+"</a></span>"):m.find(".day").eq(t-1).addClass("this-month").attr("data-date",i).html("<span>"+r+"</span>"),1==l.selectingBeforeToday){var s=Math.round(new Date(D+"/"+M+"/"+r+" 00:00:00").getTime()/1e3),y=Math.round(new Date(v+"/"+h+"/"+p+" 00:00:00").getTime()/1e3);s>y&&m.find(".day").eq(t-1).addClass("disable-selecting")}}M==w.getMonth()&&D==w.getFullYear()?m.find(".day.this-month").removeClass("today").eq(k-1).addClass("today"):m.find(".day.this-month").removeClass("today").attr("style",""),m.find(".days").attr("data-month",M+1).attr("data-year",D),m.find(".added-event").each(function(e){a(this).attr("data-id",e),m.find('.this-month[data-date="'+a(this).attr("data-date")+'"]').append(c("div","event-single").attr("data-id",e).append(c("a","").attr("href",a(this).attr("data-link")).attr("target","blank").text(a(this).attr("data-title")))),m.find(".day").has(".event-single").addClass("have-event")}),n(),null!==l.dayColor&&m.find(".day span, .day span a").css({color:l.dayColor}),null!==l.titleColor&&m.find(".header h1, .header .prv-m, .header .nxt-m, .event-single p, h3, .close-button").css({color:l.titleColor}),null!==l.weekColor&&m.find("h2").css({color:l.weekColor}),null!==l.todayColor&&m.find(".day.this-month.today span, .day.this-month.today span a").css({color:l.todayColor}),("#fff"==l.color||"#ffffff"==l.color||"white"==l.color)&&m.find(".header h1, .header .prv-m, .header .nxt-m, .day.today span, h2, .event-single p, h3, .close-button").css({"text-shadow":"none"})}function n(){var e=m.find(".this-month .event-single").length;0==e&&m.find(".total-bar").hide(0),m.find(".total-bar").text(e),m.find(".events h3 span").text(a(".jalendar .day.selected .event-single").length)}function r(){m.find(".day").removeClass("selected").removeAttr("style"),m.find(".add-event").removeClass("selected").height(0)}function d(){if(m.find(".day").removeClass("first-range range last-range"),null!==F)if(0==m.find('[data-date="'+I.val()+'"]').length){if(x<m.find(".days").attr("data-month")&&L>=m.find(".days").attr("data-year")||L<m.find(".days").attr("data-year")?F=0:(x>m.find(".days").attr("data-month")&&L<=m.find(".days").attr("data-month")||L>m.find(".days").attr("data-year"))&&(F=42),null!==j){if(L==N&&x==z)return!1;var a=parseInt(m.find(".days").attr("data-year"),10),e=parseInt(m.find(".days").attr("data-month"),10);(a>L&&N>a||z>e&&N>=a&&a>L||e>x&&L==a&&z>e&&N==a||e>x&&N>a&&L==a||e>x&&L==a&&z>e&&N>=a)&&m.find(".day").addClass("range")}}else F=m.find('[data-date="'+I.val()+'"]').index()}function i(){m.find('.day[data-date="'+I.val()+'"]').addClass("first-range"),m.find('.day[data-date="'+P.val()+'"]').addClass("last-range"),m.find('.day[data-date="'+I.val()+'"]').nextUntil('.day[data-date="'+P.val()+'"]').addClass("range"),m.find('.day[data-date="'+P.val()+'"]').length>0&&(m.find(".day.first-range").length>0?m.find(".day.first-range").nextUntil(".day.last-range").addClass("range"):m.find(".day.last-range").prevUntil(".day:eq(0)").addClass("range"))}var l=a.extend({customDay:new Date,color:"#3aa4d1",color2:"",lang:"EN",type:"",customUrl:"#",dateType:"dd-mm-yyyy",sundayStart:!1,dayColor:null,titleColor:null,weekColor:null,todayColor:null,selectingBeforeToday:!1,done:null},e),s={},o={},y={},u={};s.EN=new Array("Mon","Tue","Wed","Thu","Fri","Sat","Sun"),s.TR=new Array("Pzt","Sal","ar","Per","Cum","Cmt","Pzr"),s.ES=new Array("Lun","Mar","Mi","Jue","Vie","Sb","Dom"),s.DE=new Array("Mon","Die","Mit","Don","Fre","Sam","Son"),s.FR=new Array("Lun","Mar","Mer","Jeu","Ven","Sam","Dim"),s.IT=new Array("Lun","Mar","Mer","Gio","Ven","Sab","Dim"),s.FIL=new Array("Lun","Mar","Miy","Huw","Biy","Sab","Lin"),s.RU=new Array("","","","","","",""),s.NL=new Array("Ma","Di","Wo","Do","Vr","Za","Zo"),s.ZH=new Array("","","","","","",""),s.HI=new Array("","","","","","",""),s.PT=new Array("Se","Te","Qu","Qu","Se","Sa","Do"),s.PL=new Array("po","wt","sr","cz","pi","so","ni"),o.EN=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),o.TR=new Array("Ocak","ubat","Mart","Nisan","Mays","Haziran","Temmuz","Austos","Eyll","Ekim","Kasm","Aralk"),o.ES=new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"),o.DE=new Array("Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"),o.FR=new Array("Janvier","Fvrier","Mars","Avril","Mai","Juin","Juillet","Aot","Septembre","Octobre","Novembre","Dcembre"),o.IT=new Array("Gennaio","Febbraio","Marzo","Aprile","Maggio","Guigno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"),o.FIL=new Array("Enero","Pebrero","Marso","Abril","Mayo","Hunyo","Hulyo","Agosto","Setyembre","Oktubre","Nobyembre","Disyembre"),o.RU=new Array("","","","","","","","","","","",""),o.NL=new Array("januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"),o.ZH=new Array("","","","","","","","","","","",""),o.HI=new Array("","","","","","","","","","","",""),o.PT=new Array("Janeiro","Fevereiro","Maro","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"),o.PL=new Array("styczen","luty","marzec","kwiecien","maj","czerwiec","lipiec","sierpien","wrzesien","pazdziernik","listopad","grudzien"),y.EN="Event(s)",y.TR="Etkinlik",y.ES="Evento(s)",y.DE="Ttigkeit",y.FR="Activit(s)",y.IT="Attivit",y.FIL="Aktibidad",y.RU="",y.NL="Activiteit(en)",y.ZH="",y.HI="",y.PT="Eventos",y.PL="Dziaalno",u.EN="Close",u.TR="Kapat",u.ES="Cerrar",u.DE="Schlieen",u.FR="Fermer",u.IT="Chiudere",u.FIL="Isara",u.RU="",u.NL="Sluiten",u.ZH="",u.HI=" ",u.PT="Fechar",u.PL="Zamkn";var f=new Date,p=f.getDate(),h=f.getMonth(),v=f.getFullYear(),m=a(this),c=function(e,t){return a(document.createElement(e)).addClass(t)},g=""===l.color2?l.color:l.color2;m.append(a('<input type="hidden" class="data1" /><input type="hidden" class="data2" />'),c("div","jalendar-container").append(c("div","jalendar-pages").append(c("div","header").append(c("a","prv-m").append(c("i","fa fa-angle-left")),c("h1"),c("a","nxt-m").append(c("i","fa fa-angle-right")),c("div","day-names")),c("div","days"),c("div","add-event").append(c("div","events").append(c("h3","").html("<span></span> "+y[l.lang]),c("div","events-list")),c("div","close-button").text(u[l.lang]))).attr("style","background-color:"+l.color+"; background: -webkit-gradient(linear, left top, left bottom, from("+l.color+"), to("+g+")); background: -webkit-linear-gradient(top, "+l.color+", "+g+"); background : -moz-linear-gradient(top, "+l.color+", "+g+"); background: -ms-linear-gradient(top, "+l.color+", "+g+"); background: -o-linear-gradient(top, "+l.color+", "+g+");"))),"range"==l.type&&m.find(".jalendar-pages").addClass("range").append(c("input","first-range-data").attr({type:"hidden"}),c("input","last-range-data").attr({type:"hidden"}));for(var b=0;42>b;b++)m.find(".days").append(c("div","day"));var C=0;1==l.sundayStart&&(m.find(".day-names").append(c("h2").text(s[l.lang][6])),C=1);for(var b=C;7>b;b++)m.find(".day-names").append(c("h2").text(s[l.lang][b-C]));var A,w=new Date(l.customDay),D=w.getFullYear(),k=w.getDate(),M=w.getMonth(),S=function(a){var e=new Date;return e.setYear(a),e.setMonth(1),e.setDate(29),29==e.getDate()},T=function(a){return a=S(D)===!0?29:28},E=new Array(31,T(A),31,30,31,30,31,31,30,31,30,31),F=null,j=null,x=null,z=null,L=null,N=null;t();var J=new Array(m.find(".prv-m"),m.find(".nxt-m")),I=(m.find(".jalendar .close-button"),m.find("input.first-range-data")),P=m.find("input.last-range-data");J[1].on("click",function(){M>=11?(M=0,D++):M++,t(),r(),"range"==l.type&&(d(),i())}),J[0].on("click",function(){dayClick=m.find(".this-month"),0===M?(M=11,D--):M--,t(),r(),"range"==l.type&&(d(),i())}),m.on("click",".close-button",function(a){a.preventDefault(),m.find(".add-event").removeClass("selected").height(0),m.find(".this-month.selected").removeClass("selected")}),m.on("click",".this-month:not(.disable-selecting)",function(){function e(a){a.parent().find(".day").removeClass("first-range").removeClass("range").removeClass("last-range"),a.addClass("first-range"),I.val(a.attr("data-date")),F=m.find('[data-date="'+m.find(".first-range").attr("data-date")+'"]').index(),x=m.find(".days").attr("data-month"),L=m.find(".days").attr("data-year"),j=null,P.val("")}function t(a){a.addClass("last-range"),P.val(a.attr("data-date")),j=m.find(".last-range").index(),z=m.find(".days").attr("data-month"),N=m.find(".days").attr("data-year")}if("selector"==l.type)return m.find("input.data1").val(a(this).data("date")),a(this).parent().find(".selected").removeClass("selected"),a(this).addClass("selected"),m.parent().is(".jalendar-input")&&(m.parent().find("input").removeClass("selected"),m.parent(".jalendar-input").find("input").val(a(this).data("date"))),null!==l.done&&l.done.call(this),!1;if("range"==l.type){a(this).parent().find(".first-range"),a(this).parent().find(".last-range");if(null!==F)if(null!==j)e(a(this));else{if(F>a(this).index())return e(a(this)),!1;t(a(this)),m.find("input.data1").val(I.val()),m.find("input.data2").val(P.val()),m.parent().is(".jalendar-input")&&(m.parent().find("input").removeClass("selected"),m.parent(".jalendar-input").find("input").val(m.find("input.data1").val()+", "+m.find("input.data2").val())),null!==l.done&&l.done.call(this)}else e(a(this));return m.on({mouseenter:function(){return null===F?!1:void(""===P.val()&&(m.find(".day").removeClass("range last-range"),a(this).index()>F&&a(this).hasClass("this-month")&&(a(this).addClass("last-range"),a(this).parent().find(".day:eq("+F+")").nextUntil(".this-month.last-range").addClass("range"))))},mouseleave:function(){""===P.val()&&a(this).parent().find(".day").removeClass("last-range").removeClass("range")}},".range .day.this-month"),!1}var n=a(this).find(".event-single");m.find(".events .event-single").remove(),r(),""===l.type&&(m.find("input.data1").val(a(this).data("date")),a(this).addClass("selected"),m.find(".add-event").find(".events-list").html(n.clone()),m.parent().is(".jalendar-input")&&m.parent(".jalendar-input").find("input").val(a(this).data("date")),m.find(".events .event-single").length>=0&&m.find(".events h3 span").html(m.find(".events .event-single").length),m.find(".add-event").addClass("selected").height(m.find(".add-event .events").height()+59))}),m.parent().is(".jalendar-input")&&m.parent(".jalendar-input").find('input[type="text"], .jalendar').on("click",function(e){e.stopPropagation(),a(this).addClass("selected")}),a("html").on("click",function(){a(".jalendar-input input").removeClass("selected")})}}(jQuery);